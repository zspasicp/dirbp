var AcceptEventAction=function(t){t=t||{},AcceptEventAction.baseConstructor.call(this,t)};JSFun.extend(AcceptEventAction,Rectangular),AcceptEventAction.prototype.getLinkCentered=function(t,e){if(this._selectedFigure)return AcceptEventAction.base.getLinkCentered.call(this,t,e);t instanceof Point&&(e=t.getY(),t=t.getX());var i,n,o,s,r,a=this.getCentralPoint(),h=a.getX(),p=a.getY();(i=this.getX(),n=this.getY(),o=a.getX(),s=this.getY(),t<h)?e<p?(r=(this.getY()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(o=this.getX()+25,s=this.getY()+this.getHeight()/2):(o=this.getX()+this.getWidth(),s=this.getY())):(r=(this.getY()+this.getHeight()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(i=this.getX()+25,n=this.getY()+this.getHeight()/2,o=this.getX(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())):e<p?(r=(this.getY()-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(o=this.getX()+this.getWidth(),s=this.getY()):(i=this.getX()+this.getWidth(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())):(r=(this.getY()+this.getHeight()-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(i=this.getX()+this.getWidth(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()));return JSGraphic.lineIntersection(i,n,o,s,t,e,a.getX(),a.getY())},AcceptEventAction.prototype.calculateSize=function(){if(this._selectedFigure)AcceptEventAction.base.calculateSize.call(this);else if(this._components.length>0){var t,e,i=0,n=0;for(e in this._components)(t=this._components[e]).getPosition()!=Component.Float&&t.getPosition()!=Component.BottomLeft&&t.getPosition()!=Component.BottomRight||(n+=t.getHeight(),t.getWidth()>i&&(i=t.getWidth()));this._container?(n>this._minHeight&&this.setMinHeight(n),i>this._minWidth&&this.setMinWidth(i+25)):(n>0&&this.setMinHeight(n),i>0&&this.setMinWidth(i+25))}},AcceptEventAction.prototype.updateComponents=function(){if(this._components.length>0){var t;this.calculateSize(),this.insertComponents(this._x+25,this._y,this._width-25,this._height);for(t in this._relations)this._relations[t].notifyChange()}},AcceptEventAction.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},AcceptEventAction.prototype.setName=function(t){this._components[1].setValue(t)},AcceptEventAction.prototype.getStereotypes=function(){for(var t=this._components[0]._childs,e=[],i=0;i<t.length;i++)e.push(t[i]._text);return e},AcceptEventAction.prototype.getName=function(){return this._components[1].getValue()},AcceptEventAction.prototype.getStereotype=function(){return this._components[0]},AcceptEventAction.prototype.getNameAsComponent=function(){return this._components[1]};var ActivityDiagram=function(t){ActivityDiagram.baseConstructor.call(this,t)};JSFun.extend(ActivityDiagram,Diagram),ActivityDiagram.prototype._instantiateElements=function(t,e,i){i=i||null;var n,o=this._instantiateObjectFromString(t.nodeName,i);if(o)for(e[t.getAttribute("id")]=o,n=0;n<t.childNodes.length;n++)o instanceof SuperNode&&"Swimlane"==t.childNodes[n].nodeName?this._instantiateElements(t.childNodes[n],e,o):this._instantiateElements(t.childNodes[n],e)},ActivityDiagram.prototype._instantiateObjectFromString=function(elemName,parent){if(!JSFun.isString(elemName))return null;var i;parent=parent||null;for(i in this._validElements)if(elemName==this._validElements[i]){if("UMLHorizontalHierarchicalSwimlane"==elemName||"UMLVerticalHierarchicalSwimlane"==elemName||"UMLHorizontalSwimlane"==elemName||"UMLVerticalSwimlane"==elemName||"UMLFlow"==elemName){var setElementXml=!0;return eval("new "+this._validElements[i]+"({ setElementXml: "+setElementXml+"})")}return parent?new window[this._validElements[i]]({addComponent:!1,parent:parent}):eval("new "+this._validElements[i]+"()")}},ActivityDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},ActivityDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var ConnectorActivity=function(t){t=t||{},ConnectorActivity.baseConstructor.call(this,t)};JSFun.extend(ConnectorActivity,Elliptical),ConnectorActivity.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ConnectorActivity.prototype.setName=function(t){this._components[1].setValue(t)},ConnectorActivity.prototype.getStereotypes=function(){return this._components[0]._childs},ConnectorActivity.prototype.getName=function(){return this._components[1].getValue()},ConnectorActivity.prototype.getStereotype=function(){return this._components[0]},ConnectorActivity.prototype.getNameAsComponent=function(){return this._components[1]};var DataStore=function(t){t=t||{},DataStore.baseConstructor.call(this,t)};JSFun.extend(DataStore,Rectangular),DataStore.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},DataStore.prototype.setName=function(t){this._components[2].setValue(t)},DataStore.prototype.getStereotypes=function(){return this._components[0]._childs},DataStore.prototype.getName=function(){return this._components[2].getValue()},DataStore.prototype.getStereotype=function(){return this._components[0]},DataStore.prototype.getNameAsComponent=function(){return this._components[2]};var Decision_MergeNode=function(t){t=t||{},Decision_MergeNode.baseConstructor.call(this,t)};JSFun.extend(Decision_MergeNode,Rhombus),Decision_MergeNode.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Decision_MergeNode.prototype.setName=function(t){this._components[1].setValue(t)},Decision_MergeNode.prototype.getStereotypes=function(){return this._components[0]._childs},Decision_MergeNode.prototype.getName=function(){return this._components[1].getValue()},Decision_MergeNode.prototype.getStereotype=function(){return this._components[0]},Decision_MergeNode.prototype.getNameAsComponent=function(){return this._components[1]};var ExceptionHandler=function(t){t=t||{},this._y=t.y||0,this._limitY=0,this._objA=null,this._objB=null,ExceptionHandler.baseConstructor.call(this,t)};JSFun.extend(ExceptionHandler,Relation),ExceptionHandler.prototype.select=function(t,e){this._deselectComponent();var i=this._diagram._touch?6:0;if(1==this._diagram._pressMouseRight||1==this._diagram._hold){i=this._diagram._touch?10:0;if(this.isOver(t,e,i)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var n=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=n?e-n+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(o=0;o<this._points.length;o++)if(Math.abs(t-this._points[o].getX())<=4&&Math.abs(e-this._points[o].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedPoint=!0,!0;if(this._selected>-1&&this._isOverComponent(t,e,i))return this._selectedBefore=!0,!0;for(var o=0;o<this._points.length-1;o++)if(this._selectLine(this._points[o],this._points[o+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedLine=!0,this._points.splice(this._selected+1,0,new Point(t,e)),!0;return!1},ExceptionHandler.prototype.draw=function(t){ExceptionHandler.base.draw.call(this,t),t.save(),t.strokeStyle=this.getLineColor(),t.lineWidth=this.getLineWidth();var e=this._points.length,i=parseInt(e/2)-1,n=this._points[i].getX(),o=this._points[i].getY(),s=this._points[i+1].getX(),r=this._points[i+1].getY();if(e%2!=0)var a=s,h=r;else a=(n+s)/2,h=this._components.length?this._components[0]._y-30:(o+r)/2-30;var p=this._elemA.getCentralPoint(),l=p._x,_=p._y;if(s<l)if(r<_)if(Math.abs(s-l)>Math.abs(r-_));else a=this._components.length?this._components[0]._x+30:(n+s)/2+30,h=(o+r)/2;else if(Math.abs(s-l)>Math.abs(r-_));else a=this._components.length?this._components[0]._x+30:(n+s)/2+30,h=(o+r)/2;else if(r<_){if(Math.abs(s-l)<Math.abs(r-_))a=this._components.length?this._components[0]._x+30:(n+s)/2+30,h=(o+r)/2}else if(Math.abs(s-l)>Math.abs(r-_));else a=this._components.length?this._components[0]._x+30:(n+s)/2+30,h=(o+r)/2;t.beginPath(),t.moveTo(a-15,h),t.lineTo(a+15,h),t.lineTo(a-15,h+20),t.lineTo(a+15,h+20),t.stroke(),t.restore()},ExceptionHandler.prototype.setName=function(t){this._components[1].setValue(t)},ExceptionHandler.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ExceptionHandler.prototype.getName=function(){return this._components[1].getValue()},ExceptionHandler.prototype.getStereotypes=function(){return this._components[0]._childs},ExceptionHandler.prototype.getNameAsComponent=function(){return this._components[1]};var Pin=function(t){t=t||{},Pin.baseConstructor.call(this,t),this.setAlone(),this.setWidth(7),this.setHeight(14)};JSFun.extend(Pin,Rectangular),Pin.prototype.setAction=function(t){t instanceof Node&&(this._action=t)},Pin.prototype.drop=function(t,e){this.correctPosition(),Pin.base.drop.call(this,t,e)},Pin.prototype.correctPosition=function(){if(this._action){this._action.getX(),this._action.getY(),this._action.getWidth(),this._action.getHeight();if(this.getHeight()>this.getWidth())var t=this._action.getLinkCentered(this.getX()+this._width,this.getY()+this._height/2);else t=this._action.getLinkCentered(this.getX()+this._width/2,this.getY()+this._height);var e=t.getX(),i=t.getY();if(this.getHeight()>this.getWidth()){if(this._action.getY()==i||this._action.getY()+this._action.getHeight()==i){var n=this.getHeight();this.setHeight(this.getWidth()),this.setWidth(n)}}else if(this.getWidth()>this.getHeight()&&(this._action.getX()==e||this._action.getX()+this._action.getWidth()==e)){n=this.getHeight();this.setHeight(this.getWidth()),this.setWidth(n)}this._action.getX()==e?this.setPosition(e-this._width,i-this._height/2):this._action.getY()==i?this.setPosition(e-this._width/2,i-this._height):this._action.getX()+this._action.getWidth()==e?this.setPosition(e,i-this._height/2):this._action.getY()+this._action.getHeight()==i&&this.setPosition(e-this._width/2,i),this.updatePositionComponents(e,i)}},Pin.prototype.updatePositionComponents=function(t,e){var i=-1;t==this._action.getX()?i=Component.Left:t==this._action.getX()+this._action.getWidth()?i=Component.Right:e==this._action.getY()?i=Component.Top:e==this._action.getY()+this._action.getHeight()&&(i=Component.Bottom);for(var n=0;n<this._components.length;n++)this._components[n]._setPosition(i);this.updateComponents(),this.resetMovement()},Pin.prototype.notifyChange=function(){this.updatePosition(),this.correctPosition(),this._container?this.updateContainer():this.updateComponents()},Pin.prototype.remove=function(){Pin.base.remove.call(this),this._parent?this._parent.notifyDeleted(this):this._action.notifyDeleted(this)},Pin.prototype.updatePosition=function(t,e,i){var n;if(i=i||!1,void 0==t||void 0==e){var o=this.getMovement();t=o.getX(),e=o.getY();for(n in this._relations)this._relations[n].updatePosition()}else this._x+=t,this._y+=e;this.resetMovement();for(n in this._components)this._components[n].updatePosition(t,e);for(n in this._relations)(this._relations[n].getParent()!==this._parent||i)&&this._relations[n].notifyChange();if(this._container){for(n in this._nodeChilds)this._nodeChilds[n].updatePosition(t,e);for(n in this._relationChilds)this._relationChilds[n].updatePosition(t,e)}},Pin.prototype.calculateSize=function(){if(this._components.length>0){var t,e,i,n=0,o=0,s=!1;for(i in this._components)!(t=this._components[i])._visible||t instanceof RegionLine||!(t.getPosition()==Component.Float||t.getPosition()==Component.BottomLeft&&t._visible||t.getPosition()==Component.BottomRight||t.getPosition()==Component.Xmovement)?t._visible||(s=!0):t._orientation?(n+=t.getWidth(),t.getHeight()>o&&(o=t.getHeight())):(o+=t.getHeight(),(e=t.getPosition()==Component.Xmovement?t.getWidth()+2*t._parent._Xmovement:t.getWidth())>n&&(n=e));0==o&&1==s&&(o=7),0==n&&1==s&&(n=7),this._container&&!this._selectedFigure?(o>this._minHeight&&this.setMinHeight(o),n>this._minWidth&&this.setMinWidth(n)):(o>0&&this.setMinHeight(o),n>0&&this.setMinWidth(n))}},Pin.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Pin.prototype.setName=function(t){this._components[1].setValue(t)},Pin.prototype.getStereotypes=function(){return this._components[0]._childs},Pin.prototype.getName=function(){return this._components[1].getValue()},Pin.prototype.getStereotype=function(){return this._components[0]},Pin.prototype.getNameAsComponent=function(){return this._components[1]};var ExpansionNode=function(t){t=t||{},ExpansionNode.baseConstructor.call(this,t),this.setWidth(7),this.setHeight(18)};JSFun.extend(ExpansionNode,Pin),ExpansionNode.prototype.correctPosition=function(){if(this._action){this._action.getX(),this._action.getY(),this._action.getWidth(),this._action.getHeight();if(this.getHeight()>this.getWidth())var t=this._action.getLinkCentered(this.getX()+this._width,this.getY()+this._height/2);else t=this._action.getLinkCentered(this.getX()+this._width/2,this.getY()+this._height);var e=t.getX(),i=t.getY();if(this.getHeight()>this.getWidth()){if(this._action.getY()==i||this._action.getY()+this._action.getHeight()==i){var n=this.getHeight();this.setHeight(this.getWidth()),this.setWidth(n)}}else if(this.getWidth()>this.getHeight()&&(this._action.getX()==e||this._action.getX()+this._action.getWidth()==e)){n=this.getHeight();this.setHeight(this.getWidth()),this.setWidth(n)}this._action.getX()==e?this.setPosition(e-this._width,i-this._height/2):this._action.getY()==i?this.setPosition(e-this._width/2,i-this._height):this._action.getX()+this._action.getWidth()==e?this.setPosition(e,i-this._height/2):this._action.getY()+this._action.getHeight()==i&&this.setPosition(e-this._width/2,i),this.updatePositionComponents(e,i)}},ExpansionNode.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ExpansionNode.prototype.setName=function(t){this._components[1].setValue(t)},ExpansionNode.prototype.getStereotypes=function(){return this._components[0]._childs},ExpansionNode.prototype.getName=function(){return this._components[1].getValue()},ExpansionNode.prototype.getStereotype=function(){return this._components[0]},ExpansionNode.prototype.getNameAsComponent=function(){return this._components[1]};var Flow=function(t){t=t||{},this._y=t.y||-1,this._x=t.x||-1,Flow.baseConstructor.call(this,t),t.setElementXml||this._addComponents()};JSFun.extend(Flow,Relation),Flow.prototype.setElementXML=function(t,e){var i,n=t.getAttribute("side_A"),o=t.getAttribute("side_B");this.setElements(e[n],e[o]),this._y=parseInt(t.getAttribute("y")),this._x=parseInt(t.getAttribute("x"));var s=t.childNodes,r=0;for(i=0;i<s.length;i++)"point"==s[i].nodeName&&(this._points[r]=new Point(parseInt(s[i].getAttribute("x")),parseInt(s[i].getAttribute("y"))),r++);for(this._addComponents(),i=0;i<s.length;i++){var a;if("item"==s[i].nodeName)this.setValue(s[i].getAttribute("id"),s[i].getAttribute("value"));else if("superitem"==s[i].nodeName)for(a in this._components)this._components[a].getId()==s[i].getAttribute("id")&&this._components[a].setComponentXML(s[i])}this._updateComponents()},Flow.prototype._addComponents=function(){this.addComponentStereotype(),this.setComponentName("")},Flow.prototype.setComponentName=function(t){this._name?this._name.setText(t):("UMLDecision_MergeNode"==this._elemA.getType()?this._name=new GuardItem({id:"description",text:"[]"}):this._name=new TextArea({id:"name_node",text:""}),this._addComponent(this._name))},Flow.prototype.updateName=function(){if(this._name)if("UMLDecision_MergeNode"!=this._elemA.getType()&&this._name instanceof GuardItem)t=(t=this._name._text.join("\n")).substring(1,t.length-1),this._delComponent(this._name),this._name=new TextArea({id:"name_node",text:t}),this._addComponent(this._name);else if("UMLDecision_MergeNode"==this._elemA.getType()&&!(this._name instanceof GuardItem)){var t="["+this._name._text.join("\n")+"]";this._delComponent(this._name),this._name=new GuardItem({id:"description",text:t}),this._addComponent(this._name)}},Flow.prototype._calculateLineEnds=function(){if("UMLFork_JoinNode"==this._elemA.getType()||"UMLFork_JoinNode"==this._elemB.getType()){var t=this._elemA.getCentralPoint(),e=this._elemB.getCentralPoint(),i=this._points.length,n=!1;!this._selectedPoint&&this._elemA&&this._elemB&&(i>2?("UMLFork_JoinNode"==this._elemA.getType()?(-1!=this._x?this._points[0].setPoint(this._elemA.getLink(this._points[1]._x,this._points[1]._y,this._elemA._x+this._x,t._y)):this._points[0].setPoint(this._elemA.getLink(this._points[1]._x,this._points[1]._y,t._x,this._elemA._y+this._y)),this._elemA.updateLimitSize()):this._points[0]=this._elemA.getLinkCentered(this._points[1]),"UMLFork_JoinNode"==this._elemB.getType()?(-1!=this._x?this._points[i-1].setPoint(this._elemB.getLink(this._points[i-2]._x,this._points[i-2]._y,this._elemB._x+this._x,e._y)):this._points[i-1].setPoint(this._elemB.getLink(this._points[i-2]._x,this._points[i-2]._y,e._x,this._elemB._y+this._y)),this._elemB.updateLimitSize()):this._points[i-1]=this._elemB.getLinkCentered(this._points[i-2])):("UMLFork_JoinNode"==this._elemA.getType()?(-1!=this._x?this._points[0].setPoint(this._elemA.getLink(e._x,e._y,this._elemA._x+this._x,t._y)):this._points[0].setPoint(this._elemA.getLink(e._x,e._y,t._x,this._elemA._y+this._y)),this._elemA.updateLimitSize()):n=!0,"UMLFork_JoinNode"==this._elemB.getType()?(-1!=this._x?this._points[1].setPoint(this._elemB.getLink(t._x,t._y,this._elemB._x+this._x,e._y)):this._points[1].setPoint(this._elemB.getLink(t._x,t._y,e._x,this._elemB._y+this._y)),this._elemB.updateLimitSize()):this._points[1]=this._elemB.getLinkCentered(this._points[0].getX(),this._points[0].getY()),n&&(this._points[0]=this._elemA.getLinkCentered(this._points[1].getX(),this._points[1].getY()))))}else Flow.base._calculateLineEnds.call(this)},Flow.prototype.drag=function(t,e){"UMLFork_JoinNode"==this._elemA.getType()||"UMLFork_JoinNode"==this._elemB.getType()?this._selectedLine?(this._points[this._selected+1].setPoint(t,e),this._moved=!0):this._selectedPoint&&(this._points[this._selected].setPoint(t,e),this._moved=!0):Flow.base.drag.call(this,t,e)},Flow.prototype.drop=function(t,e){if(this._moved){var i;this._checkForNewNodes(t,e);var n=this._points.length;"UMLFork_JoinNode"==this._elemA.getType()&&0==this._selected?i=this._elemA:"UMLFork_JoinNode"==this._elemB.getType()&&this._selected==n-1&&(i=this._elemB),i&&(1==i._quadrant?(this._x=t-i._x,this._x=this._x>=0?this._x:1):(this._y=e-i._y,this._y=this._y>=0?this._y:1))}else this._selectedBefore&&this._selectComponent(t,e);this._selectedLine=!1,this._selectedPoint=!1,this._moved=!1,this._delUselessPoints(),this.notifyChange()},Flow.prototype.exchangePosition=function(){var t;t=this._x,this._x=this._y,this._y=t,delete t},Flow.prototype._checkForNewNodes=function(t,e){if(this._selectedPoint&&(0==this._selected||this._selected==this._points.length-1)){var i=this._diagram.reassignRelationTo(this,t,e);if(i!=this)if(0==this._selected){if(i&&("UMLFork_JoinNode"!=i.getType()||"UMLFork_JoinNode"!=this._elemB.getType())){var n=this._elemA;this.setElementA(i),"UMLFork_JoinNode"==n.getType()&&n.updateLimitSize(),this.updateName()}}else if(i&&("UMLFork_JoinNode"!=i.getType()||"UMLFork_JoinNode"!=this._elemA.getType())){var o=this._elemB;this.setElementB(i),"UMLFork_JoinNode"==o.getType()&&o.updateLimitSize()}}},Flow.prototype.getElementXML=function(t){var e=Flow.base.getElementXML.call(this,t);return e.setAttribute("y",this._y),e.setAttribute("x",this._x),e},Flow.prototype.setName=function(t){this._components[1].setValue(t)},Flow.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Flow.prototype.getName=function(){return this._components[1].getValue()},Flow.prototype.getStereotypes=function(){return this._components[0]._childs},Flow.prototype.getNameAsComponent=function(){return this._components[1]};var FlowFinal=function(t){t=t||{},FlowFinal.baseConstructor.call(this,t)};JSFun.extend(FlowFinal,Elliptical),FlowFinal.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},FlowFinal.prototype.setName=function(t){this._components[1].setValue(t)},FlowFinal.prototype.getStereotypes=function(){return this._components[0]._childs},FlowFinal.prototype.getName=function(){return this._components[1].getValue()},FlowFinal.prototype.getStereotype=function(){return this._components[0]},FlowFinal.prototype.getNameAsComponent=function(){return this._components[1]};var HierarchicalSwimlane=function(t){t=t||{},HierarchicalSwimlane.baseConstructor.call(this,t)};JSFun.extend(HierarchicalSwimlane,SuperNode),HierarchicalSwimlane.prototype.deleteRegion=function(t){var e;if(this._orientation)var i=t.getWidth();else i=t.getHeight();for(e=0;e<this._nodeChilds.length&&this._nodeChilds[e]!=t;e++);t.remove();var n=e;n==this._nodeChilds.length&&this._nodeChilds[n-1]._components[2]&&this._nodeChilds[n-1]._components[2].notifyDelete(),this._orientation?(this._minWidth=this.getWidth()-i,this.setWidth(this.getWidth()-i)):(this._minHeight=this.getHeight()-i,this.setHeight(this.getHeight()-i)),this.updateRegions(),this.notifyChange(!0),this.notifyDraw()},HierarchicalSwimlane.prototype.notifyChange=function(t,e,n){t=t||!1,e=e||!1,n=n||!1,this.resetSizeComponentSwimlane(),this.updateSizeComponentSwimlane();var o=this._nodeChilds;for(i=0;i<o.length;i++)o.length-1!=i?o[i].updateContainer(!1):o[i].updateContainer();HierarchicalSwimlane.base.notifyChange.call(this,t,e,n)},HierarchicalSwimlane.prototype.resetSizeComponentSwimlane=function(){for(var t=this._nodeChilds,e=0;e<t.length;e++)t[e]._heightComp=this._orientation?t[e]._components[0]._height+t[e]._components[1]._height:0,t[e]._widthComp=this._orientation?0:t[e]._components[0]._width+t[e]._components[1]._width},HierarchicalSwimlane.prototype.updateSizeComponentSwimlane=function(){var t=this._nodeChilds;if(this._orientation){for(var e=0,i=0;i<t.length;i++)t[i]._heightComp>e&&(e=t[i]._heightComp);for(i=0;i<t.length;i++)t[i]._heightComp=e}else{for(e=0,i=0;i<t.length;i++)t[i]._widthComp>e&&(e=t[i]._widthComp);for(i=0;i<t.length;i++)t[i]._widthComp=e}},HierarchicalSwimlane.prototype.updateRegions=function(t,e){t=t||!1,e=e||!1;var i=this._nodeChilds.length;if(this._orientation){for(var n=this.getX(),o=0;o<i;o++){(h=this._nodeChilds[o]).setMinHeight(this._minHeight-this._components[0].getHeight()-this._components[1].getHeight()),h.setHeight(this.getHeight()-this._components[0].getHeight()-this._components[1].getHeight()),h._components[2]instanceof RegionLine&&h._components[2].setHeight(this.getHeight()-this._components[0].getHeight()-this._components[1].getHeight())}for(o=0;o<i;o++)this._nodeChilds[o]._x=n,this._nodeChilds[o]._y=this.getY()+this._components[0].getHeight()+this._components[1].getHeight(),o==i-1&&(t||n+this._nodeChilds[o]._width<this.getWidth()+this.getX()?this._nodeChilds[o].setWidth(this.getWidth()+this.getX()-n):this.setWidth(n+this._nodeChilds[o]._width-this.getX())),n+=this._nodeChilds[o].getWidth();for(o=0;o<i;o++){if((r=this._nodeChilds[o]._x-this._nodeChilds[o]._prex)>0||r<0&&!e)for(var s=0;s<this._nodeChilds[o]._nodeChilds.length;s++)this._nodeChilds[o]._nodeChilds[s].updatePosition(r,0,!0);this._nodeChilds[o].resetMovement()}}else{var r,a=this.getY();for(o=0;o<i;o++){var h;(h=this._nodeChilds[o]).setMinWidth(this._minWidth-this._components[0].getWidth()-this._components[1].getWidth()),h.setWidth(this.getWidth()-this._components[0].getWidth()-this._components[1].getWidth()),h._components[2]instanceof RegionLine&&h._components[2].setWidth(this.getWidth()-this._components[0].getWidth()-this._components[1].getWidth())}for(o=0;o<i;o++)this._nodeChilds[o]._x=this.getX()+this._components[0].getWidth()+this._components[1].getWidth(),this._nodeChilds[o]._y=a,o==i-1&&(t||a+this._nodeChilds[o]._height<this.getHeight()+this.getY()?this._nodeChilds[o].setHeight(this.getHeight()+this.getY()-a):this.setHeight(a+this._nodeChilds[o]._height-this.getY())),a+=this._nodeChilds[o].getHeight();for(o=0;o<i;o++){if((r=this._nodeChilds[o]._y-this._nodeChilds[o]._prey)>0||r<0&&!e)for(s=0;s<this._nodeChilds[o]._nodeChilds.length;s++)this._nodeChilds[o]._nodeChilds[s].updatePosition(0,r,!0);this._nodeChilds[o].resetMovement()}}for(this.updateComponents(),o=0;o<this._nodeChilds.length;o++)this._nodeChilds[o].updateComponents()},HierarchicalSwimlane.prototype.select=function(t,e){var i,n=-1;for(this.deselectComponent(),i=0;i<this._nodeChilds.length;i++)this._nodeChilds[i]._selected&&(n=i),this._nodeChilds[i].deselect();if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouse){if(this._selected){if(this._moveable&&Math.abs(t-(this._x+this._width+2.5))<=5&&Math.abs(e-(this._y+this._height+2.5))<=5)return this._resizing=!0,!0;var o=this._nodeChilds;for(i=0;i<o.length-1;i++)if(i==n){if(this._orientation)var s=o[i].getX()+o[i].getWidth()-7,r=o[i].getY()+o[i]._heightComp+7,a=o[i+1].getX()+o[i+1].getWidth()-7,h=o[i+1].getY()+o[i+1]._heightComp+7;else s=o[i].getX()+o[i]._widthComp+7,r=o[i].getY()+o[i].getHeight()-7,a=o[i+1].getX()+o[i+1]._widthComp+7,h=o[i+1].getY()+o[i+1].getHeight()-7;var p=this,l=new Dialog({text:"Do you want to delete the region?",cancelable:!0});if(Math.abs(t-s)<=8&&Math.abs(e-r)<=8)return this._diagram._pressMouse=!1,l.show(function(){p.deleteRegion(o[i])}),!0;if(Math.abs(t-a)<=8&&Math.abs(e-h)<=8)return this._diagram._pressMouse=!1,l.show(function(){p.deleteRegion(o[i+1])}),!0}for(i=0;i<this._nodeChilds.length;i++){var _=this._nodeChilds[i];if(_.isOverComponent(t,e))return _.isOverRegionLine(t,e)?_.selectComponent(t,e):(this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=!0),!0}if(this.isOverComponent(t,e))return this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=!0,!0}return!!this.isOver(t,e)&&(this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=this._selected,this._selected=!0,!0)}if(1==this._diagram._pressMouseRight)return!!this.isOver(t,e)&&(document.oncontextmenu=function(){return!1},t+=this._diagram._div.offsetLeft,e+=this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0)},HierarchicalSwimlane.prototype.updateContainer=function(t){if(0!=t&&1!=t&&(t=!0),this._container){var e,i,n,o,s=this._orientation?this._components[0]._height+this._components[1]._height:0,r=this._orientation?0:this._components[0]._width+this._components[1]._width,a=this._x+r,h=this._y+s,p=this._x+r,l=this._y+s,_=this._nodeChilds.length,c=!1;for(e=0;e<_;e++)(i=this._nodeChilds[e])._visible&&(this._orientation?(o=i._x,elemLeftY=i._y,n=e==_-1?i._x+i._minWidth:i._x+i._width,elemRigthY=i._y+i._minHeight):(o=i._x,elemLeftY=i._y,n=i._x+i._minWidth,elemRigthY=e==_-1?i._y+i._minHeight:i._y+i._height,n=i._x+i._minWidth),n>p&&(p=n),elemRigthY>l&&(l=elemRigthY),o<a&&(a=o),elemLeftY<h&&(h=elemLeftY),c=!0);c&&(a<this._x+r||h<this._y+s?(this.setWidth(this._x+r-a+this._width),this.setHeight(this._y+s-h+this._height),this._x=a-r,this._y=h-s,this.setMinWidth(p-this._x),this.setMinHeight(l-this._y)):(this.setMinWidth(p-this._x),this.setMinHeight(l-this._y))),this._prex=this._x,this._prey=this._y,this.updateComponents(),this._parent&&t&&this._parent.updateContainer()}},HierarchicalSwimlane.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},HierarchicalSwimlane.prototype.setName=function(t){this._components[1].setValue(t)},HierarchicalSwimlane.prototype.getStereotypes=function(){return this._components[0]._childs},HierarchicalSwimlane.prototype.getName=function(){return this._components[1].getValue()},HierarchicalSwimlane.prototype.getStereotype=function(){return this._components[0]},HierarchicalSwimlane.prototype.getNameAsComponent=function(){return this._components[1]};var UMLStereotypedElement=function(t){t=t||{},this._stereotypes=t.stereotypes||[],this._parent=t.parent||null,this._shownStereotype,this._appliedStereotypes=[]};UMLStereotypedElement.prototype.isDrawableStereotype=function(){for(var t=["UMLActor","UMLUseCase","UMLUseCaseExtended","UMLSystem","UMLSubSystem","UMLClass","UMLComponent","UMLInterfaceExtended","UMLPackage","UMLPackageContainer","UMLComComponent","UMLInterface","UMLOption","UMLAlternative","UMLLoop","UMLBreak","UMLAcceptEventAction","UMLTimeEvent","UMLSendSignalAction","UMLAction","UMLObject","UMLActivity","UMLDataStore","UMLConnectorActivity","UMLHorizontalHierarchicalSwimlane","UMLVerticalHierarchicalSwimlane","UMLSimpleState","UMLCompositeState","UMLVerticalRegion","UMLPin","UMLParameterNode","UMLExpansionNode","UMLHorizontalRegion","UMLPort","UMLTerminate","UMLEntryPoint","UMLExitPoint","UMLJunction","UMLFlowFinal","UMLDataType"],e=0;e<t.length;e++)if(this._parent.getType()==t[e])return!0;return!1},UMLStereotypedElement.prototype.setStereotypesProfile=function(t){this._parent&&(this._stereotypes=t)},UMLStereotypedElement.prototype.applyStereotype=function(t){if(!(t instanceof Stereotype))return!1;var e,i=this._parent;if(!i)return!1;var n=!1,o="«"+t.getName()+"»";for(e=0;e<i.getStereotype()._childs.length&&!n;e++)o==i.getStereotype()._childs[e]._text&&t._validMetaclass(i.getType())&&(n=!0);return!n&&(i.addStereotype(t.getName()),this._appliedStereotypes.push(t),i.setTagValues(t.getTagValues()),i.notifyDraw(),!0)},UMLStereotypedElement.prototype.showStereotype=function(t){if(!(t instanceof Stereotype))return!1;var e=this._parent,i=!1;if(!e)return!1;for(var n=0;n<this._appliedStereotypes.length;n++)if(this._appliedStereotypes[n]==t){i=!0;break}return!!i&&(!!this.drawStereotype(t)&&(e.notifyDraw(),!0))},UMLStereotypedElement.prototype.drawStereotype=function(t){var e=this._parent;if(!e)return!1;if(!t||!this.isDrawableStereotype())return e.setSelectedFigure(0),e.notifyDraw(),!1;for(var i=!1,n=0;n<e._figures.length&&!i;n++)e._figures[n].route&&e._figures[n].route==t.getPath()&&(e._figures[n].foundInAssociatedStereotypes(t)||e._figures[n].addAssociatedStereotype(t),e.setSelectedFigure(n),i=!0);return!i&&t.getPath()&&(e.addFigure(new FromImageFigure({route:t.getPath()})),e._figures[e._figures.length-1].addAssociatedStereotype(t),e.setSelectedFigure(e._figures.length-1)),!0},UMLStereotypedElement.prototype.removeStereotype=function(t){if(!(t instanceof Stereotype))return!1;for(var e=!1,i=0;i<this._appliedStereotypes.length&&!e;i++)t==this._appliedStereotypes[i]&&(e=!0);return e&&(this.removeTagValues(t),this.removeFigure(t),this.deleteStereotypeTag(t),this.removeAppliedStereotype(t)),!0},UMLStereotypedElement.prototype.removeTagValues=function(t){if(!(t instanceof Stereotype))return!1;var e,i,n=this._parent._tagValues,o=t._components[3]._childs,s=!1;for(e=0;n[e];){for(s=!1,i=0;i<o.length&&!s;i++)n[e][0]==o[i].getNameTagValue()&&(s=!0,n.splice(e,1));s||e++}return!0},UMLStereotypedElement.prototype.removeFigure=function(t){if(!(t instanceof Stereotype))return!1;var e;for(e=0;e<this._parent._figures.length;e++)if(this._parent._figures[e]instanceof FromImageFigure&&this._parent._figures[e].foundInAssociatedStereotypes(t))return this._parent._figures[e].delAssociatedStereotype(t),this.drawStereotype(null),this._parent._figures[e]._associatedStereotypes.length||this._parent.delFigure(this._parent._figures[e]),!0;return!1},UMLStereotypedElement.prototype.deleteStereotypeTag=function(t){if(!(t instanceof Stereotype))return!1;var e,i=this._parent.getStereotype()._childs;for(e in i)if(i[e]._text=="«"+t.getName()+"»"){i.splice(e,1);break}this._parent.getStereotype().notifyChange()},UMLStereotypedElement.prototype.removeAppliedStereotype=function(t){for(var e=0;e<this._appliedStereotypes.length;e++){t==this._appliedStereotypes[e]&&this._appliedStereotypes.splice(e,1);break}},UMLStereotypedElement.prototype.changeNameStereotype=function(t,e){for(var i=!1,n=0;n<this._appliedStereotypes.length&&!i;n++)t==this._appliedStereotypes[n]&&(i=!0);if(i){var o=this._parent.getStereotype()._childs;for(n in o)if(o[n]._text=="«"+t.getName()+"»"){o[n].setText(e,!0);break}this._parent.getStereotype().notifyChange()}},UMLStereotypedElement.prototype.updateElementStereotypes=function(){for(var t=this._parent.getStereotype()._childs,e=[],i=!1,n=0;n<this._appliedStereotypes.length;n++)if(i=!1,this._appliedStereotypes[n]._validMetaclass(this._parent.getType()))for(var o=0;o<t.length&&!i;o++)if("«"+this._appliedStereotypes[n].getName()+"»"==t[o]._text){for(k=0;k<this._appliedStereotypes[n]._components[3]._childs.length;k++)e.push([this._appliedStereotypes[n]._components[3]._childs[k].getNameTagValue(),this._appliedStereotypes[n]._components[3]._childs[k].getDefaultValue()]);i=!0}var s=this._parent._tagValues;for(n=0;s[n];){for(i=!1,o=0;o<e.length&&!i;o++)e[o][0]==s[n][0]&&(i=!0,n++);i||s.splice(n,1)}s=this._parent._tagValues;for(n in e){for(i=!1,o=0;o<s.length&&!i;o++)e[n][0]==s[o][0]&&(i=!0);i||s.push(e[n])}},UMLStereotypedElement.prototype.showTagValuesDialog=function(){var t=this._parent,e=document.createElement("div");e.className="ud_popup";var i,n=document.createElement("form"),o=[];for(i=0;i<t._tagValues.length;i++)o.push(document.createElement("input"));var s=document.createElement("input");for(s.setAttribute("type","submit"),s.setAttribute("value","ok"),i=0;i<t._tagValues.length;i++)o[i].setAttribute("type","text"),o[i].setAttribute("value",t._tagValues[i][1]||"");var r,a;n.onsubmit=function(){return!1},s.addEventListener("click",function(i){var n;for(n=0;n<t._tagValues.length;n++)t._tagValues[n][1]=o[n].value;document.body.removeChild(e)},!1);var h=[];for(i=0;i<o.length;i++)h.push(t._tagValues[i][0]);for(i=0;i<o.length;i++)a=document.createElement("div"),(r=document.createElement("label")).appendChild(document.createTextNode(h[i])),a.appendChild(r),a.appendChild(o[i]),n.appendChild(a);n.appendChild(s),e.appendChild(n),document.body.appendChild(e),e.style.top=(window.innerHeight-n.offsetHeight)/2+"px",e.style.left=(window.innerWidth-n.offsetWidth)/2+"px"},UMLStereotypedElement.prototype.showApplyStereotypesDialog=function(){var t=this._parent,e=this._stereotypes,i=document.createElement("div");i.className="ud_popup";var n,o,s,r,a=document.createElement("form"),h=[],p=[],l=[];for(n=0;n<t._components.length;n++)if(t._components[n]instanceof StereotypeFields)for(l=t._components[n]._childs,o=0;o<l.length;o++)h[l[o].getValue()]||(h[l[o].getValue()]=t);if(t instanceof SuperNode)for(n=0;n<t._nodeChilds.length;n++)for(o=0;o<t._nodeChilds[n]._components.length;o++)if(t._nodeChilds[n]._components[o]instanceof StereotypeFields)for(l=t._nodeChilds[n]._components[o]._childs,s=0;s<l.length;s++)h[l[s].getValue()]||(h[l[s].getValue()]=t._nodeChilds[n]);for(n=0;n<e.length;n++)for(p=e[n]._metaclass,o=0;o<p.length;o++)p[o].getName()==t.getType()&&(h["«"+e[n].getName()+"»"]||(h["«"+e[n].getName()+"»"]=t));if(t instanceof SuperNode)for(s=0;s<t._nodeChilds.length;s++)if((r=t._nodeChilds[s])._stereotypeProperties)for(n=0;n<r._stereotypeProperties._stereotypes.length;n++)for(p=r._stereotypeProperties._stereotypes[n]._metaclass,o=0;o<p.length;o++)p[o].getName()==r.getType()&&(h["«"+t._stereotypeProperties._stereotypes[n].getName()+"»"]||(h["«"+t._stereotypeProperties._stereotypes[n].getName()+"»"]=t._nodeChilds[s]));var _=!1;for(n in h)_=!0;if(_){var c;textField=document.createElement("select"),(c=document.createElement("option")).setAttribute("value",""),c.appendChild(document.createTextNode("default")),textField.appendChild(c);for(n in h)(c=document.createElement("option")).setAttribute("value",n),c.appendChild(document.createTextNode(n)),textField.appendChild(c);var g=document.createElement("input");g.setAttribute("type","submit"),g.setAttribute("value","ok");a.onsubmit=function(){return!1},g.addEventListener("click",function(t){var n,o,s=!1;for(o in h)if(textField.value==o){n=h[o];break}for(o=0;o<e.length&&!s;o++)"«"+e[o].getName()+"»"==textField.value&&(n._stereotypeProperties&&n._stereotypeProperties.applyStereotype(e[o]),s=!0);document.body.removeChild(i)},!1),a.appendChild(textField),a.appendChild(g),i.appendChild(a),document.body.appendChild(i),i.style.top=(window.innerHeight-a.offsetHeight)/2+"px",i.style.left=(window.innerWidth-a.offsetWidth)/2+"px"}},UMLStereotypedElement.prototype.showStereotypesDialog=function(){var t=this._parent,e=t._stereotypeProperties._appliedStereotypes,i=document.createElement("div");i.className="ud_popup";var n,o,s=document.createElement("form"),r=[];for(n=0;n<e.length;n++)r["«"+e[n].getName()+"»"]||(r["«"+e[n].getName()+"»"]=t);if(t instanceof SuperNode)for(o=0;o<t._nodeChilds.length;o++)if(t._nodeChilds[o]._stereotypeProperties)for(n=0;n<e.length;n++)r["«"+e[n].getName()+"»"]||(r["«"+e[n].getName()+"»"]=t._nodeChilds[o]);var a=!1;for(n in r)a=!0;if(a){var h;textField=document.createElement("select"),(h=document.createElement("option")).setAttribute("value",""),h.appendChild(document.createTextNode("default")),textField.appendChild(h);for(n in r)(h=document.createElement("option")).setAttribute("value",n),h.appendChild(document.createTextNode(n)),t._stereotypeProperties._shownStereotype&&t._stereotypeProperties._shownStereotype==n&&h.setAttribute("selected","selected"),textField.appendChild(h);var p=document.createElement("input");p.setAttribute("type","submit"),p.setAttribute("value","ok");s.onsubmit=function(){return!1},p.addEventListener("click",function(n){var o,s,a=!1;for(s in r)if(textField.value==s){o=r[s];break}for(s=0;s<e.length&&!a;s++)"«"+e[s].getName()+"»"==textField.value&&(o._stereotypeProperties.showStereotype(e[s]),t._stereotypeProperties._shownStereotype=textField.value,a=!0);a||(t._stereotypeProperties._shownStereotype="",t._stereotypeProperties.drawStereotype(null)),document.body.removeChild(i)},!1),s.appendChild(textField),s.appendChild(p),i.appendChild(s),document.body.appendChild(i),i.style.top=(window.innerHeight-s.offsetHeight)/2+"px",i.style.left=(window.innerWidth-s.offsetWidth)/2+"px"}};var setStereotypeProperties=function(t,e){t._stereotypeProperties=new UMLStereotypedElement({stereotypes:e,parent:t})},getStereotypeProperties=function(t){return t._stereotypeProperties},StereotypeTag=function(t){t=t||{},StereotypeTag.baseConstructor.call(this,t)};JSFun.extend(StereotypeTag,StereotypeItem),StereotypeTag.prototype.setText=function(t,e){var i,n;e=e||!1;if(JSFun.isString(t)){if(this._text!=t&&!e)if(this._parent&&this._parent instanceof SuperComponent&&this._parent._parent._stereotypeProperties){for(n=this._parent._parent._stereotypeProperties,i=0;i<n._appliedStereotypes.length;i++)if("«"+n._appliedStereotypes[i].getName()+"»"==this._text){this._parent._parent._stereotypeProperties.removeStereotype(n._appliedStereotypes[i]);break}}else if(this._parent&&this._parent._stereotypeProperties)for(n=this._parent._stereotypeProperties,i=0;i<n._appliedStereotypes.length;i++)if("«"+n._appliedStereotypes[i].getName()+"»"==this._text){n.removeStereotype(n._appliedStereotypes[i]);break}StereotypeTag.base.setText.call(this,t)}},StereotypeTag.prototype.setValue=function(t){this.setText(t)},StereotypeTag.prototype.getComponentXML=function(t){var e=t.createElement("item");this._id&&e.setAttribute("id",this._id),e.setAttribute("value",this.getValue());var i,n=this._parent._parent._stereotypeProperties._stereotypes;for(i=0;i<n.length;i++)if("«"+n[i].getName()+"»"==this.getValue()){e.setAttribute("stereotypeObject",!0);break}return e};var StereotypeTagList=function(t){t=t||{},StereotypeTagList.baseConstructor.call(this,t)};JSFun.extend(StereotypeTagList,StereotypeFields),StereotypeTagList.prototype.notifyDelete=function(t){var e,i=this._parent._stereotypeProperties;if(i)for(e=0;e<i._appliedStereotypes.length;e++)if("«"+i._appliedStereotypes[e].getName()+"»"==t._text){i.removeStereotype(i._appliedStereotypes[e]);break}this.delSubComponent(t),this.updateComponents()},StereotypeTagList.prototype.delSubComponent=function(t){var e;for(e in this._childs)if(this._childs[e]==t){this._childs.splice(e,1);break}},StereotypeTagList.prototype.newItem=function(){return new StereotypeTag({text:"«stereotype»",orientation:this._orientation||0})},StereotypeTagList.prototype.setComponentXML=function(t){var e,i,n=t.childNodes;for("true"==t.getAttribute("visibleSubComponents")?this._visibleSubComponents=!0:this._visibleSubComponents=!1,i=0;i<n.length;i++)"true"==n[i].getAttribute("stereotypeObject")?(e=n[i].getAttribute("value"),this.applyStereotype(e)):this.addField(n[i].getAttribute("value"))},StereotypeTagList.prototype.applyStereotype=function(t){var e,i,n,o=this._parent._stereotypeProperties._stereotypes;for(n=0;n<o.length;n++)for(e=o[n]._metaclass,i=0;i<e.length;i++)e[i].getName()==this._parent.getType()&&"«"+o[n].getName()+"»"==t&&this._parent._stereotypeProperties.applyStereotype(o[n])};var Port=function(t){t=t||{},Port.baseConstructor.call(this,t),this.setAlone(),this.setWidth(14),this.setHeight(14),setStereotypeProperties(this,t.stereotypes||[]),this.addFigure(new RectangleFigure({color:"#eeeeee"})),this.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),this.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3}))};JSFun.extend(Port,Rectangular),Port.prototype.drop=function(t,e){this.correctPosition(),Port.base.drop.call(this,t,e)},Port.prototype.correctPosition=function(){if(this._parent){this._parent.getX(),this._parent.getY(),this._parent.getWidth(),this._parent.getHeight();var t=this._parent.getLinkCentered(this.getX()+7,this.getY()+7),e=t.getX(),i=t.getY();this.setPosition(e-7,i-7),this.updatePositionComponents(e,i)}},Port.prototype.updatePositionComponents=function(t,e){var i=-1;t==this._parent.getX()?i=Component.Left:t==this._parent.getX()+this._parent.getWidth()?i=Component.Right:e==this._parent.getY()?i=Component.Top:e==this._parent.getY()+this._parent.getHeight()&&(i=Component.Bottom);for(var n=0;n<this._components.length;n++)this._components[n]._setPosition(i);this.updateComponents()},Port.prototype.notifyChange=function(){var t;for(t in this._relations)this._relations[t].notifyChange();this.correctPosition()},Port.prototype.remove=function(){Port.base.remove.call(this),this._parent.notifyDeleted(this)},Port.prototype.setName=function(t){this._components[1].setValue(t)},Port.prototype.getName=function(){return this._components[1].getValue()},Port.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Port.prototype.getStereotype=function(){return this._components[0]},Port.prototype.getNameAsComponent=function(){return this._components[1]};var NodeAction=function(t){t=t||{},NodeAction.baseConstructor.call(this,t),this._ports=[]};JSFun.extend(NodeAction,Node),NodeAction.prototype.addPort=function(t){t instanceof Pin&&(this._ports.push(t),this._diagram._addNode(t),this._container?t.setParent(this):t.setAction(this),t.correctPosition())},NodeAction.prototype.setSelectedFigure=function(t){if(NodePorts.base.setSelectedFigure.call(this,t))if(this._figures[t]instanceof FromImageFigure)for(i in this._ports)this._ports[i].setVisibility(!1);else for(i in this._ports)this._ports[i].setVisibility(!0)},NodeAction.prototype.setVisibility=function(t){NodePorts.base.setVisibility.call(this,t);var e=!0;if(this._selectedFigure&&t&&(e=!1),this._container&&e)for(i in this._ports)this._ports[i].setVisibility(t)},NodeAction.prototype.updatePosition=function(t,e,i){if(i=i||!1,void 0==t&&void 0==e)var n=this.getMovement(),o=n.getX(),s=n.getY();else o=t,s=e;var r;for(r in this._ports)this._ports[r].updatePosition(o,s,i);NodeAction.base.updatePosition.call(this,t,e,i)},NodeAction.prototype.notifyChange=function(){var t;NodeAction.base.notifyChange.call(this);for(t in this._ports)this._ports[t].correctPosition(),this._ports[t].notifyChange()},NodeAction.prototype.updateContainer=function(t){NodeAction.base.updateContainer.call(this,t);for(i in this._ports)this._ports[i].correctPosition(),this._ports[i].notifyChange()},NodeAction.prototype.remove=function(){var t;NodeAction.base.remove.call(this);for(t in this._ports)this._ports[t].remove()},NodeAction.prototype.getElementXML=function(t){var e,i=NodeAction.base.getElementXML.call(this,t);for(e in this._ports)i.appendChild(this._ports[e].getElementXML(t));return i},NodeAction.prototype.addChild=function(t){if(t instanceof Pin)return this._ports.push(t),this._container?t.setParent(this):t.setAction(this),void t.correctPosition();NodeAction.base.addChild.call(this,t)},NodeAction.prototype.notifyDeleted=function(t){var e;if(t instanceof Pin)for(e in this._ports)this._ports[e]==t&&this._ports.splice(e,1);else NodeAction.base.notifyDeleted.call(this,t)},NodeAction.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NodeAction.prototype.setName=function(t){this._components[1].setValue(t)},NodeAction.prototype.getStereotypes=function(){return this._components[0]._childs},NodeAction.prototype.getName=function(){return this._components[1].getValue()},NodeAction.prototype.getStereotype=function(){return this._components[0]},NodeAction.prototype.getNameAsComponent=function(){return this._components[1]};var NodeForkJoin=function(t){t=t||{},NodeForkJoin.baseConstructor.call(this,t),this._quadrant=1};JSFun.extend(NodeForkJoin,Rectangular),NodeForkJoin.prototype.getElementXML=function(t){var e,i=t.createElement(this.getType());i.setAttribute("id",this.getId()),i.setAttribute("x",this.getX()),i.setAttribute("y",this.getY()),i.setAttribute("width",this.getWidth()),i.setAttribute("height",this.getHeight()),i.setAttribute("backgroundColor",this.getBackgroundColor()),i.setAttribute("quadrant",this._quadrant);for(e in this._components)this._components[e].getId()&&i.appendChild(this._components[e].getComponentXML(t));for(e in this._nodeChilds)i.appendChild(this._nodeChilds[e].getElementXML(t));for(e in this._relationChilds)i.appendChild(this._relationChilds[e].getElementXML(t));return i},NodeForkJoin.prototype.setElementXML=function(t){var e;this.setPosition(parseInt(t.getAttribute("x")),parseInt(t.getAttribute("y"))),this.resetMovement(),this._width=parseInt(t.getAttribute("width")),this._height=parseInt(t.getAttribute("height")),this.setBackgroundColor(t.getAttribute("backgroundColor")),parseInt(t.getAttribute("quadrant"))!=this._quadrant&&(this._minWidth=5,this._minHeight=50,this._quadrant=parseInt(t.getAttribute("quadrant")));var i=t.childNodes;for(e=0;e<i.length;e++){var n;if("item"==i[e].nodeName)this.setValue(i[e].getAttribute("id"),i[e].getAttribute("value"));else if("superitem"==i[e].nodeName)for(n in this._components)this._components[n].getId()==i[e].getAttribute("id")&&this._components[n].setComponentXML(i[e])}},NodeForkJoin.prototype.setQuadrant=function(t){if(this._quadrant!=t){var e=this._height,i=this._width,n=this._minHeight,o=this._minWidth;this.setMinHeight(o),this.setMinWidth(n),this.setHeight(i),this.setWidth(e);for(var s=this._relations.length;s--;)this._relations[s].exchangePosition();this._quadrant=t}},NodeForkJoin.prototype.drag=function(t,e){if(this._resizing){var i=this._x,n=this._y;if(t>i&&e>n)if(Math.abs(t-i)>Math.abs(e-n))if(1!=this._quadrant)this.setQuadrant(1);else{var o=t-this._x;o=Math.round(o),o-=o%5,this.setWidth(o)}else if(2!=this._quadrant)this.setQuadrant(2);else{var s=e-this._y;s=Math.round(s),s-=s%5,this.setHeight(s)}else if(1==this._quadrant){o=t-this._x;o=Math.round(o),o-=o%5,this.setWidth(o)}else{s=e-this._y;s=Math.round(s),s-=s%5,this.setHeight(s)}}else if(this._selected){o=t-this._relx,s=e-this._rely;o=Math.round(o),o-=o%5,s=Math.round(s),s-=s%5,this.setPosition(o,s),this._moved=!0}},NodeForkJoin.prototype.updateLimitSize=function(){var t,e=this._relations,i=40;if(1==this._quadrant){for(t=e.length;t--;)e[t]._x>i&&(i=e[t]._x);this.setMinWidth(i+10)}else{for(t=e.length;t--;)e[t]._y>i&&(i=e[t]._y);this.setMinHeight(i+10)}},NodeForkJoin.prototype.notifyDeleted=function(t){var e;for(e in this._relations)this._relations[e]==t&&this._relations.splice(e,1);this.updateLimitSize()};var ObjectActivity=function(t){t=t||{},ObjectActivity.baseConstructor.call(this,t)};JSFun.extend(ObjectActivity,Rectangular),ObjectActivity.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ObjectActivity.prototype.setName=function(t){this._components[1].setValue(t)},ObjectActivity.prototype.getStereotypes=function(){return this._components[0]._childs},ObjectActivity.prototype.getName=function(){return this._components[1].getValue()},ObjectActivity.prototype.getStereotype=function(){return this._components[0]},ObjectActivity.prototype.getNameAsComponent=function(){return this._components[1]};var ParameterNode=function(t){t=t||{},ParameterNode.baseConstructor.call(this,t),this.setWidth(60),this.setHeight(30)};JSFun.extend(ParameterNode,Pin),ParameterNode.prototype.correctPosition=function(){if(this._parent){this._parent.getX(),this._parent.getY(),this._parent.getWidth(),this._parent.getHeight();var t=this._parent.getLinkCentered(this.getX()+this._width/2,this.getY()+this._height/2),e=t.getX(),i=t.getY();this.setPosition(e-this._width/2,i-this._height/2)}};var SendSignalAction=function(t){t=t||{},SendSignalAction.baseConstructor.call(this,t)};JSFun.extend(SendSignalAction,Rectangular),SendSignalAction.prototype.getLinkCentered=function(t,e){if(this._selectedFigure)return SendSignalAction.base.getLinkCentered.call(this,t,e);t instanceof Point&&(e=t.getY(),t=t.getX());var i,n,o,s,r,a=this.getCentralPoint(),h=a.getX(),p=a.getY();return i=this.getX(),n=this.getY(),o=a.getX(),s=this.getY(),t<h?e<p?(r=(this.getY()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(o=this.getX(),s=this.getY()+this.getHeight()):(o=this.getX()+this.getWidth(),s=this.getY())):(r=(this.getY()+this.getHeight()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(o=this.getX(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())):e<p?(r=(this.getY()-p)/(this.getX()+this.getWidth()-25-h),e-p==0||(e-p)/(t-h)<r?(o=this.getX()+this.getWidth(),s=this.getY()):(i=this.getX()+this.getWidth()-25,o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()/2)):(r=(this.getY()+this.getHeight()-p)/(this.getX()+this.getWidth()-25-h),e-p==0||(e-p)/(t-h)<r?(i=this.getX()+this.getWidth(),n=this.getY()+this.getHeight()/2,o=this.getX()+this.getWidth()-25,s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth()-25,s=this.getY()+this.getHeight())),JSGraphic.lineIntersection(i,n,o,s,t,e,a.getX(),a.getY())},SendSignalAction.prototype.calculateSize=function(){if(this._selectedFigure)SendSignalAction.base.calculateSize.call(this);else if(this._components.length>0){var t,e,i=0,n=0;for(e in this._components)(t=this._components[e]).getPosition()!=Component.Float&&t.getPosition()!=Component.BottomLeft&&t.getPosition()!=Component.BottomRight||(n+=t.getHeight(),t.getWidth()>i&&(i=t.getWidth()));this._container?(n>this._minHeight&&this.setMinHeight(n),i>this._minWidth&&this.setMinWidth(i+25)):(n>0&&this.setMinHeight(n),i>0&&this.setMinWidth(i+25))}},SendSignalAction.prototype.updateComponents=function(){if(this._components.length>0){var t;this.calculateSize(),this.insertComponents(this._x,this._y,this._width-25,this._height);for(t in this._relations)this._relations[t].notifyChange()}},SendSignalAction.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},SendSignalAction.prototype.setName=function(t){this._components[1].setValue(t)},SendSignalAction.prototype.getStereotypes=function(){return this._components[0]._childs},SendSignalAction.prototype.getName=function(){return this._components[1].getValue()},SendSignalAction.prototype.getStereotype=function(){return this._components[0]},SendSignalAction.prototype.getNameAsComponent=function(){return this._components[1]};var SwimlaneLine=function(t){t=t||{},SwimlaneLine.baseConstructor.call(this,t)};JSFun.extend(SwimlaneLine,RegionLine),SwimlaneLine.prototype.draw=function(t){t.save(),t.beginPath(),this._orientation?(t.lineWidth=this._width,t.moveTo(this.getPixelX(),this.getPixelY()),t.lineTo(this.getPixelX(),this.getPixelY()+this.getHeight())):(t.lineWidth=this._height,t.moveTo(this.getPixelX(),this.getPixelY()),t.lineTo(this.getPixelX()+this.getWidth(),this.getPixelY())),t.stroke(),t.restore()},SwimlaneLine.prototype.drawShape=function(t){t.save(),t.strokeStyle="#aaaaaa",this._parent.getParent()._orientation?t.strokeRect(this.getPixelX()-2,this.getPixelY(),this.getWidth()+4,this.getHeight()):t.strokeRect(this.getPixelX(),this.getPixelY()-4,this.getWidth(),this.getHeight()+6),t.restore(),t.save(),t.fillStyle="#ff0000",t.beginPath(),this._parent.getParent()._orientation?t.arc(this._parent.getX()+this._parent.getWidth()-10,this._parent.getY()+this._parent._heightComp+7,4,0,2*Math.PI,!0):t.arc(this._parent.getX()+this._parent._widthComp+7,this._parent.getY()+this._parent.getHeight()-10,4,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore();for(var e=this._parent.getParent()._nodeChilds,i=0;i<e.length&&e[i]!=this._parent;i++);t.save(),t.fillStyle="#ff0000",t.beginPath(),this._parent.getParent()._orientation?t.arc(e[i+1].getX()+e[i+1].getWidth()-10,e[i+1].getY()+e[i+1]._heightComp+7,4,0,2*Math.PI,!0):t.arc(e[i+1].getX()+e[i+1]._widthComp+7,e[i+1].getY()+e[i+1].getHeight()-10,4,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()};var Swimlane=function(t){t=t||{},Swimlane.baseConstructor.call(this,t),this._type="Swimlane"};JSFun.extend(Swimlane,Region),Swimlane.prototype.addComponents=function(t){t=!JSFun.isBoolean(t)||t;var e=this._parent._nodeChilds,i=e.length;if(0==i&&(this._parent._orientation?this.setWidth(this._parent._width):this.setHeight(this._parent._height)),this._parent._orientation){if(i>0&&t&&(e[i-1].setWidth(e[i-1].getWidth()/2),this._x=e[i-1].getX()+e[i-1].getWidth(),this.setWidth(this._parent.getX()+this._parent.getWidth()-this._x)),this.addComponent(new StereotypeFields({id:"stereotypes",centered:!0})),this.addComponent(new TextBox({id:"name",centered:!0,margin:4})),i>0){var n=2.5;if(this._parent instanceof HierarchicalSwimlane)var o=this._parent.getHeight()-this._parent._components[0]._height-this._parent._components[1]._height;else o=this._parent.getHeight();e[i-1].addComponent(new SwimlaneLine({id:"region",margin:0,width:n,height:o,position:Component.TopRight,orientation:1}))}}else if(i>0&&t&&(e[i-1].setHeight(e[i-1].getHeight()/2),this._y=e[i-1].getY()+e[i-1].getHeight(),this.setHeight(this._parent.getY()+this._parent.getHeight()-this._y)),this.addComponent(new StereotypeFields({id:"stereotypes",centered:!0,orientation:1})),this.addComponent(new TextBox({id:"name",centered:!0,margin:4,orientation:1})),i>0){o=2.5;if(this._parent instanceof HierarchicalSwimlane)n=this._parent.getWidth()-this._parent._components[0]._width-this._parent._components[1]._width;else n=this._parent.getWidth();e[i-1].addComponent(new SwimlaneLine({id:"region",margin:0,width:n,height:o,position:Component.BottomLeft,orientation:0}))}},Swimlane.prototype.notifyChange=function(){this._parent._orientation?(this._heightComp=this._components[0]._height+this._components[1]._height,this._widthComp=0):(this._heightComp=0,this._widthComp=this._components[0]._width+this._components[1]._width),this._parent.updateSizeComponentSwimlane(),Swimlane.base.notifyChange.call(this)},Swimlane.prototype.updateContainer=function(t){if(0!=t&&1!=t&&(t=!0),this._container){var e;this._widthComp=this._widthComp||0,this._heightComp=this._heightComp||0;var i,n,o,s,r,a=this._x+this._widthComp,h=this._y+this._heightComp,p=this._x+this._widthComp,l=this._y+this._heightComp;for(e in this._nodeChilds)(i=this._nodeChilds[e])._visible&&(s=i._x,r=i._y,n=i._x+i._width,o=i._y+i._height,n>p&&(p=n),o>l&&(l=o),s<a&&(a=s),r<h&&(h=r));for(e=this._components.length;e--&&!(this._components[e]instanceof RegionLine););-1!=e&&(this.getParent()._orientation?p+=this._components[e]._width+2:l+=this._components[e]._height+2);var _=-1;if(this.getParent()._orientation){if(a<this._x||p>this._x+this._width){var c;for(e=0;e<this.getParent()._nodeChilds.length;e++){(g=this.getParent()._nodeChilds[e]).getX()+g.getWidth()>a&&-1==_&&(_=e),g.getX()<p&&e}-1!=_&&a<this._x&&(c=this._x-a+this.getParent().getWidth(),this.getParent()._x=this.getParent()._x-(this._x-a),this.getParent().setWidth(c)),p>this._x+this._width&&(c=p-this._x-this._width+this.getParent().getWidth(),this.getParent().setWidth(c))}}else if(h<this._y||l>this._y+this._height){for(e=0;e<this.getParent()._nodeChilds.length;e++){var g;(g=this.getParent()._nodeChilds[e]).getY()+g.getHeight()>h&&-1==_&&(_=e),g.getY()<l&&e}var d;-1!=_&&h<this._y&&(d=this._y-h+this.getParent().getHeight(),this.getParent()._y=this.getParent()._y-(this._y-h),this.getParent().setHeight(d)),l>this._y+this._height&&(d=l-this._y-this._height+this.getParent().getHeight(),this.getParent().setHeight(d))}a<this._x+this._widthComp||h<this._y+this._heightComp?(this.setWidth(this._x+this._widthComp-a+this._width),this.setHeight(this._y+this._heightComp-h+this._height),this._x=a-this._widthComp,this._y=h-this._heightComp,this.setMinWidth(p-this._x),this.setMinHeight(l-this._y)):(this.setMinWidth(p-this._x),this.setMinHeight(l-this._y)),this._prex=this._x,this._prey=this._y,this.updateComponents(),this._parent&&t&&this._parent.updateContainer()}},Swimlane.prototype.draw=function(t){this._visible&&(Swimlane.base.draw.call(this,t),t.save(),t.lineWidth=2.5,t.strokeStyle=ComponentStyle.component_color,t.beginPath(),this._parent._orientation?(t.moveTo(this._x,this._y+this._heightComp),t.lineTo(this._x+this._width,this._y+this._heightComp)):(t.moveTo(this._x+this._widthComp,this._y),t.lineTo(this._x+this._widthComp,this._y+this._height)),t.closePath(),t.stroke(),t.restore())},Swimlane.prototype.getElementXML=function(t){var e=Swimlane.base.getElementXML.call(this,t);return e.setAttribute("widthComp",this._widthComp),e.setAttribute("heightComp",this._heightComp),e},Swimlane.prototype.setElementXML=function(t){Swimlane.base.setElementXML.call(this,t),this._widthComp=parseInt(t.getAttribute("widthComp")),this._heightComp=parseInt(t.getAttribute("heightComp"))},Swimlane.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Swimlane.prototype.setName=function(t){this._components[1]&&this._components[1].setValue(t)},Swimlane.prototype.getStereotypes=function(){return this._components[0]._childs},Swimlane.prototype.getName=function(){return this._components[1].getValue()},Swimlane.prototype.getStereotype=function(){return this._components[0]},Swimlane.prototype.getNameAsComponent=function(){return this._components[1]};var SwimlaneItem=function(t){t=t||{},SwimlaneItem.baseConstructor.call(this,t)};JSFun.extend(SwimlaneItem,RegionItem),SwimlaneItem.prototype.createRegion=function(){var t=this.getParent()._components.length;if(this.getParent()._orientation){if(this._parent instanceof HierarchicalSwimlane)var e=this.getParent()._components[0]._height+this.getParent()._components[1]._height;else e=0;this.getParent().addRegion(new Swimlane({parent:this.getParent(),y:this.getParent().getY()+e,x:this.getParent().getX()}))}else{if(this._parent instanceof HierarchicalSwimlane)var i=this.getParent()._components[0]._width+this.getParent()._components[1]._width;else i=0;this.getParent().addRegion(new Swimlane({parent:this.getParent(),y:this.getParent()._components[t-1]._getY(),x:this.getParent().getX()+i}))}};var TimeEvent=function(t){t=t||{},TimeEvent.baseConstructor.call(this,t)};JSFun.extend(TimeEvent,Rectangular),TimeEvent.prototype.getLinkCentered=function(t,e){if(this._selectedFigure)return TimeEvent.base.getLinkCentered.call(this,t,e);t instanceof Point&&(e=t.getY(),t=t.getX());var i,n,o,s,r,a=this.getCentralPoint(),h=a.getX(),p=a.getY();return i=this.getX(),n=this.getY(),o=a.getX(),s=this.getY(),t<h?e<p?(r=(this.getY()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(o=this.getX()+this.getWidth()/2-2,s=this.getY()+this.getHeight()/2):(o=this.getX()+this.getWidth(),s=this.getY())):(r=(this.getY()+this.getHeight()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(i=this.getX()+this.getWidth()/2-2,n=this.getY()+this.getHeight()/2,o=this.getX(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())):e<p?(r=(this.getY()-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(o=this.getX()+this.getWidth(),s=this.getY()):(i=this.getX()+this.getWidth(),o=this.getX()+this.getWidth()/2+2,s=this.getY()+this.getHeight()/2)):(r=(this.getY()+this.getHeight()-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(i=this.getX()+this.getWidth()/2+2,n=this.getY()+this.getHeight()/2,o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())),JSGraphic.lineIntersection(i,n,o,s,t,e,a.getX(),a.getY())},TimeEvent.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},TimeEvent.prototype.setName=function(t){this._components[1].setValue(t)},TimeEvent.prototype.getStereotypes=function(){return this._components[0]._childs},TimeEvent.prototype.getName=function(){return this._components[1].getValue()},TimeEvent.prototype.getStereotype=function(){return this._components[0]},TimeEvent.prototype.getNameAsComponent=function(){return this._components[1]};var UnhierarchicalSwimlane=function(t){t=t||{},UnhierarchicalSwimlane.baseConstructor.call(this,t)};JSFun.extend(UnhierarchicalSwimlane,SuperNode),UnhierarchicalSwimlane.prototype.deleteRegion=function(t){var e;if(this._orientation)var i=t.getWidth();else i=t.getHeight();for(e=0;e<this._nodeChilds.length&&this._nodeChilds[e]!=t;e++);t.remove();var n=e;n==this._nodeChilds.length&&this._nodeChilds[n-1]._components[2]&&this._nodeChilds[n-1]._components[2].notifyDelete(),this._orientation?(this._minWidth=this.getWidth()-i,this.setWidth(this.getWidth()-i)):(this._minHeight=this.getHeight()-i,this.setHeight(this.getHeight()-i)),this.notifyChange(!0),this.notifyDraw()},UnhierarchicalSwimlane.prototype.notifyChange=function(t,e,i){t=t||!1,e=e||!1,i=i||!1,this.resetSizeComponentSwimlane(),this.updateSizeComponentSwimlane(),UnhierarchicalSwimlane.base.notifyChange.call(this,t,e,i)},UnhierarchicalSwimlane.prototype.resetSizeComponentSwimlane=function(){for(var t=this._nodeChilds,e=0;e<t.length;e++)t[e]._heightComp=this._orientation?t[e]._components[0]._height+t[e]._components[1]._height:0,t[e]._widthComp=this._orientation?0:t[e]._components[0]._width+t[e]._components[1]._width},UnhierarchicalSwimlane.prototype.updateSizeComponentSwimlane=function(){var t=this._nodeChilds;if(this._orientation){for(var e=0,i=0;i<t.length;i++)t[i]._heightComp>e&&(e=t[i]._heightComp);for(i=0;i<t.length;i++)t[i]._heightComp=e}else{for(e=0,i=0;i<t.length;i++)t[i]._widthComp>e&&(e=t[i]._widthComp);for(i=0;i<t.length;i++)t[i]._widthComp=e}},UnhierarchicalSwimlane.prototype.updateRegions=function(t,e){t=t||!1,e=e||!1;var i=this._nodeChilds.length;if(this._orientation){for(var n=this.getX(),o=0;o<i;o++){(a=this._nodeChilds[o]).setMinHeight(this._minHeight),a.setHeight(this.getHeight()),a._components[2]instanceof RegionLine&&a._components[2].setHeight(this.getHeight())}for(o=0;o<i;o++)this._nodeChilds[o]._x=n,this._nodeChilds[o]._y=this.getY(),o==i-1&&(t||n+this._nodeChilds[o]._width<this.getWidth()+this.getX()?this._nodeChilds[o].setWidth(this.getWidth()+this.getX()-n):this.setWidth(n+this._nodeChilds[o]._width-this.getX())),n+=this._nodeChilds[o].getWidth();for(o=0;o<i;o++){if((h=this._nodeChilds[o]._x-this._nodeChilds[o]._prex)>0||h<0&&!e)for(var s=0;s<this._nodeChilds[o]._nodeChilds.length;s++)this._nodeChilds[o]._nodeChilds[s].updatePosition(h,0,!0);this._nodeChilds[o].resetMovement()}}else{var r=this.getY();for(o=0;o<i;o++){var a;(a=this._nodeChilds[o]).setMinWidth(this._minWidth),a.setWidth(this.getWidth()),a._components[2]instanceof RegionLine&&a._components[2].setWidth(this.getWidth())}for(o=0;o<i;o++)this._nodeChilds[o]._x=this.getX(),this._nodeChilds[o]._y=r,o==i-1&&(t||r+this._nodeChilds[o]._height<this.getHeight()+this.getY()?this._nodeChilds[o].setHeight(this.getHeight()+this.getY()-r):this.setHeight(r+this._nodeChilds[o]._height-this.getY())),r+=this._nodeChilds[o].getHeight();for(o=0;o<i;o++){var h;if((h=this._nodeChilds[o]._y-this._nodeChilds[o]._prey)>0||h<0&&!e)for(s=0;s<this._nodeChilds[o]._nodeChilds.length;s++)this._nodeChilds[o]._nodeChilds[s].updatePosition(0,h,!0);this._nodeChilds[o].resetMovement()}}for(this.updateComponents(),o=0;o<this._nodeChilds.length;o++)this._nodeChilds[o].updateComponents()},UnhierarchicalSwimlane.prototype.select=function(t,e){var i,n=-1;for(this.deselectComponent(),i=0;i<this._nodeChilds.length;i++)this._nodeChilds[i]._selected&&(n=i),this._nodeChilds[i].deselect();if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouse){if(this._selected){if(this._moveable&&Math.abs(t-(this._x+this._width+2.5))<=5&&Math.abs(e-(this._y+this._height+2.5))<=5)return this._resizing=!0,!0;var o=this._nodeChilds;for(i=0;i<o.length-1;i++)if(i==n){if(this._orientation)var s=o[i].getX()+o[i].getWidth()-7,r=o[i].getY()+o[i]._heightComp+7,a=o[i+1].getX()+o[i+1].getWidth()-7,h=o[i+1].getY()+o[i+1]._heightComp+7;else o[i]._components[0]._width,o[i]._components[1]._width,s=o[i].getX()+o[i]._widthComp+7,r=o[i].getY()+o[i].getHeight()-7,a=o[i+1].getX()+o[i+1]._widthComp+7,h=o[i+1].getY()+o[i+1].getHeight()-7;var p=this,l=new Dialog({text:"Do you want to delete the region?",cancelable:!0});if(Math.abs(t-s)<=8&&Math.abs(e-r)<=8)return this._diagram._pressMouse=!1,l.show(function(){p.deleteRegion(o[i])}),!0;if(Math.abs(t-a)<=8&&Math.abs(e-h)<=8)return this._diagram._pressMouse=!1,l.show(function(){p.deleteRegion(o[i+1])}),!0}for(i=0;i<this._nodeChilds.length;i++){var _=this._nodeChilds[i];if(_.isOverComponent(t,e))return _.isOverRegionLine(t,e)?_.selectComponent(t,e):(this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=!0),!0}if(this.isOverComponent(t,e))return this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=!0,!0}return!!this.isOver(t,e)&&(this._relx=t-this._x,this._rely=e-this._y,this._selectedBefore=this._selected,this._selected=!0,!0)}if(1==this._diagram._pressMouseRight)return!!this.isOver(t,e)&&(document.oncontextmenu=function(){return!1},t+=this._diagram._div.offsetLeft,e+=this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0)},UnhierarchicalSwimlane.prototype.updateContainer=function(t){if(0!=t&&1!=t&&(t=!0),this._container){var e,i,n,o,s=this._x,r=this._y,a=this._x,h=this._y,p=this._nodeChilds.length;for(e=0;e<p;e++)i=this._nodeChilds[e],this._orientation?(o=i._x,elemLeftY=i._y,n=e==p-1?i._x+i._minWidth:i._x+i._width,elemRigthY=i._y+i._minHeight):(o=i._x,elemLeftY=i._y,n=i._x+i._minWidth,elemRigthY=e==p-1?i._y+i._minHeight:i._y+i._height,n=i._x+i._minWidth),n>a&&(a=n),elemRigthY>h&&(h=elemRigthY),o<s&&(s=o),elemLeftY<r&&(r=elemLeftY);s<this._x||r<this._y?(this.setWidth(this._x-s+this._width),this.setHeight(this._y-r+this._height),this._x=s,this._y=r,this.setMinWidth(a-this._x),this.setMinHeight(h-this._y)):(this.setMinWidth(a-this._x),this.setMinHeight(h-this._y)),this._prex=this._x,this._prey=this._y,this.updateComponents(),this._parent&&t&&this._parent.updateContainer()}};var UMLActivityDiagram=function(t){var e=new ActivityDiagram(t);return e.setType("UMLActivityDiagram"),e.setName("Activity diagram"),e.setValidElements(["UMLAcceptEventAction","UMLTimeEvent","UMLAction","UMLObject","UMLActivity","UMLFlow","UMLActivityFinal","UMLInitialNode","UMLFlowFinal","UMLDecision_MergeNode","UMLDataStore","UMLFork_JoinNode","UMLSendSignalAction","UMLConnectorActivity","UMLHorizontalSwimlane","UMLVerticalSwimlane","UMLVerticalSwimlane","UMLHorizontalHierarchicalSwimlane","UMLVerticalHierarchicalSwimlane","UMLExceptionHandler","Region","Swimlane","UMLPin","UMLParameterNode","UMLExpansionNode","UMLNote","UMLLine"]),e},UMLAcceptEventAction=function(t){var e=new AcceptEventAction(t=t||{});return e.setType("UMLAcceptEventAction"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(100),e.setHeight(55),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.addFigure(new AcceptEventActionFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLTimeEvent=function(t){var e=new TimeEvent(t=t||{});return e.setType("UMLTimeEvent"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(40),e.setHeight(50),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.addFigure(new TimeEventFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLAction=function(t){var e=new NodeAction(t=t||{});return e.setType("UMLAction"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.addFigure(new RoundedRectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLActivity=function(t){var e=new NodeAction(t=t||{});return e.setType("UMLActivity"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.addFigure(new RoundedRectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLDataStore=function(t){var e=new DataStore(t=t||{});return e.setType("UMLDataStore"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new Text({centered:!0,text:"«datastore»",margin:1})),e.addComponent(new DataStoreItem({id:"name",centered:!0,margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLPin=function(t){var e=new Pin(t=t||{});return e.setType("UMLPin"),setStereotypeProperties(e,t.stereotypes||[]),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLParameterNode=function(t){var e=new ParameterNode(t=t||{});return e.setType("UMLParameterNode"),e.setMoveable(),setStereotypeProperties(e,t.stereotypes||[]),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLExpansionNode=function(t){var e=new ExpansionNode(t=t||{});return e.setType("UMLExpansionNode"),setStereotypeProperties(e,t.stereotypes||[]),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.addFigure(new ExpansionNodeFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLObject=function(t){var e=new ObjectActivity(t=t||{});return e.setType("UMLObject"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new ObjectItem({id:"name",centered:!0,margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLFlow=function(t){var e=new Flow(t);return e.setType("UMLFlow"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new OpenTip),e},UMLActivityFinal=function(t){var e=new Elliptical(t);return e.setType("UMLActivityFinal"),e.setWidth(16),e.setHeight(16),e.addFigure(new HalfFilledEllipseFigure({color:"#ffffff",changeFigureColor:!1})),e},UMLInitialNode=function(t){var e=new Elliptical(t);return e.setType("UMLInitialNode"),e.setWidth(16),e.setHeight(16),e.addFigure(new EllipseFigure({color:"#000000",changeFigureColor:!1})),e},UMLFlowFinal=function(t){var e=new FlowFinal(t=t||{});return e.setType("UMLFlowFinal"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(16),e.setHeight(16),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.addFigure(new CrossEllipseFigure({color:"#ffffff",changeFigureColor:!1})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLDecision_MergeNode=function(t){var e=new Decision_MergeNode(t=t||{});return e.setType("UMLDecision_MergeNode"),setStereotypeProperties(e,t.stereotypes||[]),e.setMinWidth(35),e.setMinHeight(35),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.addFigure(new RhombusFigure({color:"#bdd8e5"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLFork_JoinNode=function(t){var e=new NodeForkJoin(t);return e.setType("UMLFork_JoinNode"),e.setWidth(100),e.setMinWidth(50),e.setHeight(5),e.setMinHeight(5),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#000000",changeFigureColor:!1})),e},UMLSendSignalAction=function(t){var e=new SendSignalAction(t=t||{});return e.setType("UMLSendSignalAction"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextBox({id:"name",centered:!0,margin:3})),e.addFigure(new SendSignalActionFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLConnectorActivity=function(t){var e=new ConnectorActivity(t=t||{});return e.setType("UMLConnectorActivity"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(20),e.setHeight(20),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new ConnectorItem({id:"name",centered:!0,margin:3,width:20})),e.addFigure(new EllipseFigure({color:"#ffffbb"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLHorizontalSwimlane=function(t){var e=new UnhierarchicalSwimlane(t);return e.setType("UMLHorizontalSwimlane"),e.setWidth(150),e.setHeight(60),e.setMoveable(),e.setContainer(),e.addComponent(new SwimlaneItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new SwimlaneFigure),t.setElementXml||(e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()})),e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()}))),e},UMLVerticalSwimlane=function(t){(t=t||{}).orientation=1;var e=new UnhierarchicalSwimlane(t);return e.setType("UMLVerticalSwimlane"),e.setWidth(60),e.setHeight(150),e.setMoveable(),e.setContainer(),e.addComponent(new SwimlaneItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new VerticalSwimlaneFigure),t.setElementXml||(e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()})),e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()}))),e},UMLHorizontalHierarchicalSwimlane=function(t){var e=new HierarchicalSwimlane(t=t||{});return e.setType("UMLHorizontalHierarchicalSwimlane"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(60),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0,orientation:1})),e.addComponent(new TextBox({id:"name",centered:!0,margin:3,orientation:1})),e.addComponent(new Separator({id:"separator",centered:!0,orientation:1,width:2.5})),e.addComponent(new SwimlaneItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new SwimlaneFigure),t.setElementXml||(e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()})),e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()}))),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLVerticalHierarchicalSwimlane=function(t){(t=t||{}).orientation=1;var e=new HierarchicalSwimlane(t);return e.setType("UMLVerticalHierarchicalSwimlane"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(60),e.setHeight(150),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextBox({id:"name",centered:!0,margin:3})),e.addComponent(new Separator({id:"separator",centered:!0,height:2.5})),e.addComponent(new SwimlaneItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new VerticalSwimlaneFigure),t.setElementXml||(e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()})),e.addRegion(new Swimlane({parent:e,y:e.getY(),x:e.getX()}))),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLExceptionHandler=function(t){var e=new ExceptionHandler(t);return e.setType("UMLExceptionHandler"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new OpenTip),e},Aggregation=function(t){t=t||{},Aggregation.baseConstructor.call(this,t)};JSFun.extend(Aggregation,Relation),Aggregation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Aggregation.prototype.setName=function(t){this._components[1].setValue(t)},Aggregation.prototype.setRoleA=function(t){this._components[2].setValue(t)},Aggregation.prototype.setRoleB=function(t){this._components[3].setValue(t)},Aggregation.prototype.setMultiplicityA=function(t){this._components[4].setValue(t)},Aggregation.prototype.setMultiplicityB=function(t){this._components[5].setValue(t)},Aggregation.prototype.getStereotypes=function(){return this._components[0]._childs},Aggregation.prototype.getName=function(){return this._components[1].getValue()},Aggregation.prototype.getRoleA=function(){return this._components[2].getValue()},Aggregation.prototype.getRoleB=function(){return this._components[3].getValue()},Aggregation.prototype.getMultiplicityA=function(){return this._components[4].getValue()},Aggregation.prototype.getMultiplicityB=function(){return this._components[5].getValue()},Aggregation.prototype.getNameAsComponent=function(){return this._components[1]},Aggregation.prototype.setDirectionToA=function(t){this._directionA=t,1==t?this.setStart(new OpenTipAggregationEnd):this._start instanceof OpenTipAggregationEnd&&this.setStart(new AggregationEnd)};var Association=function(t){t=t||{},Association.baseConstructor.call(this,t)};JSFun.extend(Association,Relation),Association.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Association.prototype.setName=function(t){this._components[1].setValue(t)},Association.prototype.setRoleA=function(t){this._components[2].setValue(t)},Association.prototype.setRoleB=function(t){this._components[3].setValue(t)},Association.prototype.setMultiplicityA=function(t){this._components[4].setValue(t)},Association.prototype.setMultiplicityB=function(t){this._components[5].setValue(t)},Association.prototype.getStereotypes=function(){return this._components[0]._childs},Association.prototype.getName=function(){return this._components[1].getValue()},Association.prototype.getRoleA=function(){return this._components[2].getValue()},Association.prototype.getRoleB=function(){return this._components[3].getValue()},Association.prototype.getMultiplicityA=function(){return this._components[4].getValue()},Association.prototype.getMultiplicityB=function(){return this._components[5].getValue()},Association.prototype.getNameAsComponent=function(){return this._components[1]};var Class=function(t){t=t||{},this._abstract=!1,Class.baseConstructor.call(this,t)};JSFun.extend(Class,Rectangular),Class.prototype.getElementXML=function(t){var e=Class.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},Class.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),Class.base.setElementXML.call(this,t)},Class.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Class.prototype.setName=function(t){this._components[1].setValue(t)},Class.prototype.addAttribute=function(t){t=t||"";this._components[2].addField(t)},Class.prototype.addOperation=function(t){t=t||"";this._components[3].addField(t)},Class.prototype.getStereotypes=function(){return this._components[0]._childs},Class.prototype.getName=function(){return this._components[1].getValue()},Class.prototype.getAttributes=function(){return this._components[2]._childs},Class.prototype.getOperations=function(){return this._components[3]._childs},Class.prototype.getStereotype=function(){return this._components[0]},Class.prototype.getNameAsComponent=function(){return this._components[1]},Class.prototype.isAbstract=function(){return this._abstract},Class.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var ClassDiagram=function(t){ClassDiagram.baseConstructor.call(this,t)};JSFun.extend(ClassDiagram,Diagram),ClassDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},ClassDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var ComponentElement=function(t){t=t||{},this._abstract=!1,ComponentElement.baseConstructor.call(this,t)};JSFun.extend(ComponentElement,Rectangular),ComponentElement.prototype.getElementXML=function(t){var e=ComponentElement.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},ComponentElement.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),ComponentElement.base.setElementXML.call(this,t)},ComponentElement.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},ComponentElement.prototype.setName=function(t){this._components[3].setValue(t)},ComponentElement.prototype.addAttribute=function(t){t=t||"";this._components[4].addField(t)},ComponentElement.prototype.addOperation=function(t){t=t||"";this._components[5].addField(t)},ComponentElement.prototype.getStereotypes=function(){return this._components[1]._childs},ComponentElement.prototype.getName=function(){return this._components[3].getValue()},ComponentElement.prototype.getAttributes=function(){return this._components[4]._childs},ComponentElement.prototype.getOperations=function(){return this._components[5]._childs},ComponentElement.prototype.getStereotype=function(){return this._components[1]},ComponentElement.prototype.getNameAsComponent=function(){return this._components[3]},ComponentElement.prototype.isAbstract=function(){return this._abstract},ComponentElement.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var Composition=function(t){t=t||{},Composition.baseConstructor.call(this,t)};JSFun.extend(Composition,Relation),Composition.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Composition.prototype.setName=function(t){this._components[1].setValue(t)},Composition.prototype.setRoleA=function(t){this._components[2].setValue(t)},Composition.prototype.setRoleB=function(t){this._components[3].setValue(t)},Composition.prototype.setMultiplicityA=function(t){this._components[4].setValue(t)},Composition.prototype.setMultiplicityB=function(t){this._components[5].setValue(t)},Composition.prototype.getStereotypes=function(){return this._components[0]._childs},Composition.prototype.getName=function(){return this._components[1].getValue()},Composition.prototype.getRoleA=function(){return this._components[2].getValue()},Composition.prototype.getRoleB=function(){return this._components[3].getValue()},Composition.prototype.getMultiplicityA=function(){return this._components[4].getValue()},Composition.prototype.getMultiplicityB=function(){return this._components[5].getValue()},Composition.prototype.getNameAsComponent=function(){return this._components[1]},Composition.prototype.setDirectionToA=function(t){this._directionA=t,1==t?this.setStart(new OpenTipCompositionEnd):this._start instanceof OpenTipCompositionEnd&&this.setStart(new CompositionEnd)};var DataType=function(t){t=t||{},this._abstract=!1,DataType.baseConstructor.call(this,t)};JSFun.extend(DataType,Rectangular),DataType.prototype.setName=function(t){this._components[2].setValue(t)},DataType.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},DataType.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},DataType.prototype.getStereotypes=function(){return this._components[1]._childs},DataType.prototype.getName=function(){return this._components[2].getValue()},DataType.prototype.getAttributes=function(){return this._components[3]._childs},DataType.prototype.getNameAsComponent=function(){return this._components[2]},DataType.prototype.addOperation=function(t){t=t||"";this._components[4].addField(t)},DataType.prototype.getOperations=function(){return this._components[4]._childs},DataType.prototype.getStereotype=function(){return this._components[1]},DataType.prototype.isAbstract=function(){return this._abstract},DataType.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var Dependency=function(t){t=t||{},Dependency.baseConstructor.call(this,t)};JSFun.extend(Dependency,Relation),Dependency.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Dependency.prototype.setName=function(t){this._components[1].setValue(t)},Dependency.prototype.getStereotypes=function(){return this._components[0]._childs},Dependency.prototype.getName=function(){return this._components[1].getValue()},Dependency.prototype.getNameAsComponent=function(){return this._components[1]};var Generalization=function(t){t=t||{},Generalization.baseConstructor.call(this,t)};JSFun.extend(Generalization,Relation),Generalization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Generalization.prototype.setName=function(t){this._components[1].setValue(t)},Generalization.prototype.getStereotypes=function(){return this._components[0]._childs},Generalization.prototype.getName=function(){return this._components[1].getValue()},Generalization.prototype.getNameAsComponent=function(){return this._components[1]};var GeneralizationSet=function(t){t=t||{},this._pivotP=2,GeneralizationSet.baseConstructor.call(this)};JSFun.extend(GeneralizationSet,Relation),GeneralizationSet.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},GeneralizationSet.prototype.setName=function(t){this._components[1].setValue(t)},GeneralizationSet.prototype.getStereotypes=function(){return this._components[0]._childs},GeneralizationSet.prototype.getName=function(){return this._components[1].getValue()},GeneralizationSet.prototype.getNameAsComponent=function(){return this._components[1]},GeneralizationSet.prototype.getRelations=function(){return this._relations},GeneralizationSet.prototype.setElements=function(t,e){if(!(t instanceof Array))return!!GeneralizationSet.base.setElements.call(this,t,e)&&(this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t.length>1){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),this._calculateLineEnds(),!0}return!1},GeneralizationSet.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i]},GeneralizationSet.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t||this._relations[i]._elemB==t)return!1;relation=new SetLine({a:t,b:this}),relation._calculateLineEnds();var e=new Point(relation.getCentralPoint());return this._points.splice(this._pivotP,0,e),relation._calculateLineEnds(),relation._points[2]=this._points[this._pivotP],this._pivotP++,this.notifyChange(),!0},GeneralizationSet.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i].remove(),!0;return!1},GeneralizationSet.prototype.notifyDeleted=function(t){for(i=0;i<this._relations.length;i++)this._relations[i]===t&&"SetLine"==this._relations[i].getType()&&(this._relations.splice(i,1),this._pivotP--,this._points.splice(2+i,1))},GeneralizationSet.prototype._calculateLineEnds=function(){var t,e,n=this._points.length;if(this._points[3]||(t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e),this._elemA==this._elemB){var o,s,r=this._elemA.getCentralPoint(),a=r.getX(),h=r.getY(),p=this._points[2]?this._points[2]._x:this._elemA._x+this._elemA._width,l=this._points[2]?this._points[2]._y:this._elemA._y+this._elemA._height;if(2==this._selected||0==this._selected||this._selected==n-1||-1==this._selected&&!this._elemA._moved||this._elemA._resizing)p-a>0?l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()+s,t.getY()+o),this._points[3]=new Point(e.getX()+s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()+s,t.getY()-o),this._points[3]=new Point(e.getX()+s,h)):l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()-s,t.getY()+o),this._points[3]=new Point(e.getX()-s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()-s,t.getY()-o),this._points[3]=new Point(e.getX()-s,h));else if(3==this._selected)p=this._points[3]._x,l=this._points[3]._y,t=this._elemA.getLinkCentered(a,this._points[0]._y),p-a>0?(s=(s=p-(e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h)).getX())<20?20:s,this._points[2].setX(e.getX()+s),this._points[3]=new Point(e.getX()+s,h)):(s=(s=(e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h)).getX()-p)<20?20:s,this._points[2].setX(e.getX()-s),this._points[3]=new Point(e.getX()-s,h));else if(1==this._selected)p=this._points[1]._x,l=this._points[1]._y,e=this._elemA.getLinkCentered(this._points[4]._x,h),l-h>0?(o=(o=l-(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2)).getY())<20?20:o,this._points[1]=new Point(a,t.getY()+o),this._points[2].setY(t.getY()+o)):(o=(o=(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2)).getY()-l)<20?20:o,this._points[1]=new Point(a,t.getY()-o),this._points[2].setY(t.getY()-o));else if(2==this._selected){var _=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}else if(-1==this._selected){_=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}for(this._points[0]=t,this._points[4]=e;this._points[5];)this._points.pop()}else if(4==n)t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[3]=e;else if(n>4){for(t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[this._points.length-1]=e,i=0;i<this._relations.length;i++)this._relations[i]._calculateLineEnds();if(this._orientation){for(i=1;i<this._pivotP;i++)this._points[i].setX(this._points[this._pivotP].getX());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setY(this._points[1].getY()+5)}else{for(i=1;i<this._pivotP;i++)this._points[i].setY(this._points[this._pivotP].getY());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setX(this._points[1].getX()+5)}}else t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e},GeneralizationSet.prototype._delUselessPoints=function(){var t;for(t=this._points.length-1;t>this._pivotP;t--)this._selectLine(this._points[t+1],this._points[t-1],this._points[t].getX(),this._points[t].getY(),10)&&this._points.splice(t,1)},GeneralizationSet.prototype.draw=function(t){var e,i=this._points.length,n=[];for(e=this._pivotP;e<i;e++)n.push(this._points[e]);if(this._line&&this._line.draw(t,n,this.getLineColor(),this.getLineWidth()),this._end){var o=this._points[i-2].getX(),s=this._points[i-2].getY(),r=this._points[i-1].getX(),a=this._points[i-1].getY(),h=Math.atan2(a-s,r-o);this._end.draw(t,r,a,h,this.getLineColor())}if(this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);for(n=[],e=1;e<=this._pivotP;e++)n.push(this._points[e]);if(n.length>1){if("solid"==this.getLineStyle())var p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth())}if((n=[])[0]=this._points[0],n[1]=this._points[1],n[2]=this._points[this._pivotP],"solid"==this.getLineStyle())p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth()),this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)},GeneralizationSet.prototype.select=function(t,e){this._deselectComponent();var i=this._diagram._touch?4:0;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var n=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=n?e-n+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(o=0;o<this._points.length;o++)if(Math.abs(t-this._points[o].getX())<=4&&Math.abs(e-this._points[o].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedPoint=!0,this._component=!1,!0;if(this._selected>-1&&this._isOverComponent(t,e,i))return this._selectedBefore=!0,this._component=!0,!0;for(var o=0;o<this._points.length-1;o++)if(this._selectLine(this._points[o],this._points[o+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,o>=this._pivotP?(this._selectedLine=!0,this._component=!1,this._points.splice(this._selected,0,new Point(t,e))):o>=1?(this._selectedPoint=!0,this._component=!1,this._selected=this._pivotP):(this._selectedPoint=!0,this._component=!1,this._selected=1),!0;return!1},GeneralizationSet.prototype._calculateOrientation=function(){var t=(this._elemA.getCentralPoint().getY()-this._elemB.getCentralPoint().getY())/(this._elemA.getCentralPoint().getX()-this._elemB.getCentralPoint().getX());return t<1&&t>-1},GeneralizationSet.prototype.isXOriented=function(){return this._orientation},GeneralizationSet.prototype.isYOriented=function(){return!this._orientation},GeneralizationSet.prototype.setXOrientation=function(){this._orientation=!0},GeneralizationSet.prototype.setYOrientation=function(){this._orientation=!1},GeneralizationSet.prototype.getOrientation=function(){return this._orientation?"x":"y"},GeneralizationSet.prototype.setLineStyle=function(t){if(!GeneralizationSet.base.setLineStyle.call(this,t))return!1;for(i in this._relations)if("SetLine"==this._relations[i].getType()&&!this._relations[i].setLineStyle(t))return!1;return!0},GeneralizationSet.prototype.setLineColor=function(t){GeneralizationSet.base.setLineColor.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineColor(t)},GeneralizationSet.prototype.setLineWidth=function(t){GeneralizationSet.base.setLineWidth.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineWidth(t)};var SetLine=function(t){t=t||{},this._last=null,this._id=0,this._type="SetLine",this._line_color="#000000",this._line_width=1.25,this._points=[new Point,new Point],this._selected=-1,this._selectedBefore=!1,this._moved=!1,this._activeComponent=null,this._selectedLine=!1,this._selectedPoint=!1,this._relations=[],this._components=[],this._diagram=null,this.setElements(t.a,t.b),f=this,this._elemB&&(this.setMenu([[function(){f._elemB.showStyleDialog({that:f._elemB}),f._elemB.removeContextualMenu()},"Style"]]),this.setLineStyle(this._elemB.getLineStyle()),this.setLineColor(this._elemB.getLineColor()),this.setLineWidth(this._elemB.getLineWidth()))};JSFun.extend(SetLine,Relation),SetLine.prototype._delUselessPoints=function(){},SetLine.prototype.select=function(t,e){this._deselectComponent();this._diagram._touch;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.setType("SetLine"),this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var i=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=i?e-i+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(var n=0;n>this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedLine=!0,this._component=!1,!0;for(n=0;n<this._points.length;n++)if(Math.abs(t-this._points[n].getX())<=4&&Math.abs(e-this._points[n].getY())<=4)return 2!=n&&(this._selected>-1&&(this._selectedBefore=!0),this._selected=n,this._selectedPoint=!0,this._component=!1,!0);for(n=0;n<this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedPoint=!0,this._component=!1,!0;return!1},SetLine.prototype._calculateLineEnds=function(){if(!this._elemB)return!1;var t=this._points[1];if(this._elemB._orientation)if(this._points.length<3){t=new Point(this._elemB._points[1].getX(),this._elemA.getCentralPoint().getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getY()<this._elemA.getY()?this._points[2].setY(this._elemA.getY()-20):this._points[2].setY(this._elemA.getY()+this._elemA.getHeight()+20)),this._points[0].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[2].getX()<=this._elemA.getX()?(this._points[0].setX(this._elemA.getX()),this._points[1].setX(this._elemA.getX()-10)):this._points[2].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[0].getX()<=this._elemA.getX()&&(this._points[0].setX(this._elemA.getX()+this._elemA.getWidth()),this._points[1].setX(this._elemA.getX()+this._elemA.getWidth()+10));else if(this._points.length<3){t=new Point(this._elemA.getCentralPoint().getX(),this._elemB._points[1].getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getX()<this._elemA.getX()?this._points[2].setX(this._elemA.getX()-20):this._points[2].setX(this._elemA.getX()+this._elemA.getWidth()+20)),this._points[0].getY()<=this._elemA.getY()&&this._points[2].getY()>this._elemA.getY()+this._elemA.getHeight()?(this._points[0].setY(this._elemA.getY()+this._elemA.getHeight()),this._points[1].setY(this._elemA.getY()+this._elemA.getHeight()+10)):this._points[0].getY()>=this._elemA.getY()+this._elemA.getHeight()&&this._points[2].getY()<=this._elemA.getY()&&(this._points[0].setY(this._elemA.getY()),this._points[1].setY(this._elemA.getY()-10));this._points.length<3&&(this._points[1]=t,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=t),this._points[0]=this._elemA.getLinkCentered(this._points[1])},SetLine.prototype.setElementXML=function(t,e){var i,n=t.getAttribute("side_A"),o=e[t.getAttribute("side_B")],s=e[n];if(!(o instanceof GeneralizationSet))return null;o.addElement(s),relation=o._relations[o._relations.length-1],this.setId(t.getAttribute("id"));var r=t.childNodes,a=0;for(i=0;i<r.length;i++)"point"==r[i].nodeName&&(this._points[a]=new Point(parseInt(r[i].getAttribute("x")),parseInt(r[i].getAttribute("y"))),a++);o.delElement(s),this.setLineStyle(o.getLineStyle()),this.setLineColor(o.getLineColor()),this.setLineWidth(o.getLineWidth()),this._type="SetLine",this._elemA=s,this._elemB=o,o._relations.splice(o._relations.length-1,1,this),this._points[2]=o._points[o._pivotP],o._pivotP++,o.notifyChange(),s.addRelation(this)};var Instance=function(t){t=t||{},Instance.baseConstructor.call(this,t)};JSFun.extend(Instance,Rectangular),Instance.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Instance.prototype.setName=function(t){this._components[1].setValue(t)},Instance.prototype.addAttribute=function(t){t=t||"";this._components[2].addField(t)},Instance.prototype.getStereotypes=function(){return this._components[0]._childs},Instance.prototype.getName=function(){return this._components[1].getValue()},Instance.prototype.getAttributes=function(){return this._components[2]._childs},Instance.prototype.getStereotype=function(){return this._components[0]},Instance.prototype.getNameAsComponent=function(){return this._components[1]},Instance.prototype.getNameAsComponent=function(){return this._components[1]};var InterfaceExtended=function(t){t=t||{},this._abstract=!1,InterfaceExtended.baseConstructor.call(this,t)};JSFun.extend(InterfaceExtended,Rectangular),InterfaceExtended.prototype.getElementXML=function(t){var e=InterfaceExtended.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},InterfaceExtended.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),InterfaceExtended.base.setElementXML.call(this,t)},InterfaceExtended.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},InterfaceExtended.prototype.setName=function(t){this._components[2].setValue(t)},InterfaceExtended.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},InterfaceExtended.prototype.addOperation=function(t){t=t||"";this._components[4].addField(t)},InterfaceExtended.prototype.getStereotypes=function(){return this._components[0]._childs},InterfaceExtended.prototype.getName=function(){return this._components[2].getValue()},InterfaceExtended.prototype.getAttributes=function(){return this._components[3]._childs},InterfaceExtended.prototype.getOperations=function(){return this._components[4]._childs},InterfaceExtended.prototype.getStereotype=function(){return this._components[0]},InterfaceExtended.prototype.getNameAsComponent=function(){return this._components[2]},InterfaceExtended.prototype.isAbstract=function(){return this._abstract},InterfaceExtended.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var NAssociation=function(t){t=t||{},NAssociation.baseConstructor.call(this,t)};JSFun.extend(NAssociation,Rhombus),NAssociation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NAssociation.prototype.setName=function(t){this._components[1].setValue(t)},NAssociation.prototype.setRole=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentRoleA(e)},NAssociation.prototype.setMultiplicity=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentMultiplicityA(e)},NAssociation.prototype.getStereotypes=function(){return this._components[0]._childs},NAssociation.prototype.getName=function(){return this._components[1].getValue()},NAssociation.prototype.getRole=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._roleA)return this._relations[i]._roleA.getValue()},NAssociation.prototype.getMultiplicity=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._multiA)return this._relations[i]._multiA.getValue()},NAssociation.prototype.getNameAsComponent=function(){return this._components[1]},NAssociation.prototype.getRelations=function(){return this._relations},NAssociation.prototype.setElements=function(t,e){if(!(t instanceof Array))return t instanceof Node&&e instanceof Node&&(relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),relation=new AssociationN({a:e,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t[0]&&t[1]){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.notifyChange(),!0}return!1},NAssociation.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i]},NAssociation.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return!1;return relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0},NAssociation.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i].remove(),!0;return!1};var AssociationN=function(t){t=t||{};var e=new Relation(t);return e.setType("AssociationN"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentMultiplicityA(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},Package=function(t){t=t||{},Package.baseConstructor.call(this,t)};JSFun.extend(Package,Rectangular),Package.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},Package.prototype.setName=function(t){this._components[2].setValue(t)},Package.prototype.getStereotypes=function(){return this._components[1]._childs},Package.prototype.getName=function(){return this._components[2].getValue()},Package.prototype.getStereotype=function(){return this._components[1]},Package.prototype.getNameAsComponent=function(){return this._components[2]};var PackageContainer=function(t){t=t||{},PackageContainer.baseConstructor.call(this,t)};JSFun.extend(PackageContainer,Rectangular),PackageContainer.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},PackageContainer.prototype.setName=function(t){this._components[1].setValue(t)},PackageContainer.prototype.getStereotypes=function(){return this._components[0]._childs},PackageContainer.prototype.getName=function(){return this._components[1].getValue()},PackageContainer.prototype.getStereotype=function(){return this._components[0]},PackageContainer.prototype.getNameAsComponent=function(){return this._components[1]};var Realization=function(t){t=t||{},Realization.baseConstructor.call(this,t)};JSFun.extend(Realization,Relation),Realization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Realization.prototype.setName=function(t){this._components[1].setValue(t)},Realization.prototype.getStereotypes=function(){return this._components[0]._childs},Realization.prototype.getName=function(){return this._components[1].getValue()},Realization.prototype.getNameAsComponent=function(){return this._components[1]};var Dependency=function(t){t=t||{},Dependency.baseConstructor.call(this,t)};JSFun.extend(Dependency,Relation),Dependency.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Dependency.prototype.setName=function(t){this._components[1].setValue(t)},Dependency.prototype.getStereotypes=function(){return this._components[0]._childs},Dependency.prototype.getName=function(){return this._components[1].getValue()},Dependency.prototype.getNameAsComponent=function(){return this._components[1]};var UMLClassDiagram=function(t){var e=new ClassDiagram(t);return e.setType("UMLClassDiagram"),e.setName("Class diagram"),e.setValidElements(["UMLNote","UMLLine","UMLClass","UMLDataType","UMLComponent","UMLInstance","UMLInterfaceExtended","UMLPackage","UMLPackageContainer","UMLAggregation","UMLAssociation","UMLComposition","UMLDependency","UMLGeneralization","UMLRealization","UMLUsage","UMLPackageMerge","UMLPackagePublicImport","UMLPackagePrivateImport","UMLGeneralizationSet","SetLine","UMLNAssociation","AssociationN"]),e},UMLPackage=function(t){var e=new Package(t=t||{});return e.setType("UMLPackage"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(100),e.setHeight(50),e.addFigure(new PackageFigure({color:"#c0e1c2"})),e.addComponent(new Space({height:16})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Package name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLPackageContainer=function(t){var e=new PackageContainer(t=t||{});return e.setType("UMLPackageContainer"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(75),e.setMoveable(),e.setContainer(),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",margin:5,text:"Package name"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLClass=function(t){var e=new Class(t=t||{});return e.setType("UMLClass"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"ClassName",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",margin:3})),e.addComponent(new OperationFields({id:"operations",margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLComponent=function(t){var e=new ComponentElement(t=t||{});return e.setType("UMLComponent"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(150),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new ComponentSymbol({position:Component.TopRight,margin:3})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new Text({text:"«component»",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Component Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new OperationFields({id:"operations",visibleSubComponents:!1,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLInterfaceExtended=function(t){var e=new InterfaceExtended(t=t||{});return e.setType("UMLInterfaceExtended"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(150),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new CircleSymbol({position:Component.TopRight,margin:3})),e.addComponent(new TextArea({id:"name",text:"Interface Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new OperationFields({id:"methods",visibleSubComponents:!1,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLAggregation=function(t){var e=new Aggregation(t);return e.setType("UMLAggregation"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentRoleB(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e.setStart(new AggregationEnd),e},UMLAssociation=function(t){var e=new Association(t);return e.setType("UMLAssociation"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentRoleB(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},UMLComposition=function(t){var e=new Composition(t);return e.setType("UMLComposition"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentRoleB(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e.setStart(new CompositionEnd),e},UMLDependency=function(t){var e=new Dependency(t);return e.setType("UMLDependency"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLGeneralization=function(t){var e=new Generalization(t);return e.setType("UMLGeneralization"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.addComponentStereotype(),e.setComponentName(),e.setLine(new SolidLine),e.setEnd(new CloseTip),e},UMLRealization=function(t){var e=new Realization(t);return e.setType("UMLRealization"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.addComponentStereotype(),e.setComponentName(),e.setLine(new DashedLine),e.setEnd(new CloseTip),e},UMLUsage=function(t){var e=new Dependency(t);return e.setType("UMLUsage"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«use»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackageMerge=function(t){var e=new Relation(t);return e.setType("UMLPackageMerge"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«merge»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackagePublicImport=function(t){var e=new Relation(t);return e.setType("UMLPackagePublicImport"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«import»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackagePrivateImport=function(t){var e=new Relation(t);return e.setType("UMLPackagePrivateImport"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«access»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLDataType=function(t){var e=new DataType(t=t||{});return e.setType("UMLDataType"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new Text({text:"«datatype»",centered:!0})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"DataTypeName",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",margin:3})),e.addComponent(new OperationFields({id:"operations",margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLNAssociation=function(t){var e=new NAssociation(t=t||{});return e.setMoveable(),setStereotypeProperties(e,t.stereotypes||[]),e.setType("UMLNAssociation"),e.addFigure(new RhombusFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:" ",centered:!0,margin:3})),e},UMLGeneralizationSet=function(t){var e=new GeneralizationSet(t=t||{});return e.setType("UMLGeneralizationSet"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e},UMLInstance=function(t){var e=new Instance(t=t||{});return e.setType("UMLInstance"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new InstanceItem({id:"name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.getComponents()[0].setUnderlineText(!0),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLLink=function(t){var e=new Link(t);e.setType("UMLLink"),e.addComponentStereotype();var i=new InstanceItem({id:"name",centered:!0,margin:3});return e._addComponent(i),e._name=i,e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},Artifact=function(t){t=t||{},Artifact.baseConstructor.call(this,t)};JSFun.extend(Artifact,Rectangular),Artifact.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},Artifact.prototype.setName=function(t){this._components[2].setValue(t)},Artifact.prototype.addProperty=function(t){t=t||"";this._components[3].addField(t)},Artifact.prototype.getStereotypes=function(){return this._components[1]._childs},Artifact.prototype.getName=function(){return this._components[2].getValue()},Artifact.prototype.getStereotype=function(){return this._components[1]},Artifact.prototype.getNameAsComponent=function(){return this._components[2]},Artifact.prototype.getProperties=function(){return this._components[3]._childs};var Association=function(t){t=t||{},Association.baseConstructor.call(this,t)};JSFun.extend(Association,Relation),Association.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Association.prototype.setName=function(t){this._components[1].setValue(t)},Association.prototype.setRoleA=function(t){this._components[2].setValue(t)},Association.prototype.setRoleB=function(t){this._components[3].setValue(t)},Association.prototype.setMultiplicityA=function(t){this._components[4].setValue(t)},Association.prototype.setMultiplicityB=function(t){this._components[5].setValue(t)},Association.prototype.getStereotypes=function(){return this._components[0]._childs},Association.prototype.getName=function(){return this._components[1].getValue()},Association.prototype.getRoleA=function(){return this._components[2].getValue()},Association.prototype.getRoleB=function(){return this._components[3].getValue()},Association.prototype.getMultiplicityA=function(){return this._components[4].getValue()},Association.prototype.getMultiplicityB=function(){return this._components[5].getValue()},Association.prototype.getNameAsComponent=function(){return this._components[1]};var Class=function(t){t=t||{},this._abstract=!1,Class.baseConstructor.call(this,t)};JSFun.extend(Class,Rectangular),Class.prototype.getElementXML=function(t){var e=Class.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},Class.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),Class.base.setElementXML.call(this,t)},Class.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Class.prototype.setName=function(t){this._components[1].setValue(t)},Class.prototype.addAttribute=function(t){t=t||"";this._components[2].addField(t)},Class.prototype.addOperation=function(t){t=t||"";this._components[3].addField(t)},Class.prototype.getStereotypes=function(){return this._components[0]._childs},Class.prototype.getName=function(){return this._components[1].getValue()},Class.prototype.getAttributes=function(){return this._components[2]._childs},Class.prototype.getOperations=function(){return this._components[3]._childs},Class.prototype.getStereotype=function(){return this._components[0]},Class.prototype.getNameAsComponent=function(){return this._components[1]},Class.prototype.isAbstract=function(){return this._abstract},Class.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var ComponentDiagram=function(t){ComponentDiagram.baseConstructor.call(this,t)};JSFun.extend(ComponentDiagram,Diagram),ComponentDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},ComponentDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var ConnectorRelation=function(t){t=t||{},ConnectorRelation.baseConstructor.call(this,t)};JSFun.extend(ConnectorRelation,Relation),ConnectorRelation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ConnectorRelation.prototype.setName=function(t){this._components[1].setValue(t)},ConnectorRelation.prototype.getStereotypes=function(){return this._components[0]._childs},ConnectorRelation.prototype.getName=function(){return this._components[1].getValue()},ConnectorRelation.prototype.getNameAsComponent=function(){return this._components[1]};var Dependency=function(t){t=t||{},Dependency.baseConstructor.call(this,t)};JSFun.extend(Dependency,Relation),Dependency.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Dependency.prototype.setName=function(t){this._components[1].setValue(t)},Dependency.prototype.getStereotypes=function(){return this._components[0]._childs},Dependency.prototype.getName=function(){return this._components[1].getValue()},Dependency.prototype.getNameAsComponent=function(){return this._components[1]};var Generalization=function(t){t=t||{},Generalization.baseConstructor.call(this,t)};JSFun.extend(Generalization,Relation),Generalization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Generalization.prototype.setName=function(t){this._components[1].setValue(t)},Generalization.prototype.getStereotypes=function(){return this._components[0]._childs},Generalization.prototype.getName=function(){return this._components[1].getValue()},Generalization.prototype.getNameAsComponent=function(){return this._components[1]};var GeneralizationSet=function(t){t=t||{},this._pivotP=2,GeneralizationSet.baseConstructor.call(this)};JSFun.extend(GeneralizationSet,Relation),GeneralizationSet.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},GeneralizationSet.prototype.setName=function(t){this._components[1].setValue(t)},GeneralizationSet.prototype.getStereotypes=function(){return this._components[0]._childs},GeneralizationSet.prototype.getName=function(){return this._components[1].getValue()},GeneralizationSet.prototype.getNameAsComponent=function(){return this._components[1]},GeneralizationSet.prototype.getRelations=function(){return this._relations},GeneralizationSet.prototype.setElements=function(t,e){if(!(t instanceof Array))return!!GeneralizationSet.base.setElements.call(this,t,e)&&(this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t.length>1){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),this._calculateLineEnds(),!0}return!1},GeneralizationSet.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i]},GeneralizationSet.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t||this._relations[i]._elemB==t)return!1;relation=new SetLine({a:t,b:this}),relation._calculateLineEnds();var e=new Point(relation.getCentralPoint());return this._points.splice(this._pivotP,0,e),relation._calculateLineEnds(),relation._points[2]=this._points[this._pivotP],this._pivotP++,this.notifyChange(),!0},GeneralizationSet.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i].remove(),!0;return!1},GeneralizationSet.prototype.notifyDeleted=function(t){for(i=0;i<this._relations.length;i++)this._relations[i]===t&&"SetLine"==this._relations[i].getType()&&(this._relations.splice(i,1),this._pivotP--,this._points.splice(2+i,1))},GeneralizationSet.prototype._calculateLineEnds=function(){var t,e,n=this._points.length;if(this._points[3]||(t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e),this._elemA==this._elemB){var o,s,r=this._elemA.getCentralPoint(),a=r.getX(),h=r.getY(),p=this._points[2]?this._points[2]._x:this._elemA._x+this._elemA._width,l=this._points[2]?this._points[2]._y:this._elemA._y+this._elemA._height;if(2==this._selected||0==this._selected||this._selected==n-1||-1==this._selected&&!this._elemA._moved||this._elemA._resizing)p-a>0?l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()+s,t.getY()+o),this._points[3]=new Point(e.getX()+s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()+s,t.getY()-o),this._points[3]=new Point(e.getX()+s,h)):l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()-s,t.getY()+o),this._points[3]=new Point(e.getX()-s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()-s,t.getY()-o),this._points[3]=new Point(e.getX()-s,h));else if(3==this._selected)p=this._points[3]._x,l=this._points[3]._y,t=this._elemA.getLinkCentered(a,this._points[0]._y),p-a>0?(s=(s=p-(e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h)).getX())<20?20:s,this._points[2].setX(e.getX()+s),this._points[3]=new Point(e.getX()+s,h)):(s=(s=(e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h)).getX()-p)<20?20:s,this._points[2].setX(e.getX()-s),this._points[3]=new Point(e.getX()-s,h));else if(1==this._selected)p=this._points[1]._x,l=this._points[1]._y,e=this._elemA.getLinkCentered(this._points[4]._x,h),l-h>0?(o=(o=l-(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2)).getY())<20?20:o,this._points[1]=new Point(a,t.getY()+o),this._points[2].setY(t.getY()+o)):(o=(o=(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2)).getY()-l)<20?20:o,this._points[1]=new Point(a,t.getY()-o),this._points[2].setY(t.getY()-o));else if(2==this._selected){var _=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}else if(-1==this._selected){_=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}for(this._points[0]=t,this._points[4]=e;this._points[5];)this._points.pop()}else if(4==n)t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[3]=e;else if(n>4){for(t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[this._points.length-1]=e,i=0;i<this._relations.length;i++)this._relations[i]._calculateLineEnds();if(this._orientation){for(i=1;i<this._pivotP;i++)this._points[i].setX(this._points[this._pivotP].getX());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setY(this._points[1].getY()+5)}else{for(i=1;i<this._pivotP;i++)this._points[i].setY(this._points[this._pivotP].getY());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setX(this._points[1].getX()+5)}}else t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e},GeneralizationSet.prototype._delUselessPoints=function(){var t;for(t=this._points.length-1;t>this._pivotP;t--)this._selectLine(this._points[t+1],this._points[t-1],this._points[t].getX(),this._points[t].getY(),10)&&this._points.splice(t,1)},GeneralizationSet.prototype.draw=function(t){var e,i=this._points.length,n=[];for(e=this._pivotP;e<i;e++)n.push(this._points[e]);if(this._line&&this._line.draw(t,n,this.getLineColor(),this.getLineWidth()),this._end){var o=this._points[i-2].getX(),s=this._points[i-2].getY(),r=this._points[i-1].getX(),a=this._points[i-1].getY(),h=Math.atan2(a-s,r-o);this._end.draw(t,r,a,h,this.getLineColor())}if(this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);for(n=[],e=1;e<=this._pivotP;e++)n.push(this._points[e]);if(n.length>1){if("solid"==this.getLineStyle())var p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth())}if((n=[])[0]=this._points[0],n[1]=this._points[1],n[2]=this._points[this._pivotP],"solid"==this.getLineStyle())p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth()),this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)},GeneralizationSet.prototype.select=function(t,e){this._deselectComponent();var i=this._diagram._touch?4:0;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var n=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=n?e-n+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(o=0;o<this._points.length;o++)if(Math.abs(t-this._points[o].getX())<=4&&Math.abs(e-this._points[o].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedPoint=!0,this._component=!1,!0;if(this._selected>-1&&this._isOverComponent(t,e,i))return this._selectedBefore=!0,this._component=!0,!0;for(var o=0;o<this._points.length-1;o++)if(this._selectLine(this._points[o],this._points[o+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,o>=this._pivotP?(this._selectedLine=!0,this._component=!1,this._points.splice(this._selected,0,new Point(t,e))):o>=1?(this._selectedPoint=!0,this._component=!1,this._selected=this._pivotP):(this._selectedPoint=!0,this._component=!1,this._selected=1),!0;return!1},GeneralizationSet.prototype._calculateOrientation=function(){var t=(this._elemA.getCentralPoint().getY()-this._elemB.getCentralPoint().getY())/(this._elemA.getCentralPoint().getX()-this._elemB.getCentralPoint().getX());return t<1&&t>-1},GeneralizationSet.prototype.isXOriented=function(){return this._orientation},GeneralizationSet.prototype.isYOriented=function(){return!this._orientation},GeneralizationSet.prototype.setXOrientation=function(){this._orientation=!0},GeneralizationSet.prototype.setYOrientation=function(){this._orientation=!1},GeneralizationSet.prototype.getOrientation=function(){return this._orientation?"x":"y"},GeneralizationSet.prototype.setLineStyle=function(t){if(!GeneralizationSet.base.setLineStyle.call(this,t))return!1;for(i in this._relations)if("SetLine"==this._relations[i].getType()&&!this._relations[i].setLineStyle(t))return!1;return!0},GeneralizationSet.prototype.setLineColor=function(t){GeneralizationSet.base.setLineColor.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineColor(t)},GeneralizationSet.prototype.setLineWidth=function(t){GeneralizationSet.base.setLineWidth.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineWidth(t)};var SetLine=function(t){t=t||{},this._last=null,this._id=0,this._type="SetLine",this._line_color="#000000",this._line_width=1.25,this._points=[new Point,new Point],this._selected=-1,this._selectedBefore=!1,this._moved=!1,this._activeComponent=null,this._selectedLine=!1,this._selectedPoint=!1,this._relations=[],this._components=[],this._diagram=null,this.setElements(t.a,t.b),f=this,this._elemB&&(this.setMenu([[function(){f._elemB.showStyleDialog({that:f._elemB}),f._elemB.removeContextualMenu()},"Style"]]),this.setLineStyle(this._elemB.getLineStyle()),this.setLineColor(this._elemB.getLineColor()),this.setLineWidth(this._elemB.getLineWidth()))};JSFun.extend(SetLine,Relation),SetLine.prototype._delUselessPoints=function(){},SetLine.prototype.select=function(t,e){this._deselectComponent();this._diagram._touch;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.setType("SetLine"),this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var i=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=i?e-i+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(var n=0;n>this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedLine=!0,this._component=!1,!0;for(n=0;n<this._points.length;n++)if(Math.abs(t-this._points[n].getX())<=4&&Math.abs(e-this._points[n].getY())<=4)return 2!=n&&(this._selected>-1&&(this._selectedBefore=!0),this._selected=n,this._selectedPoint=!0,this._component=!1,!0);for(n=0;n<this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedPoint=!0,this._component=!1,!0;return!1},SetLine.prototype._calculateLineEnds=function(){if(!this._elemB)return!1;var t=this._points[1];if(this._elemB._orientation)if(this._points.length<3){t=new Point(this._elemB._points[1].getX(),this._elemA.getCentralPoint().getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getY()<this._elemA.getY()?this._points[2].setY(this._elemA.getY()-20):this._points[2].setY(this._elemA.getY()+this._elemA.getHeight()+20)),this._points[0].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[2].getX()<=this._elemA.getX()?(this._points[0].setX(this._elemA.getX()),this._points[1].setX(this._elemA.getX()-10)):this._points[2].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[0].getX()<=this._elemA.getX()&&(this._points[0].setX(this._elemA.getX()+this._elemA.getWidth()),this._points[1].setX(this._elemA.getX()+this._elemA.getWidth()+10));else if(this._points.length<3){t=new Point(this._elemA.getCentralPoint().getX(),this._elemB._points[1].getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getX()<this._elemA.getX()?this._points[2].setX(this._elemA.getX()-20):this._points[2].setX(this._elemA.getX()+this._elemA.getWidth()+20)),this._points[0].getY()<=this._elemA.getY()&&this._points[2].getY()>this._elemA.getY()+this._elemA.getHeight()?(this._points[0].setY(this._elemA.getY()+this._elemA.getHeight()),this._points[1].setY(this._elemA.getY()+this._elemA.getHeight()+10)):this._points[0].getY()>=this._elemA.getY()+this._elemA.getHeight()&&this._points[2].getY()<=this._elemA.getY()&&(this._points[0].setY(this._elemA.getY()),this._points[1].setY(this._elemA.getY()-10));this._points.length<3&&(this._points[1]=t,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=t),this._points[0]=this._elemA.getLinkCentered(this._points[1])},SetLine.prototype.setElementXML=function(t,e){var i,n=t.getAttribute("side_A"),o=e[t.getAttribute("side_B")],s=e[n];if(!(o instanceof GeneralizationSet))return null;o.addElement(s),relation=o._relations[o._relations.length-1],this.setId(t.getAttribute("id"));var r=t.childNodes,a=0;for(i=0;i<r.length;i++)"point"==r[i].nodeName&&(this._points[a]=new Point(parseInt(r[i].getAttribute("x")),parseInt(r[i].getAttribute("y"))),a++);o.delElement(s),this.setLineStyle(o.getLineStyle()),this.setLineColor(o.getLineColor()),this.setLineWidth(o.getLineWidth()),this._type="SetLine",this._elemA=s,this._elemB=o,o._relations.splice(o._relations.length-1,1,this),this._points[2]=o._points[o._pivotP],o._pivotP++,o.notifyChange(),s.addRelation(this)};var InterfaceExtended=function(t){t=t||{},this._abstract=!1,InterfaceExtended.baseConstructor.call(this,t)};JSFun.extend(InterfaceExtended,Rectangular),InterfaceExtended.prototype.getElementXML=function(t){var e=InterfaceExtended.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},InterfaceExtended.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),InterfaceExtended.base.setElementXML.call(this,t)},InterfaceExtended.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},InterfaceExtended.prototype.setName=function(t){this._components[2].setValue(t)},InterfaceExtended.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},InterfaceExtended.prototype.addOperation=function(t){t=t||"";this._components[4].addField(t)},InterfaceExtended.prototype.getStereotypes=function(){return this._components[0]._childs},InterfaceExtended.prototype.getName=function(){return this._components[2].getValue()},InterfaceExtended.prototype.getAttributes=function(){return this._components[3]._childs},InterfaceExtended.prototype.getOperations=function(){return this._components[4]._childs},InterfaceExtended.prototype.getStereotype=function(){return this._components[0]},InterfaceExtended.prototype.getNameAsComponent=function(){return this._components[2]},InterfaceExtended.prototype.isAbstract=function(){return this._abstract},InterfaceExtended.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var InterfaceRealization=function(t){t=t||{},InterfaceRealization.baseConstructor.call(this,t)};JSFun.extend(InterfaceRealization,Relation),InterfaceRealization.prototype.setName=function(t){this._components[0].setValue(t)},InterfaceRealization.prototype.getName=function(){return this._components[0].getValue()},InterfaceRealization.prototype.getNameAsComponent=function(){return this._components[0]};var InterfaceUsage=function(t){t=t||{},InterfaceUsage.baseConstructor.call(this,t)};JSFun.extend(InterfaceUsage,Relation),InterfaceUsage.prototype.setName=function(t){this._components[0].setValue(t)},InterfaceUsage.prototype.getName=function(){return this._components[0].getValue()},InterfaceUsage.prototype.getNameAsComponent=function(){return this._components[0]},InterfaceUsage.prototype.draw=function(t){var e,i=this._points.length;if(this._line){var n=this._points[i-2].getX(),o=this._points[i-2].getY(),s=this._points[i-1].getX(),r=this._points[i-1].getY(),a=Math.atan2(r-o,s-n);this._points[i-1].setX(this._points[i-1].getX()-4*Math.cos(a)),this._points[i-1].setY(this._points[i-1].getY()-4*Math.sin(a)),this._line.draw(t,this._points,this.getLineColor(),this.getLineWidth()),this._points[i-1].setX(this._points[i-1].getX()+4*Math.cos(a)),this._points[i-1].setY(this._points[i-1].getY()+4*Math.sin(a))}if(this._end){n=this._points[i-2].getX(),o=this._points[i-2].getY(),s=this._points[i-1].getX(),r=this._points[i-1].getY(),a=Math.atan2(r-o,s-n);this._end.draw(t,s,r,a,this.getLineColor())}if(this._start){s=this._points[0].getX(),r=this._points[0].getY(),n=this._points[1].getX(),o=this._points[1].getY(),a=Math.atan2(r-o,s-n);this._start.draw(t,s,r,a,this.getLineColor())}if(this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)};var InterfaceUse=function(t){t=t||{},InterfaceUse.baseConstructor.call(this,t)};JSFun.extend(InterfaceUse,Relation),InterfaceUse.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},InterfaceUse.prototype.setName=function(t){this._components[1].setValue(t)},InterfaceUse.prototype.getStereotypes=function(){return this._components[0]._childs},InterfaceUse.prototype.getName=function(){return this._components[1].getValue()},InterfaceUse.prototype.getNameAsComponent=function(){return this._components[1]};var NAssociation=function(t){t=t||{},NAssociation.baseConstructor.call(this,t)};JSFun.extend(NAssociation,Rhombus),NAssociation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NAssociation.prototype.setName=function(t){this._components[1].setValue(t)},NAssociation.prototype.setRole=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentRoleA(e)},NAssociation.prototype.setMultiplicity=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentMultiplicityA(e)},NAssociation.prototype.getStereotypes=function(){return this._components[0]._childs},NAssociation.prototype.getName=function(){return this._components[1].getValue()},NAssociation.prototype.getRole=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._roleA)return this._relations[i]._roleA.getValue()},NAssociation.prototype.getMultiplicity=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._multiA)return this._relations[i]._multiA.getValue()},NAssociation.prototype.getNameAsComponent=function(){return this._components[1]},NAssociation.prototype.getRelations=function(){return this._relations},NAssociation.prototype.setElements=function(t,e){if(!(t instanceof Array))return t instanceof Node&&e instanceof Node&&(relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),relation=new AssociationN({a:e,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t[0]&&t[1]){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.notifyChange(),!0}return!1},NAssociation.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i]},NAssociation.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return!1;return relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0},NAssociation.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i].remove(),!0;return!1};var AssociationN=function(t){t=t||{};var e=new Relation(t);return e.setType("AssociationN"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentMultiplicityA(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},NodeInterface=function(t){t=t||{},this._abstract=!1,NodeInterface.baseConstructor.call(this,t)};JSFun.extend(NodeInterface,Elliptical),NodeInterface.prototype.draw=function(t){var e;this._relations.length;for(e in this._relations)if("UMLInterfaceRealization"==this._relations[e].getType()||"UMLInterfaceUsage"==this._relations[e].getType()){!0;break}NodeInterface.base.draw.call(this,t),this._selected&&this.drawComponentsShape(t)},NodeInterface.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NodeInterface.prototype.setName=function(t){this._components[1].setValue(t)},NodeInterface.prototype.getStereotypes=function(){return this._components[0]._childs},NodeInterface.prototype.getName=function(){return this._components[1].getValue()},NodeInterface.prototype.getStereotype=function(){return this._components[0]},NodeInterface.prototype.getNameAsComponent=function(){return this._components[1]},NodeInterface.prototype.getElementXML=function(t){var e=NodeInterface.base.getElementXML.call(this,t);return e.setAttribute("abstract",this.isAbstract()),e},NodeInterface.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),NodeInterface.base.setElementXML.call(this,t)},NodeInterface.prototype.isAbstract=function(){return this._abstract},NodeInterface.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")};var NodePorts=function(t){t=t||{},this._abstract=!1,NodePorts.baseConstructor.call(this,t),this._ports=[]};JSFun.extend(NodePorts,Node),NodePorts.prototype.addPort=function(t){t instanceof Node&&"UMLPort"==t.getType()&&(this._ports.push(t),this._diagram._addNode(t),t.setParent(this),t.correctPosition())},NodePorts.prototype.setSelectedFigure=function(t){if(NodePorts.base.setSelectedFigure.call(this,t))if(this._figures[t]instanceof FromImageFigure)for(i in this._ports)this._ports[i].setVisibility(!1);else for(i in this._ports)this._ports[i].setVisibility(!0)},NodePorts.prototype.setVisibility=function(t){NodePorts.base.setVisibility.call(this,t);var e=!0;if(this._selectedFigure&&t&&(e=!1),this._container&&e)for(i in this._ports)this._ports[i].setVisibility(t)},NodePorts.prototype.updatePosition=function(t,e){if(void 0==t&&void 0==e)var i=this.getMovement(),n=i.getX(),o=i.getY();else n=t,o=e;var s;for(s in this._ports)this._ports[s].updatePosition(n,o);NodePorts.base.updatePosition.call(this,t,e)},NodePorts.prototype.notifyChange=function(){var t;NodePorts.base.notifyChange.call(this);for(t in this._ports)this._ports[t].correctPosition(),this._ports[t].notifyChange()},NodePorts.prototype.updateContainer=function(){NodePorts.base.updateContainer.call(this);for(i in this._ports)this._ports[i].correctPosition(),this._ports[i].notifyChange()},NodePorts.prototype.remove=function(){var t;NodePorts.base.remove.call(this);for(t in this._ports)this._ports[t].remove()},NodePorts.prototype.getElementXML=function(t){var e,i=NodePorts.base.getElementXML.call(this,t);i.setAttribute("abstract",this.isAbstract());for(e in this._ports)i.appendChild(this._ports[e].getElementXML(t));return i},NodePorts.prototype.setElementXML=function(t){this.setAbstract(t.getAttribute("abstract")),NodePorts.base.setElementXML.call(this,t)},NodePorts.prototype.addChild=function(t){if(t instanceof Port)return this._ports.push(t),t.setParent(this),void t.correctPosition();NodePorts.base.addChild.call(this,t)},NodePorts.prototype.notifyDeleted=function(t){var e;if(t instanceof Port)for(e in this._ports)this._ports[e]==t&&this._ports.splice(e,1);else NodePorts.base.notifyDeleted.call(this,t)},NodePorts.prototype.addStereotype=function(t){t=t||"";this._components[2].addField("«"+t+"»")},NodePorts.prototype.setName=function(t){this._components[3].setValue(t)},NodePorts.prototype.addInterface=function(t){t=t||"";this._components[4].addField(t)},NodePorts.prototype.addRealization=function(t){t=t||"";this._components[5].addField(t)},NodePorts.prototype.addArtifact=function(t){t=t||"";this._components[6].addField(t)},NodePorts.prototype.getStereotypes=function(){return this._components[2]._childs},NodePorts.prototype.getName=function(){return this._components[3].getValue()},NodePorts.prototype.getInterfaces=function(){return this._components[4]._childs},NodePorts.prototype.getRealizations=function(){return this._components[5]._childs},NodePorts.prototype.getArtifacts=function(){return this._components[6]._childs},NodePorts.prototype.getStereotype=function(){return this._components[2]},NodePorts.prototype.getNameAsComponent=function(){return this._components[3]},NodePorts.prototype.isAbstract=function(){return this._abstract},NodePorts.prototype.setAbstract=function(t){this._abstract=t,1==this._abstract?this.getNameAsComponent().setFontStyle("italic"):"italic"==this.getNameAsComponent().getFontStyle()&&this.getNameAsComponent().setFontStyle("normal")},NodePorts.prototype.getPorts=function(){return this._ports};var Package=function(t){t=t||{},Package.baseConstructor.call(this,t)};JSFun.extend(Package,Rectangular),Package.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},Package.prototype.setName=function(t){this._components[2].setValue(t)},Package.prototype.getStereotypes=function(){return this._components[1]._childs},Package.prototype.getName=function(){return this._components[2].getValue()},Package.prototype.getStereotype=function(){return this._components[1]},Package.prototype.getNameAsComponent=function(){return this._components[2]};var PackageContainer=function(t){t=t||{},PackageContainer.baseConstructor.call(this,t)};JSFun.extend(PackageContainer,Rectangular),PackageContainer.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},PackageContainer.prototype.setName=function(t){this._components[1].setValue(t)},PackageContainer.prototype.getStereotypes=function(){return this._components[0]._childs},PackageContainer.prototype.getName=function(){return this._components[1].getValue()},PackageContainer.prototype.getStereotype=function(){return this._components[0]},PackageContainer.prototype.getNameAsComponent=function(){return this._components[1]};var Realization=function(t){t=t||{},Realization.baseConstructor.call(this,t)};JSFun.extend(Realization,Relation),Realization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Realization.prototype.setName=function(t){this._components[1].setValue(t)},Realization.prototype.getStereotypes=function(){return this._components[0]._childs},Realization.prototype.getName=function(){return this._components[1].getValue()},Realization.prototype.getNameAsComponent=function(){return this._components[1]};var UMLComponentDiagram=function(t){var e=new ComponentDiagram(t);return e.setType("UMLComponentDiagram"),e.setName("Component diagram"),e.setValidElements(["UMLNote","UMLLine","UMLArtifact","UMLClass","UMLComComponent","UMLComposition","UMLInterface","UMLInterfaceExtended","UMLInterfaceUsage","UMLInterfaceRealization","UMLPort","UMLGeneralization","UMLGeneralizationSet","SetLine","UMLDependency","UMLRealization","UMLInterfaceExtended","UMLConnector","UMLNAssociation","UMLAssociation","UMLInterfaceUse","UMLPackage","UMLPackageContainer"]),e},UMLPackage=function(t){var e=new Package(t=t||{});return e.setType("UMLPackage"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(100),e.setHeight(50),e.addFigure(new PackageFigure({color:"#c0e1c2"})),e.addComponent(new Space({height:16})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Package name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLPackageContainer=function(t){var e=new PackageContainer(t=t||{});return e.setType("UMLPackageContainer"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(75),e.setMoveable(),e.setContainer(),e.addFigure(new RectangleFigure({color:"#bdd8e5"})),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",margin:5,text:"Package name"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLComComponent=function(t){var e=new NodePorts(t=t||{});return e.setType("UMLComComponent"),setStereotypeProperties(e,t.stereotypes||[]),e.setContainer(),e.setMoveable(),e.setWidth(150),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new ComponentSymbol({position:Component.TopRight,margin:3})),e.addComponent(new Text({text:"«component»",centered:!0})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Component Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"interfaces",text:"new_interface",visibleSubComponents:!1,margin:3})),e.addComponent(new AttributeFields({id:"realizations",text:"new_realization",visibleSubComponents:!1,margin:3})),e.addComponent(new AttributeFields({id:"artifacts",text:"new_artifact",visibleSubComponents:!1,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new OperationFields({id:"operations",visibleSubComponents:!1,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLClass=function(t){var e=new Class(t=t||{});return e.setType("UMLClass"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"ClassName",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",margin:3})),e.addComponent(new OperationFields({id:"operations",margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLArtifact=function(t){var e=new Artifact(t=t||{});return e.setType("UMLArtifact"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new Text({text:"«artifact»",centered:!0,margin:3})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Artifact Name",centered:!0,margin:3})),e.getNameAsComponent().setUnderlineText(!0),e.addComponent(new PropertyFields({id:"properties",visibleSubComponents:!1,margin:3})),e.addComponent(new ArtifactSymbol({position:Component.TopRight,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLInterface=function(t){var e=new NodeInterface(t=t||{});return e.setType("UMLInterface"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(16),e.setHeight(16),e.addFigure(new EllipseFigure({color:"#67ac88"})),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLInterfaceExtended=function(t){var e=new InterfaceExtended(t=t||{});return e.setType("UMLInterfaceExtended"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(150),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new CircleSymbol({position:Component.TopRight,margin:3})),e.addComponent(new TextArea({id:"name",text:"Interface Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new OperationFields({id:"methods",visibleSubComponents:!1,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.setAbstract(!e.isAbstract()),e.removeContextualMenu()},"Change abstract property"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLInterfaceUsage=function(t){var e=new InterfaceUsage(t);return e.setType("UMLInterfaceUsage"),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new InterfaceUsageEnd),e},UMLInterfaceRealization=function(t){var e=new InterfaceRealization(t);return e.setType("UMLInterfaceRealization"),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e},UMLConnector=function(t){var e=new ConnectorRelation(t);return e.setType("UMLConnector"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e},UMLPort=function(t){var e=new Port(t=t||{});return e.setType("UMLPort"),setStereotypeProperties(e,t.stereotypes||[]),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLGeneralization=function(t){var e=new Generalization(t);return e.setType("UMLGeneralization"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new CloseTip),e},UMLGeneralizationSet=function(t){var e=new GeneralizationSet(t);return e.setType("UMLGeneralizationSet"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.addComponentStereotype(),e.setComponentName(),e},UMLDependency=function(t){var e=new Dependency(t);return e.setType("UMLDependency"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLAssociation=function(t){var e=new Association(t);return e.setType("UMLAssociation"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentRoleB(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},UMLNAssociation=function(t){var e=new NAssociation(t=t||{});return e.setMoveable(),setStereotypeProperties(e,t.stereotypes||[]),e.setType("UMLNAssociation"),e.addFigure(new RhombusFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:" ",centered:!0,margin:3})),e},UMLInterfaceUse=function(t){var e=new InterfaceUse(t);return e.setType("UMLInterfaceUse"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},Artifact=function(t){t=t||{},Artifact.baseConstructor.call(this,t)};JSFun.extend(Artifact,Rectangular),Artifact.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},Artifact.prototype.setName=function(t){this._components[2].setValue(t)},Artifact.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},Artifact.prototype.addOperation=function(t){t=t||"";this._components[4].addField(t)},Artifact.prototype.getStereotypes=function(){return this._components[1]._childs},Artifact.prototype.getName=function(){return this._components[2].getValue()},Artifact.prototype.getStereotype=function(){return this._components[1]},Artifact.prototype.getNameAsComponent=function(){return this._components[2]},Artifact.prototype.getAttributes=function(){return this._components[3]._childs},Artifact.prototype.getOperations=function(){return this._components[4]._childs};var Association=function(t){t=t||{},Association.baseConstructor.call(this,t)};JSFun.extend(Association,Relation),Association.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Association.prototype.setName=function(t){this._components[1].setValue(t)},Association.prototype.setRoleA=function(t){this._components[2].setValue(t)},Association.prototype.setRoleB=function(t){this._components[3].setValue(t)},Association.prototype.setMultiplicityA=function(t){this._components[4].setValue(t)},Association.prototype.setMultiplicityB=function(t){this._components[5].setValue(t)},Association.prototype.getStereotypes=function(){return this._components[0]._childs},Association.prototype.getName=function(){return this._components[1].getValue()},Association.prototype.getRoleA=function(){return this._components[2].getValue()},Association.prototype.getRoleB=function(){return this._components[3].getValue()},Association.prototype.getMultiplicityA=function(){return this._components[4].getValue()},Association.prototype.getMultiplicityB=function(){return this._components[5].getValue()},Association.prototype.getNameAsComponent=function(){return this._components[1]};var Dependency=function(t){t=t||{},Dependency.baseConstructor.call(this,t)};JSFun.extend(Dependency,Relation),Dependency.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Dependency.prototype.setName=function(t){this._components[1].setValue(t)},Dependency.prototype.getStereotypes=function(){return this._components[0]._childs},Dependency.prototype.getName=function(){return this._components[1].getValue()},Dependency.prototype.getNameAsComponent=function(){return this._components[1]};var DeploymentDiagram=function(t){DeploymentDiagram.baseConstructor.call(this,t)};JSFun.extend(DeploymentDiagram,Diagram),DeploymentDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},DeploymentDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var DeploymentSpecification=function(t){t=t||{},DeploymentSpecification.baseConstructor.call(this,t)};JSFun.extend(DeploymentSpecification,Rectangular),DeploymentSpecification.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},DeploymentSpecification.prototype.setName=function(t){this._components[2].setValue(t)},DeploymentSpecification.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},DeploymentSpecification.prototype.getStereotypes=function(){return this._components[1]._childs},DeploymentSpecification.prototype.getName=function(){return this._components[2].getValue()},DeploymentSpecification.prototype.getStereotype=function(){return this._components[1]},DeploymentSpecification.prototype.getNameAsComponent=function(){return this._components[2]},DeploymentSpecification.prototype.getAttribute=function(){return this._components[3]._childs};var Generalization=function(t){t=t||{},Generalization.baseConstructor.call(this,t)};JSFun.extend(Generalization,Relation),Generalization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Generalization.prototype.setName=function(t){this._components[1].setValue(t)},Generalization.prototype.getStereotypes=function(){return this._components[0]._childs},Generalization.prototype.getName=function(){return this._components[1].getValue()},Generalization.prototype.getNameAsComponent=function(){return this._components[1]};var GeneralizationSet=function(t){t=t||{},this._pivotP=2,GeneralizationSet.baseConstructor.call(this)};JSFun.extend(GeneralizationSet,Relation),GeneralizationSet.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},GeneralizationSet.prototype.setName=function(t){this._components[1].setValue(t)},GeneralizationSet.prototype.getStereotypes=function(){return this._components[0]._childs},GeneralizationSet.prototype.getName=function(){return this._components[1].getValue()},GeneralizationSet.prototype.getNameAsComponent=function(){return this._components[1]},GeneralizationSet.prototype.getRelations=function(){return this._relations},GeneralizationSet.prototype.setElements=function(t,e){if(!(t instanceof Array))return!!GeneralizationSet.base.setElements.call(this,t,e)&&(this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t.length>1){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),this._calculateLineEnds(),!0}return!1},GeneralizationSet.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i]},GeneralizationSet.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t||this._relations[i]._elemB==t)return!1;relation=new SetLine({a:t,b:this}),relation._calculateLineEnds();var e=new Point(relation.getCentralPoint());return this._points.splice(this._pivotP,0,e),relation._calculateLineEnds(),relation._points[2]=this._points[this._pivotP],this._pivotP++,this.notifyChange(),!0},GeneralizationSet.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i].remove(),!0;return!1},GeneralizationSet.prototype.notifyDeleted=function(t){for(i=0;i<this._relations.length;i++)this._relations[i]===t&&"SetLine"==this._relations[i].getType()&&(this._relations.splice(i,1),this._pivotP--,this._points.splice(2+i,1))},GeneralizationSet.prototype._calculateLineEnds=function(){var t,e,n=this._points.length;if(this._points[3]||(t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e),this._elemA==this._elemB){var o,s,r=this._elemA.getCentralPoint(),a=r.getX(),h=r.getY(),p=this._points[2]?this._points[2]._x:this._elemA._x+this._elemA._width,l=this._points[2]?this._points[2]._y:this._elemA._y+this._elemA._height;if(2==this._selected||0==this._selected||this._selected==n-1||-1==this._selected&&!this._elemA._moved||this._elemA._resizing)p-a>0?l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()+s,t.getY()+o),this._points[3]=new Point(e.getX()+s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()+s,t.getY()-o),this._points[3]=new Point(e.getX()+s,h)):l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()-s,t.getY()+o),this._points[3]=new Point(e.getX()-s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()-s,t.getY()-o),this._points[3]=new Point(e.getX()-s,h));else if(3==this._selected)p=this._points[3]._x,l=this._points[3]._y,t=this._elemA.getLinkCentered(a,this._points[0]._y),p-a>0?(s=(s=p-(e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h)).getX())<20?20:s,this._points[2].setX(e.getX()+s),this._points[3]=new Point(e.getX()+s,h)):(s=(s=(e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h)).getX()-p)<20?20:s,this._points[2].setX(e.getX()-s),this._points[3]=new Point(e.getX()-s,h));else if(1==this._selected)p=this._points[1]._x,l=this._points[1]._y,e=this._elemA.getLinkCentered(this._points[4]._x,h),l-h>0?(o=(o=l-(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2)).getY())<20?20:o,this._points[1]=new Point(a,t.getY()+o),this._points[2].setY(t.getY()+o)):(o=(o=(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2)).getY()-l)<20?20:o,this._points[1]=new Point(a,t.getY()-o),this._points[2].setY(t.getY()-o));else if(2==this._selected){var _=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}else if(-1==this._selected){_=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}for(this._points[0]=t,this._points[4]=e;this._points[5];)this._points.pop()}else if(4==n)t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[3]=e;else if(n>4){for(t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[this._points.length-1]=e,i=0;i<this._relations.length;i++)this._relations[i]._calculateLineEnds();if(this._orientation){for(i=1;i<this._pivotP;i++)this._points[i].setX(this._points[this._pivotP].getX());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setY(this._points[1].getY()+5)}else{for(i=1;i<this._pivotP;i++)this._points[i].setY(this._points[this._pivotP].getY());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setX(this._points[1].getX()+5)}}else t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e},GeneralizationSet.prototype._delUselessPoints=function(){var t;for(t=this._points.length-1;t>this._pivotP;t--)this._selectLine(this._points[t+1],this._points[t-1],this._points[t].getX(),this._points[t].getY(),10)&&this._points.splice(t,1)},GeneralizationSet.prototype.draw=function(t){var e,i=this._points.length,n=[];for(e=this._pivotP;e<i;e++)n.push(this._points[e]);if(this._line&&this._line.draw(t,n,this.getLineColor(),this.getLineWidth()),this._end){var o=this._points[i-2].getX(),s=this._points[i-2].getY(),r=this._points[i-1].getX(),a=this._points[i-1].getY(),h=Math.atan2(a-s,r-o);this._end.draw(t,r,a,h,this.getLineColor())}if(this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);for(n=[],e=1;e<=this._pivotP;e++)n.push(this._points[e]);if(n.length>1){if("solid"==this.getLineStyle())var p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth())}if((n=[])[0]=this._points[0],n[1]=this._points[1],n[2]=this._points[this._pivotP],"solid"==this.getLineStyle())p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth()),this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)},GeneralizationSet.prototype.select=function(t,e){this._deselectComponent();var i=this._diagram._touch?4:0;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var n=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=n?e-n+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(o=0;o<this._points.length;o++)if(Math.abs(t-this._points[o].getX())<=4&&Math.abs(e-this._points[o].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedPoint=!0,this._component=!1,!0;if(this._selected>-1&&this._isOverComponent(t,e,i))return this._selectedBefore=!0,this._component=!0,!0;for(var o=0;o<this._points.length-1;o++)if(this._selectLine(this._points[o],this._points[o+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,o>=this._pivotP?(this._selectedLine=!0,this._component=!1,this._points.splice(this._selected,0,new Point(t,e))):o>=1?(this._selectedPoint=!0,this._component=!1,this._selected=this._pivotP):(this._selectedPoint=!0,this._component=!1,this._selected=1),!0;return!1},GeneralizationSet.prototype._calculateOrientation=function(){var t=(this._elemA.getCentralPoint().getY()-this._elemB.getCentralPoint().getY())/(this._elemA.getCentralPoint().getX()-this._elemB.getCentralPoint().getX());return t<1&&t>-1},GeneralizationSet.prototype.isXOriented=function(){return this._orientation},GeneralizationSet.prototype.isYOriented=function(){return!this._orientation},GeneralizationSet.prototype.setXOrientation=function(){this._orientation=!0},GeneralizationSet.prototype.setYOrientation=function(){this._orientation=!1},GeneralizationSet.prototype.getOrientation=function(){return this._orientation?"x":"y"},GeneralizationSet.prototype.setLineStyle=function(t){if(!GeneralizationSet.base.setLineStyle.call(this,t))return!1;for(i in this._relations)if("SetLine"==this._relations[i].getType()&&!this._relations[i].setLineStyle(t))return!1;return!0},GeneralizationSet.prototype.setLineColor=function(t){GeneralizationSet.base.setLineColor.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineColor(t)},GeneralizationSet.prototype.setLineWidth=function(t){GeneralizationSet.base.setLineWidth.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineWidth(t)};var SetLine=function(t){t=t||{},this._last=null,this._id=0,this._type="SetLine",this._line_color="#000000",this._line_width=1.25,this._points=[new Point,new Point],this._selected=-1,this._selectedBefore=!1,this._moved=!1,this._activeComponent=null,this._selectedLine=!1,this._selectedPoint=!1,this._relations=[],this._components=[],this._diagram=null,this.setElements(t.a,t.b),f=this,this._elemB&&(this.setMenu([[function(){f._elemB.showStyleDialog({that:f._elemB}),f._elemB.removeContextualMenu()},"Style"]]),this.setLineStyle(this._elemB.getLineStyle()),this.setLineColor(this._elemB.getLineColor()),this.setLineWidth(this._elemB.getLineWidth()))};JSFun.extend(SetLine,Relation),SetLine.prototype._delUselessPoints=function(){},SetLine.prototype.select=function(t,e){this._deselectComponent();this._diagram._touch;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.setType("SetLine"),this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var i=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=i?e-i+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(var n=0;n>this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedLine=!0,this._component=!1,!0;for(n=0;n<this._points.length;n++)if(Math.abs(t-this._points[n].getX())<=4&&Math.abs(e-this._points[n].getY())<=4)return 2!=n&&(this._selected>-1&&(this._selectedBefore=!0),this._selected=n,this._selectedPoint=!0,this._component=!1,!0);for(n=0;n<this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedPoint=!0,this._component=!1,!0;return!1},SetLine.prototype._calculateLineEnds=function(){if(!this._elemB)return!1;var t=this._points[1];if(this._elemB._orientation)if(this._points.length<3){t=new Point(this._elemB._points[1].getX(),this._elemA.getCentralPoint().getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getY()<this._elemA.getY()?this._points[2].setY(this._elemA.getY()-20):this._points[2].setY(this._elemA.getY()+this._elemA.getHeight()+20)),this._points[0].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[2].getX()<=this._elemA.getX()?(this._points[0].setX(this._elemA.getX()),this._points[1].setX(this._elemA.getX()-10)):this._points[2].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[0].getX()<=this._elemA.getX()&&(this._points[0].setX(this._elemA.getX()+this._elemA.getWidth()),this._points[1].setX(this._elemA.getX()+this._elemA.getWidth()+10));else if(this._points.length<3){t=new Point(this._elemA.getCentralPoint().getX(),this._elemB._points[1].getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getX()<this._elemA.getX()?this._points[2].setX(this._elemA.getX()-20):this._points[2].setX(this._elemA.getX()+this._elemA.getWidth()+20)),this._points[0].getY()<=this._elemA.getY()&&this._points[2].getY()>this._elemA.getY()+this._elemA.getHeight()?(this._points[0].setY(this._elemA.getY()+this._elemA.getHeight()),this._points[1].setY(this._elemA.getY()+this._elemA.getHeight()+10)):this._points[0].getY()>=this._elemA.getY()+this._elemA.getHeight()&&this._points[2].getY()<=this._elemA.getY()&&(this._points[0].setY(this._elemA.getY()),this._points[1].setY(this._elemA.getY()-10));this._points.length<3&&(this._points[1]=t,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=t),this._points[0]=this._elemA.getLinkCentered(this._points[1])},SetLine.prototype.setElementXML=function(t,e){var i,n=t.getAttribute("side_A"),o=e[t.getAttribute("side_B")],s=e[n];if(!(o instanceof GeneralizationSet))return null;o.addElement(s),relation=o._relations[o._relations.length-1],this.setId(t.getAttribute("id"));var r=t.childNodes,a=0;for(i=0;i<r.length;i++)"point"==r[i].nodeName&&(this._points[a]=new Point(parseInt(r[i].getAttribute("x")),parseInt(r[i].getAttribute("y"))),a++);o.delElement(s),this.setLineStyle(o.getLineStyle()),this.setLineColor(o.getLineColor()),this.setLineWidth(o.getLineWidth()),this._type="SetLine",this._elemA=s,this._elemB=o,o._relations.splice(o._relations.length-1,1,this),this._points[2]=o._points[o._pivotP],o._pivotP++,o.notifyChange(),s.addRelation(this)};var InstanceArtifact=function(t){t=t||{},InstanceArtifact.baseConstructor.call(this,t)};JSFun.extend(InstanceArtifact,Rectangular),InstanceArtifact.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},InstanceArtifact.prototype.setName=function(t){this._components[2].setValue(t)},InstanceArtifact.prototype.addAttribute=function(t){t=t||"";this._components[3].addField(t)},InstanceArtifact.prototype.getStereotypes=function(){return this._components[1]._childs},InstanceArtifact.prototype.getName=function(){return this._components[2].decode(this._components[2].getValue())[0]},InstanceArtifact.prototype.getAttributes=function(){return this._components[3]._childs},InstanceArtifact.prototype.getStereotype=function(){return this._components[1]},InstanceArtifact.prototype.getNameAsComponent=function(){return this._components[2]};var NAssociation=function(t){t=t||{},NAssociation.baseConstructor.call(this,t)};JSFun.extend(NAssociation,Rhombus),NAssociation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NAssociation.prototype.setName=function(t){this._components[1].setValue(t)},NAssociation.prototype.setRole=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentRoleA(e)},NAssociation.prototype.setMultiplicity=function(t,e){for(i in this._relations)this._relations[i]._elemA==t&&this._relations[i].setComponentMultiplicityA(e)},NAssociation.prototype.getStereotypes=function(){return this._components[0]._childs},NAssociation.prototype.getName=function(){return this._components[1].getValue()},NAssociation.prototype.getRole=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._roleA)return this._relations[i]._roleA.getValue()},NAssociation.prototype.getMultiplicity=function(t){for(i in this._relations)if(this._relations[i]._elemA==t&&this._relations[i]._multiA)return this._relations[i]._multiA.getValue()},NAssociation.prototype.getNameAsComponent=function(){return this._components[1]},NAssociation.prototype.getRelations=function(){return this._relations},NAssociation.prototype.setElements=function(t,e){if(!(t instanceof Array))return t instanceof Node&&e instanceof Node&&(relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),relation=new AssociationN({a:e,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t[0]&&t[1]){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.notifyChange(),!0}return!1},NAssociation.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i]},NAssociation.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return!1;return relation=new AssociationN({a:t,b:this}),relation._calculateLineEnds(),relation.updateParent(),this.notifyChange(),!0},NAssociation.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t)return this._relations[i].remove(),this._relations.length>=2&&(t==this._elemA||t==this._elemB)?(this._elemA=this._relations[0]._elemA,this._elemB=this._relations[1]._elemA):this._relations.length<2&&this.remove(),!0;return!1};var AssociationN=function(t){t=t||{};var e=new Relation(t);return e.setType("AssociationN"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentMultiplicityA(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},NodeElement=function(t){t=t||{},NodeElement.baseConstructor.call(this,t)};JSFun.extend(NodeElement,Cube),NodeElement.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NodeElement.prototype.setName=function(t){this._components[1].setValue(t)},NodeElement.prototype.getStereotypes=function(){return this._components[0]._childs},NodeElement.prototype.getName=function(){return this._components[1].getValue()},NodeElement.prototype.getStereotype=function(){return this._components[0]},NodeElement.prototype.getNameAsComponent=function(){return this._components[1]};var NodeTextNotation=function(t){t=t||{},NodeTextNotation.baseConstructor.call(this,t)};JSFun.extend(NodeTextNotation,Cube),NodeTextNotation.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},NodeTextNotation.prototype.setName=function(t){this._components[1].setValue(t)},NodeTextNotation.prototype.getStereotypes=function(){return this._components[0]._childs},NodeTextNotation.prototype.getName=function(){return this._components[1].getValue()},NodeTextNotation.prototype.getStereotype=function(){return this._components[0]},NodeTextNotation.prototype.getNameAsComponent=function(){return this._components[1]},NodeTextNotation.prototype.getArtifacts=function(){return this._components[2]._childs},NodeTextNotation.prototype.addArtifact=function(t){t=t||"";this._components[2].addField(t)};var UMLDeploymentDiagram=function(t){var e=new DeploymentDiagram(t);return e.setType("UMLDeploymentDiagram"),e.setName("Deployment diagram"),e.setValidElements(["UMLNote","UMLLine","UMLAssociation","UMLDependency","UMLGeneralization","UMLGeneralizationSet","SetLine","UMLNAssociation","AssociationN","UMLArtifact","UMLInstance","UMLNode","UMLNodeTextNotation","UMLDeploymentSpecification","UMLManifestation","UMLDeployment"]),e},UMLInstanceArtifact=function(t){var e=new InstanceArtifact(t=t||{});return e.setType("UMLInstance"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new Text({text:"«artifact»",centered:!0,margin:3})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Artifact Name",centered:!0,margin:3})),e.getNameAsComponent().setUnderlineText(!0),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new ArtifactSymbol({position:Component.TopRight,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLArtifact=function(t){var e=new Artifact(t=t||{});return e.setType("UMLArtifact"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new Text({text:"«artifact»",centered:!0,margin:3})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Artifact Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.addComponent(new OperationFields({id:"operations",visibleSubComponents:!1,margin:3})),e.addComponent(new ArtifactSymbol({position:Component.TopRight,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLNode=function(t){var e=new NodeElement(t=t||{});return e.setType("UMLNode"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(75),e.setMoveable(),e.setContainer(),e.addFigure(new CubeFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Node name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLNodeTextNotation=function(t){var e=new NodeTextNotation(t=t||{});return e.setType("UMLNodeTextNotation"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(75),e.setMoveable(),e.addFigure(new CubeFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Node name",centered:!0,margin:3})),e.addComponent(new ArtifactFields({id:"artifacts",margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLDeploymentSpecification=function(t){var e=new DeploymentSpecification(t=t||{});return e.setType("UMLDeploymentSpecification"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new Text({text:"«deployment spec»",centered:!0,margin:3})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",visibleSubComponents:!1,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLAssociation=function(t){var e=new Association(t);return e.setType("UMLAssociation"),e.addComponentStereotype(),e.setComponentName(),e.setComponentRoleA(),e.setComponentRoleB(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},UMLDependency=function(t){var e=new Dependency(t);return e.setType("UMLDependency"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLGeneralization=function(t){var e=new Generalization(t);return e.setType("UMLGeneralization"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.addComponentStereotype(),e.setComponentName(),e.setLine(new SolidLine),e.setEnd(new CloseTip),e},UMLNAssociation=function(t){var e=new NAssociation(t=t||{});return e.setMoveable(),setStereotypeProperties(e,t.stereotypes||[]),e.setType("UMLNAssociation"),e.addFigure(new RhombusFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:" ",centered:!0,margin:3})),e},UMLGeneralizationSet=function(t){var e=new GeneralizationSet(t=t||{});return e.setType("UMLGeneralizationSet"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e},UMLManifestation=function(t){var e=new Relation(t);return e.setType("UMLManifestation"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«manifest»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLDeployment=function(t){var e=new Relation(t);return e.setType("UMLDeployment"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«deploy»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},Line=function(t){t=t||{},Line.baseConstructor.call(this,t)};JSFun.extend(Line,Relation),Line.prototype.draw=function(t){var e;this._points.length;if(this._line&&this._line.draw(t,this._points,this.getLineColor(),this.getLineWidth()),this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)};var Note=function(t){t=t||{},Note.baseConstructor.call(this,t)};JSFun.extend(Note,Rectangular),Note.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Note.prototype.setName=function(t){this._components[1].setValue(t)},Note.prototype.getStereotypes=function(){return this._components[0]._childs},Note.prototype.getName=function(){return this._components[1].getValue()},Note.prototype.getNameAsComponent=function(){return this._components[1]};var UMLNote=function(t){var e=new Note(t);return e.setType("UMLNote"),e.setMoveable(),e.setWidth(100),e.setHeight(50),e.addFigure(new NoteFigure({color:"#ffffbb"})),e.addComponent(new StereotypeFields({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"description",text:"Note",centered:!0,margin:5})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e},UMLLine=function(t){var e=new Line(t);return e.setType("UMLLine"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e},Instance=function(t){t=t||{},Instance.baseConstructor.call(this,t)};JSFun.extend(Instance,Rectangular),Instance.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Instance.prototype.setName=function(t){this._components[1].setValue(t)},Instance.prototype.addAttribute=function(t){t=t||"";this._components[2].addField(t)},Instance.prototype.getStereotypes=function(){return this._components[0]._childs},Instance.prototype.getName=function(){return this._components[1].decode(this._components[1].getValue())[0]},Instance.prototype.getAttributes=function(){return this._components[2]._childs},Instance.prototype.getStereotype=function(){return this._components[0]},Instance.prototype.getNameAsComponent=function(){return this._components[1]},Instance.prototype.getNameAsComponent=function(){return this._components[1]};var InstanceDiagram=function(t){InstanceDiagram.baseConstructor.call(this,t)};JSFun.extend(InstanceDiagram,Diagram),InstanceDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},InstanceDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var Link=function(t){t=t||{},Link.baseConstructor.call(this,t)};JSFun.extend(Link,Relation),Link.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Link.prototype.setName=function(t){this._components[1].setValue(t)},Link.prototype.setMultiplicityA=function(t){this._components[2].setValue(t)},Link.prototype.setMultiplicityB=function(t){this._components[3].setValue(t)},Link.prototype.getStereotypes=function(){return this._components[0]._childs},Link.prototype.getName=function(){return this._components[1].decode(this._components[1].getValue())[0]},Link.prototype.getMultiplicityA=function(){return this._components[2].getValue()},Link.prototype.getMultiplicityB=function(){return this._components[3].getValue()},Link.prototype.getNameAsComponent=function(){return this._components[1]};var UMLInstanceDiagram=function(t){var e=new InstanceDiagram(t);return e.setType("UMLInstanceDiagram"),e.setName("Instance diagram"),e.setValidElements(["UMLNote","UMLLine","UMLInstance","UMLLink"]),e},UMLLink=function(t){var e=new Link(t);e.setType("UMLLink"),e.addComponentStereotype();var i=new InstanceItem({id:"name",centered:!0,margin:3});return e._addComponent(i),e._name=i,e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){e.showDirectionDialog({that:e}),e.removeContextualMenu()},"Navegability"]]),e.setLine(new SolidLine),e},UMLInstance=function(t){var e=new Instance(t=t||{});return e.setType("UMLInstance"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(50),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new InstanceItem({id:"name",centered:!0,margin:3})),e.addComponent(new AttributeFields({id:"attributes",margin:3})),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.getComponents()[0].setUnderlineText(!0),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},Model=function(t){Model.baseConstructor.call(this,t)};JSFun.extend(Model,Diagram),Model.prototype.addElement=function(t){this._addElementOnly(t)},Model.prototype.addRelationFromPoints=function(t,e,i,n,o){var s=this.getElementByPoint(e,i),r=this.getElementByPoint(n,o);return!!(s&&r&&t.setElements(s,r))&&(t.notifyChange(),this._addElementOnly(t))};var UMLModel=function(t){var e=new Model(t);return e.setType("UMLModel"),e.setName("Model"),e},Dependency=function(t){t=t||{},Dependency.baseConstructor.call(this,t)};JSFun.extend(Dependency,Relation),Dependency.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Dependency.prototype.setName=function(t){this._components[1].setValue(t)},Dependency.prototype.getStereotypes=function(){return this._components[0]._childs},Dependency.prototype.getName=function(){return this._components[1].getValue()},Dependency.prototype.getNameAsComponent=function(){return this._components[1]};var Package=function(t){t=t||{},Package.baseConstructor.call(this,t)};JSFun.extend(Package,Rectangular),Package.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},Package.prototype.setName=function(t){this._components[2].setValue(t)},Package.prototype.getStereotypes=function(){return this._components[1]._childs},Package.prototype.getName=function(){return this._components[2].getValue()},Package.prototype.getStereotype=function(){return this._components[1]},Package.prototype.getNameAsComponent=function(){return this._components[2]};var PackageContainer=function(t){t=t||{},PackageContainer.baseConstructor.call(this,t)};JSFun.extend(PackageContainer,Rectangular),PackageContainer.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},PackageContainer.prototype.setName=function(t){this._components[1].setValue(t)},PackageContainer.prototype.getStereotypes=function(){return this._components[0]._childs},PackageContainer.prototype.getName=function(){return this._components[1].getValue()},PackageContainer.prototype.getStereotype=function(){return this._components[0]},PackageContainer.prototype.getNameAsComponent=function(){return this._components[1]};var PackageDiagram=function(t){PackageDiagram.baseConstructor.call(this,t)};JSFun.extend(PackageDiagram,Diagram),PackageDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},PackageDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var UMLPackageDiagram=function(t){var e=new PackageDiagram(t);return e.setType("UMLPackageDiagram"),e.setName("Package diagram"),e.setValidElements(["UMLNote","UMLLine","UMLPackage","UMLPackageContainer","UMLPackageMerge","UMLPackagePublicImport","UMLPackagePrivateImport","UMLDependency"]),e},UMLPackage=function(t){var e=new Package(t=t||{});return e.setType("UMLPackage"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(100),e.setHeight(50),e.addFigure(new PackageFigure({color:"#c0e1c2"})),e.addComponent(new Space({height:16})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",text:"Package name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLPackageContainer=function(t){var e=new PackageContainer(t=t||{});return e.setType("UMLPackageContainer"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(75),e.setMoveable(),e.setContainer(),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",margin:5,text:"Package name"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLDependency=function(t){var e=new Dependency(t);return e.setType("UMLDependency"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackageMerge=function(t){var e=new Relation(t);return e.setType("UMLPackageMerge"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«merge»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackagePublicImport=function(t){var e=new Relation(t);return e.setType("UMLPackagePublicImport"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«import»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLPackagePrivateImport=function(t){var e=new Relation(t);return e.setType("UMLPackagePrivateImport"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setStereotype("«access»"),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},Extension=function(t){t=t||{},Extension.baseConstructor.call(this,t)};JSFun.extend(Extension,Relation),Extension.prototype.setElements=function(t,e){if(t instanceof Stereotype&&e instanceof Metaclass||e instanceof Stereotype&&t instanceof Metaclass)return t instanceof Element&&e instanceof Element&&(!(t instanceof Relation&&e instanceof Relation)&&(this._elemA&&this._elemA.delRelation(this),this._elemB&&this._elemB.delRelation(this),this._elemA=t instanceof Stereotype?t:e,this._elemB=e instanceof Metaclass?e:t,this._elemA.addRelation(this),this._elemB.addRelation(this),this.updateParent(),this._calculateLineEnds(),!0))},Extension.prototype.setElementA=function(t){"UMLStereotype"==t.getType()&&Extension.base.setElementA.call(this,t)},Extension.prototype.setElementB=function(t){"UMLMetaclass"==t.getType()&&Extension.base.setElementB.call(this,t)};var Metaclass=function(t){t=t||{},Metaclass.baseConstructor.call(this,t),this.setValidMetaclass(t.validMetaclass||[]),this._stereotypes=[],this.setDiagrams(t.diagrams||[])};JSFun.extend(Metaclass,Rectangular),Metaclass.prototype.setValidMetaclass=function(t){if(JSFun.isArray(t)){this._validMetaclassLibrary=["UMLActor","UMLUseCase","UMLUseCaseExtended","UMLSystem","UMLSubSystem","UMLLine","UMLClass","UMLComponent","UMLInterfaceExtended","UMLPackage","UMLPackageContainer","UMLComComponent","UMLInterface","UMLLifeline","UMLOption","UMLAlternative","UMLLoop","UMLBreak","UMLAcceptEventAction","UMLTimeEvent","UMLSendSignalAction","UMLAction","UMLObject","UMLActivity","UMLDataStore","UMLConnectorActivity","UMLHorizontalHierarchicalSwimlane","UMLVerticalHierarchicalSwimlane","UMLSimpleState","UMLCompositeState","UMLVerticalRegion","UMLPin","UMLParameterNode","UMLExpansionNode","UMLHorizontalRegion","UMLPort","UMLTerminate","UMLEntryPoint","UMLExitPoint","UMLJunction","UMLFlowFinal","UMLDataType"],this._validMetaclassApp=[];for(var e=0;e<t.length;e++)JSFun.isArray(t[e])&&2==t[e].length&&this.foundInArray(this._validMetaclassLibrary,t[e][1])&&this._validMetaclassApp.push(t[e]);this._validMetaclassApp=this._sortNamesMetaclass(this._validMetaclassApp)}},Metaclass.prototype._sortNamesMetaclass=function(t){return t.sort(function(t,e){return t[0]<e[0]?-1:t[0]>e[0]?1:0}),t},Metaclass.prototype.foundInArray=function(t,e){for(var i=0;i<t.length;i++)if(e==t[i])return!0;return!1},Metaclass.prototype.setDiagrams=function(t){this._diagrams=t},Metaclass.prototype.setName=function(t){this._components[1].setValue(t)},Metaclass.prototype.addRelation=function(t){Metaclass.base.addRelation.call(this,t),this._stereotypes.push(t._elemA),t._elemA._metaclass.push(this)},Metaclass.prototype.delRelation=function(t){Metaclass.base.delRelation.call(this,t),t._elemA.delMetaclass(this),this.delStereotype(t._elemA)},Metaclass.prototype.remove=function(){for(var t=this._relations,e=0;e<t.length;e++)t[e]._elemA.delMetaclass(this);Metaclass.base.remove.call(this)},Metaclass.prototype.notifyDeleted=function(t){var e;for(e in this._relations)this._relations[e]==t&&(this.delStereotype(t._elemA),t._elemA.delMetaclass(this),this._relations.splice(e,1))},Metaclass.prototype.delStereotype=function(t){var e;for(e in this._stereotypes)if(this._stereotypes[e]==t){this._stereotypes.splice(e,1);break}},Metaclass.prototype.getName=function(){for(var t=0;t<this._validMetaclassApp.length;t++)if(this._validMetaclassApp[t][0]==this._components[1].getValue())return this._validMetaclassApp[t][1]},Metaclass.prototype.getNameAsComponent=function(){for(var t=0;t<this._validMetaclassApp.length;t++)if(this._validMetaclassApp[t][0]==this._components[1])return this._components[1]};var MetaclassItem=function(t){t=t||{},MetaclassItem.baseConstructor.call(this,t)};JSFun.extend(MetaclassItem,TextBox),MetaclassItem.prototype.setText=function(t){if(JSFun.isString(t)){if(this._text!=t){var e=this._parent?this._parent._diagrams:[],i=[];for(var n in e){i=e[n]._nodes;for(var o=0;o<i.length;o++)if(i[o]._stereotypeProperties&&this._parent)for(var s=0;s<this._parent._stereotypes.length;s++)i[o]._stereotypeProperties.removeStereotype(this._parent._stereotypes[s])}}StereotypeTag.base.setText.call(this,t)}},MetaclassItem.prototype.showDialog=function(){if(!this.active){var t=this;this.active=!0;var e,i=document.createElement("div"),n=document.createElement("form"),o=document.createElement("input"),s=document.createElement("input");i.className="ud_popup",o=document.createElement("select"),(e=document.createElement("option")).setAttribute("value","Metaclass name"),e.appendChild(document.createTextNode("none")),o.appendChild(e);for(var r=0;r<this._parent._validMetaclassApp.length;r++)(e=document.createElement("option")).setAttribute("value",this._parent._validMetaclassApp[r][0]),e.appendChild(document.createTextNode(this._parent._validMetaclassApp[r][0])),this._parent.getName()==this._parent._validMetaclassApp[r][1]&&e.setAttribute("selected","selected"),o.appendChild(e);if(s.setAttribute("type","submit"),s.setAttribute("value","ok"),this.changeText=function(e){t.active&&(t.setText(t.encode(o.value)),document.body.removeChild(i),t.active=!1,t.notifyChange())},this.closeDialog=function(e){t.active&&(document.body.removeChild(i),t.active=!1,t.notifyChange())},n.onsubmit=function(){return!1},s.addEventListener("click",this.changeText,!1),n.appendChild(o),n.appendChild(s),this.deletable){var a=document.createElement("input");a.setAttribute("type","submit"),a.setAttribute("value","delete"),this.deleteDialog=function(e){t.active&&(document.body.removeChild(i),t.active=!1,t.notifyDelete(),t.notifyChange())},a.addEventListener("click",this.deleteDialog,!1),n.appendChild(a)}i.appendChild(n),document.body.appendChild(i),o.focus(),i.style.top=(window.innerHeight-n.offsetHeight)/2+"px",i.style.left=(window.innerWidth-n.offsetWidth)/2+"px"}};var ProfileDiagram=function(t){t=t||{},ProfileDiagram.baseConstructor.call(this,t),this._visible=!0};JSFun.extend(ProfileDiagram,Diagram),ProfileDiagram.prototype.draw=function(){this._visible&&ProfileDiagram.base.draw.call(this)},ProfileDiagram.prototype.interaction=function(t){t=!!this._visible&&t;ProfileDiagram.base.interaction.call(this,t)},ProfileDiagram.prototype.updateProfile=function(t){var e,i,n=[];for(e=0;e<this._nodes.length;e++)"UMLMetaclass"==this._nodes[e].getType()&&n.push(this._nodes[e]);for(e=0;e<t.length;e++)for(i=t[e]._nodes,j=0;j<i.length;j++)i[j]._stereotypeProperties&&i[j]._stereotypeProperties.updateElementStereotypes()},ProfileDiagram.prototype.removeProfile=function(t){if(t){var e,i,n=[];for(e=0;e<this._nodes.length;e++)"UMLStereotype"==this._nodes[e].getType()&&n.push(this._nodes[e]);for(e=0;e<t.length;e++)for(i=t[e]._nodes,j=0;j<i.length;j++)if(i[j]._stereotypeProperties)for(k=0;k<n.length;k++)i[j]._stereotypeProperties.removeStereotype(n[k])}},ProfileDiagram.prototype.setXML=function(t,e,i){if(e=e||[],i=i||[],ProfileDiagram.base.setXML.call(this,t),this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;"false"==n.getAttribute("visible")&&(this._visible=!1);for(var o=0;o<this._nodes.length;o++)"UMLMetaclass"==this._nodes[o].getType()?(this._nodes[o].setDiagrams(e),this._nodes[o].setValidMetaclass(i)):"UMLStereotype"==this._nodes[o].getType()&&this._nodes[o].setDiagrams(e)},ProfileDiagram.prototype.getXML=function(t){var e=ProfileDiagram.base.getXML.call(this,t);return e.setAttribute("visible",this._visible),e},ProfileDiagram.prototype.getElements=function(){for(var t=[],e=[],i=0;i<this._nodes.length;i++)"UMLMetaclass"==this._nodes[i].getType()?t.push(this._nodes[i]):"UMLStereotype"==this._nodes[i].getType()&&e.push(this._nodes[i]);return[t,e]};var SrcItem=function(t){t=t||{},SrcItem.baseConstructor.call(this,t),this._parse=/^path(?:\:\/([a-zA-Z\:\_\.\/\\0-9 ]*))?$/,this.setMinWidth(50)};JSFun.extend(SrcItem,TextBox),SrcItem.prototype.encode=function(t){var e="";return t[0]&&(e+="path:/"+t[0]),this._parse.exec(e)?e:"no icon "},SrcItem.prototype.decode=function(t){var e=this._parse.exec(t);return e?(e.shift(),e):[]},SrcItem.prototype.showDialog=function(){if(!this.active){var t=this;this.active=!0;var e=document.createElement("div"),i=document.createElement("form"),n=document.createElement("input"),o=document.createElement("input");o.setAttribute("type","submit"),o.setAttribute("value","ok"),e.className="ud_popup";var s,r,a=this.decode(this.getValue());if(n.setAttribute("type","text"),n.setAttribute("value",a[0]||""),this.changeText=function(i){if(t.active){var o=[];o.push(n.value),t.setText(t.encode(o)),document.body.removeChild(e),t.active=!1,t.notifyChange(),t.notifyDraw()}},this.closeDialog=function(i){t.active&&(document.body.removeChild(e),t.active=!1,t.notifyChange(),t.notifyDraw())},i.onsubmit=function(){return!1},o.addEventListener("click",this.changeText,!1),r=document.createElement("div"),(s=document.createElement("label")).appendChild(document.createTextNode("Icon path (absolute path)")),r.appendChild(s),r.appendChild(n),i.appendChild(r),i.appendChild(o),this.deletable){var h=document.createElement("input");h.setAttribute("type","submit"),h.setAttribute("value","delete"),this.deleteDialog=function(i){t.active&&(document.body.removeChild(e),t.active=!1,t.notifyDelete(),t.notifyChange(),t.notifyDraw())},h.addEventListener("click",this.deleteDialog,!1),i.appendChild(h)}e.appendChild(i),document.body.appendChild(e),n.focus(),e.style.top=(window.innerHeight-i.offsetHeight)/2+"px",e.style.left=(window.innerWidth-i.offsetWidth)/2+"px"}},SrcItem.prototype.setText=function(t){if(JSFun.isString(t)){var e=this._text!=t;if(this._text=t,e){var i=this._parent?this._parent._diagrams:[],n=[];for(var o in i){n=i[o]._nodes;for(var s=0;s<n.length;s++)n[s]._stereotypeProperties&&this._parent&&this._parent._validMetaclass(n[s].getType())&&(n[s]._stereotypeProperties.removeFigure(this._parent),n[s]._stereotypeProperties._shownStereotype=="«"+this._parent.getName()+"»"&&n[s]._stereotypeProperties.drawStereotype(this._parent))}}var r=this._text.length>20?20:this._text.length;""==t?this._orientation?this.setHeight(50):this.setWidth(50):this._orientation?this.setHeight(r*this.font_width):this.setWidth(r*this.font_width),this._orientation?this.setWidth(this._line_height):this.setHeight(this._line_height)}},SrcItem.prototype.draw=function(t){if(this._visible){t.save(),this.active&&(t.fillStyle="#ffc485",t.fillRect(this.getPixelX(),this.getPixelY(),this.getWidth(),this.getHeight())),t.restore(),t.save(),t.font=this.getFontStyle()+" "+this.getFontWeight()+" "+this.getFontSize()+"px "+this.getFontFamily(),t.textBaseline="middle",t.fillStyle=this.getFontColor();var e=this._text;e||(e=""),e.length>20&&(e=e.substring(0,17),e+="..."),this._orientation?(t.translate(this._getMX()+this._line_height/2,this._getMY()),t.rotate(-90*Math.PI/180),t.fillText(e,2*this._margin-this.getHeight(),0)):t.fillText(e,this._getMX(),this._getMY()+this._line_height/2),t.restore()}};var Stereotype=function(t){t=t||{},Stereotype.baseConstructor.call(this,t),this._metaclass=[],this.setDiagrams(t.diagrams||[])};JSFun.extend(Stereotype,Rectangular),Stereotype.prototype.setDiagrams=function(t){this._diagrams=t},Stereotype.prototype.addRelation=function(t){Stereotype.base.addRelation.call(this,t)},Stereotype.prototype.delRelation=function(t){Stereotype.base.delRelation.call(this,t),t._elemB.delStereotype(this),this.delMetaclass(t._elemB)},Stereotype.prototype.remove=function(){for(var t=this._relations,e=0;e<t.length;e++)t[e]._elemB.delStereotype(this);Stereotype.base.remove.call(this)},Stereotype.prototype.setName=function(t){this._components[1].setValue(t)},Stereotype.prototype.addTagValue=function(t){t=t||"";this._components[3].addField(t)},Stereotype.prototype.setPath=function(t){this._components[4].setValue("path:/"+t)},Stereotype.prototype.getName=function(){return this._components[1].getValue()},Stereotype.prototype.getTagValues=function(){for(var t=this._components[3]._childs,e=[],i=0;i<t.length;i++)e.push(t[i].getValue());return e},Stereotype.prototype.getPath=function(){return this._components[4].getValue().substring(5)},Stereotype.prototype._validMetaclass=function(t){for(var e=this._metaclass.length;e--;)if(this._metaclass[e].getName()==t)return!0;return!1},Stereotype.prototype.delMetaclass=function(t){var e;for(e in this._diagrams)for(var i=0;i<this._diagrams[e]._nodes.length;i++)this._diagrams[e]._nodes[i].getType()==t.getName()&&this._diagrams[e]._nodes[i]._stereotypeProperties&&this._diagrams[e]._nodes[i]._stereotypeProperties.removeStereotype(this);for(e in this._metaclass)if(this._metaclass[e]==t){this._metaclass.splice(e,1);break}},Stereotype.prototype.getNameAsComponent=function(){return this._components[1]};var StereotypeNameItem=function(t){t=t||{},StereotypeNameItem.baseConstructor.call(this,t)};JSFun.extend(StereotypeNameItem,TextBox),StereotypeNameItem.prototype.setText=function(t){if(JSFun.isString(t)){if(this._text!=t){var e=this._parent?this._parent._diagrams:[],i=[];for(var n in e){i=e[n]._nodes;for(var o=0;o<i.length;o++)i[o]._stereotypeProperties&&this._parent&&this._parent._validMetaclass(i[o].getType())&&i[o]._stereotypeProperties.changeNameStereotype(this._parent,"«"+t+"»")}}StereotypeNameItem.base.setText.call(this,t)}};var TagValueItem=function(t){t=t||{},TagValueItem.baseConstructor.call(this,t);this._parse=new RegExp("^([a-zA-Z_0-9]*)?(?::([a-zA-Z_0-9]*))?$"),this.setMinWidth(40)};JSFun.extend(TagValueItem,TextBox),TagValueItem.prototype.encode=function(t){var e="";return t[0]&&(e+=t[0]),t[1]&&(e+=":"+t[1]),this._parse.exec(e)?e:"wrong_attribute"},TagValueItem.prototype.decode=function(t){var e=this._parse.exec(t);return e?(e.shift(),e):[]},TagValueItem.prototype.getNameTagValue=function(){return this.decode(this._text)[0]},TagValueItem.prototype.getDefaultValue=function(){return this.decode(this._text)[1]},TagValueItem.prototype.showDialog=function(){if(!this.active){var t=this;this.active=!0;var e,i=document.createElement("div"),n=document.createElement("form"),o=[];for(i.className="ud_popup",e=0;e<2;e++)o.push(document.createElement("input"));var s=document.createElement("input");s.setAttribute("type","submit"),s.setAttribute("value","ok");var r=this.decode(this.getValue());for(e=0;e<o.length;e++)o[e].setAttribute("type","text"),o[e].setAttribute("value",r[e]||"");this.changeText=function(e){if(t.active){var n,s=[];for(n=0;n<o.length;n++)s.push(o[n].value);t.setText(t.encode(s)),document.body.removeChild(i),t.active=!1,t.notifyChange()}},this.closeDialog=function(e){t.active&&(document.body.removeChild(i),t.active=!1,t.notifyChange())},n.onsubmit=function(){return!1},s.addEventListener("click",this.changeText,!1);var a,h,p=["tag value","default value"];for(e=0;e<o.length;e++)h=document.createElement("div"),(a=document.createElement("label")).appendChild(document.createTextNode(p[e])),h.appendChild(a),h.appendChild(o[e]),n.appendChild(h);if(n.appendChild(s),this.deletable){var l=document.createElement("input");l.setAttribute("type","submit"),l.setAttribute("value","delete"),this.deleteDialog=function(e){t.active&&(document.body.removeChild(i),t.active=!1,t.notifyDelete(),t.notifyChange())},l.addEventListener("click",this.deleteDialog,!1),n.appendChild(l)}i.appendChild(n),document.body.appendChild(i),i.style.top=(window.innerHeight-n.offsetHeight)/2+"px",i.style.left=(window.innerWidth-n.offsetWidth)/2+"px"}},TagValueItem.prototype.select=function(t,e){return Math.abs(t-(this.getPixelX()+this.getSuperWidth()-20))<=5&&Math.abs(e-(this.getPixelY()+8.66))<=5?(this.notifyToUp(),this.notifyChange(),!0):Math.abs(t-(this.getPixelX()+this.getSuperWidth()-30))<=5&&Math.abs(e-(this.getPixelY()+7.33))<=5?(this.notifyToDown(),this.notifyChange(),!0):TagValueItem.base.select.call(this,t,e)},TagValueItem.prototype.drawShape=function(t){var e=this.getPixelX()+this.getSuperWidth()-35,i=this.getPixelY()+3;t.save(),t.fillStyle="#0000aa",t.beginPath(),t.moveTo(e,i),t.lineTo(e+10,i),t.lineTo(e+5,i+7),t.closePath(),t.fill(),e+=10,t.beginPath(),t.moveTo(e+5,i),t.lineTo(e,i+7),t.lineTo(e+10,i+7),t.closePath(),t.fill(),t.restore()};var TagValueFields=function(t){t=t||{},TagValueFields.baseConstructor.call(this,t),this._default=t.text||"new_attribute"};JSFun.extend(TagValueFields,CollapsibleFields),TagValueFields.prototype.newItem=function(){return new TagValueItem({text:this._default})};var UMLProfile=function(t){var e=new ProfileDiagram(t);return e.setType("UMLProfile"),e.setName("Profile"),e.setValidElements(["UMLNote","UMLLine","UMLMetaclass","UMLExtension","UMLStereotype"]),e},UMLMetaclass=function(t){var e=new Metaclass(t);return e.setType("UMLMetaclass"),e.setMoveable(),e.setWidth(80),e.setHeight(30),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeItem({id:"stereotype",text:"«metaclass»",selected:!0,centered:!0})),e.addComponent(new MetaclassItem({id:"name",text:"MetaClass name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e},UMLStereotype=function(t){var e=new Stereotype(t);return e.setType("UMLStereotype"),e.setWidth(100),e.setHeight(40),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#c0e1c2"})),e.addComponent(new StereotypeItem({id:"stereotype",text:"«stereotype»",selected:!0,centered:!0})),e.addComponent(new StereotypeNameItem({id:"name",text:"stereotype name",centered:!0})),e.addComponent(new Separator({id:"separator",centered:!0})),e.addComponent(new TagValueFields({id:"attributes",margin:3})),e.addComponent(new SrcItem({id:"src",text:"path:/",margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e},UMLExtension=function(t){var e=new Extension(t);return e.setType("UMLExtension"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new CloseTip({color:"#000000"})),e},Alternative=function(t){t=t||{},Alternative.baseConstructor.call(this,t)};JSFun.extend(Alternative,SuperNode),Alternative.prototype.drop=function(t,e){var i,n;if(this._moved){this._alone||this._diagram.checkForParent(this);var o=this._diagram._relations,s=[],r=[];for(i=0;i<o.length;i++)this.isOverBeforePosition(o[i].getCentralPoint())&&o[i]instanceof Message&&(r.push(o[i].getCentralPoint()),s.push(o[i]));for(s.length&&(s=s[0]._sortRelByDistanceToLimitY(s)),i=0;i<s.length;i++)s[i]._moved||(s[i]._y=s[i]._y+(e-this._rely-this._prey),s[i]._y<s[i]._limitY&&(s[i]._y=s[i]._limitY),s[i]._moved=!0,s[i]._calculateLineEnds(2));for(n=0;n<s.length;n++){var a=s[n]._sortAscendant(s[n].descendantMessages());for(i=0;i<a.length;i++)a[i]._moved=!1,a[i]._objA&&a[i]._objA.resetMovement(),a[i]._objB&&a[i]._objB.resetMovement(),a[i].notifyChange()}for(i=0;i<s.length;i++)s[i].updateRelatedLifeline();s.length&&s[0].updateDeleteMessages()}Interaction.base.drop.call(this,t,e);var h=this._diagram._nodes;for(i=0;i<h.length;i++)h[i]instanceof Lifeline&&h[i].updateLength();this._moved=!1,this._resizing=!1},Alternative.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Alternative.prototype.setName=function(t){this._components[1].setValue(t)},Alternative.prototype.getStereotypes=function(){return this._components[0]._childs},Alternative.prototype.getName=function(){return this._components[1].getValue()},Alternative.prototype.getStereotype=function(){return this._components[0]},Alternative.prototype.getNameAsComponent=function(){return this._components[1]};var TimeInterval=function(t){t=t||{},TimeInterval.baseConstructor.call(this,t),this.setType("TimeInterval"),this.setMoveable(),this.setWidth(10),this.setMinHeight(30),this.setHeight(t.height||1),this.addFigure(new RectangleFigure({color:"#ffffff",changeFigureColor:!1}))};JSFun.extend(TimeInterval,Rectangular),TimeInterval.prototype.drag=function(t,e){if(this._resizing){var i=e-this.getY();this.setHeight(i)}},TimeInterval.prototype.drop=function(t,e){this._moved?(this._alone||this._diagram.checkForParent(this),this.updatePosition(),this._parent&&this._parent.updateContainer()):this._resizing?(this._message.notifyChange(),this.notifyChange()):this._selectedBefore&&this.selectComponent(t,e),this._message.updateDeleteMessages(),this._moved=!1,this._resizing=!1},TimeInterval.prototype.setMessage=function(t){this._message=t instanceof Message?t:null},TimeInterval.prototype.getLineX=function(t){return this.getX()+this.getWidth()/2+t*this.getWidth()/2},TimeInterval.prototype.updateLength=function(){var t,e,i=0;for(t in this._relations){if(this._relations[t]._elemA==this._relations[t]._elemB)o=this._relations[t].getY()+100;else if(this._relations[t]._elemB==this)var n=0==this._relations[t]._objB?30:0,o=this._relations[t].getY()+n;else{var s=0==this._relations[t]._objA?30:0;o=this._relations[t].getY()+s}this._relations[t]instanceof Message&&o>i&&(i=o,e=this._relations[t])}e?(i-=this._y,this.setMinHeight(i)):this.setMinHeight(30)},TimeInterval.prototype.addRelation=function(t,e){e=JSFun.isNumber(e)?e:0;t._elemA!=this||!t._objA||1!=e&&0!=e||(t._objA.remove(),t._objA=0),t._elemB!=this||!t._objB||2!=e&&0!=e||(t._objB.remove(),t._objB=0),t.updateLimitY(),t._y<t._limitY&&(t._y=t._limitY),e||Lifeline.base.addRelation.call(this,t)},TimeInterval.prototype.delRelation=function(t,e){e=JSFun.isNumber(e)?e:0;t._elemA!=this||0!=t._objA||1!=e&&0!=e||(t.setObjA(new TimeInterval),t._objA.setDiagram(t._diagram),t._diagram._addNode(t._objA)),t._elemB!=this||0!=t._objB||2!=e&&0!=e||(t.setObjB(new TimeInterval),t._objB.setDiagram(t._diagram),t._diagram._addNode(t._objB)),t._limitY=this._message._limitY;for(var i=this._diagram._nodes,n=0;n<i.length;n++)"UMLLifeline"==i[n].getType()&&i[n].updateLength();e||TimeInterval.base.delRelation.call(this,t),this.updateLength()};var SequenceDiagram=function(t){SequenceDiagram.baseConstructor.call(this,t)};JSFun.extend(SequenceDiagram,Diagram),SequenceDiagram.prototype._addNode=function(t){t instanceof Lifeline&&(t.setDiagram(this),t.updateLength()),SequenceDiagram.base._addNode.call(this,t)},SequenceDiagram.prototype._addRelation=function(t){t instanceof Message?(t.setDiagram(this),t._elemA instanceof TimeInterval&&t._objA&&(t._objA.remove(),t._objA=0),t._elemB instanceof TimeInterval&&t._objB&&(t._objB.remove(),t._objB=0),this._relations.push(t),t.updateDeleteMessages(),t.notifyChange()):SequenceDiagram.base._addRelation.call(this,t)},SequenceDiagram.prototype.checkForParent=function(t){!(t instanceof Node)||t instanceof Lifeline||t instanceof TimeInterval||SequenceDiagram.base.checkForParent.call(this,t)},SequenceDiagram.prototype.getXML=function(t){return SequenceDiagram.base.getXML.call(this,t)},SequenceDiagram.prototype._sortNodesByArea=function(){this._nodes.sort(function(t,e){var i=t.getArea(),n=e.getArea();return"UMLLifeline"==t.getType()&&"TimeInterval"!=e.getType()||"TimeInterval"!=t.getType()&&"UMLLifeline"==e.getType()?"UMLLifeline"==t.getType()?-1:1:i<n?-1:i==n?0:1})},SequenceDiagram.prototype._addElementOnly=function(t){t instanceof Node?(t.setDiagram(this),this._nodes.push(t)):t instanceof Relation&&(t._diagram=this,this._relations.push(t))},SequenceDiagram.prototype._instantiateObjectFromString=function(elemName,parent){if(!JSFun.isString(elemName))return null;var i;parent=parent||null;for(i in this._validElements)if(elemName==this._validElements[i]){if("UMLAlternative"==elemName||"UMLCreate"==elemName||"UMLDestroy"==elemName||"UMLSendMessage"==elemName||"UMLCallMessage"==elemName||"UMLDeleteMessage"==elemName||"UMLReplyMessage"==elemName){var setElementXml=!0;return eval("new "+this._validElements[i]+"({ setElementXml: "+setElementXml+"})")}return parent?new window[this._validElements[i]]({addComponent:!1,parent:parent}):eval("new "+this._validElements[i]+"()")}},SequenceDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},SequenceDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var Message=function(t){t=t||{},this._y=t.y||0,this._limitY=0,this._objA=null,this._objB=null,Message.baseConstructor.call(this,t)};JSFun.extend(Message,Relation),Message.prototype.getElementXML=function(t){var e=Message.base.getElementXML.call(this,t);return e.setAttribute("y",this._y),this._objA?e.setAttribute("a",this._objA.getId()):e.setAttribute("a",this._objA),this._objB?e.setAttribute("b",this._objB.getId()):e.setAttribute("b",this._objB),e},Message.prototype.setElementXML=function(t,e){Message.base.setElementXML.call(this,t,e),this._y=parseInt(t.getAttribute("y"));var i=t.getAttribute("a"),n=t.getAttribute("b"),o=parseInt(i);JSFun.isNumber(o)?i=o:"null"==i&&(i=null);var s=parseInt(n);JSFun.isNumber(s)?n=s:"null"==n&&(n=null),i?this.setObjA(e[i]):this._objA=i,n?this.setObjB(e[n]):this._objB=n},Message.prototype.setElements=function(t,e){return this._points[0]=new Point,this._points[1]=new Point,t instanceof Element&&e instanceof Element&&(!(t instanceof Relation&&e instanceof Relation)&&(this._elemA&&this._elemA!=this._elemB&&this._elemA.delRelation(this),this._elemB&&this._elemB.delRelation(this),this._elemA=t,this._elemB=e,this._elemA.addRelation(this),t!=e?this._elemB.addRelation(this):this._elemB.addRelation(this,2),this.updateParent(),this._calculateLineEnds(),!0))},Message.prototype.setElementA=function(t){return!(!t||"UMLLifeline"!=t.getType()&&"TimeInterval"!=t.getType())&&(!(t instanceof Relation&&this._elemB instanceof Relation)&&(this._elemA&&(this._elemA!=this._elemB?this._elemA.delRelation(this):this._elemA.delRelation(this,1)),this._elemA=t,this._elemA!=this._elemB?this._elemA.addRelation(this):this._elemA.addRelation(this,1),this.updateParent(),!0))},Message.prototype.setElementB=function(t){return!(!t||"UMLLifeline"!=t.getType()&&"TimeInterval"!=t.getType())&&(!(t instanceof Relation&&this._elemA instanceof Relation)&&(this._elemB&&(this._elemA!=this._elemB?this._elemB.delRelation(this):this._elemB.delRelation(this,2)),this._elemB=t,this._elemA!=this._elemB?this._elemB.addRelation(this):this._elemB.addRelation(this,2),this.updateParent(),!0))},Message.prototype.setLimitY=function(t){this._limitY=t},Message.prototype.getY=function(){return this._y},Message.prototype.select=function(t,e){for(this._deselectComponent(),i=0;i<this._points.length;i++)if(Math.abs(t-this._points[i].getX())<=4&&Math.abs(e-this._points[i].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=i,this._selectedPoint=!0,!0;if(this._selected>-1&&this._isOverComponent(t,e))return this._selectedBefore=!0,!0;for(var i=0;i<this._points.length-1;i++)if(this._selectLine(this._points[i],this._points[i+1],t,e))return this._selected>-1&&(this._selectedBefore=!0),this._selected=i,this._selectedLine=!0,this._elemA==this._elemB&&(this._movementLine=e-this._points[0]._y),!0;return!1},Message.prototype.drag=function(t,e){this._selectedLine?(this._elemA==this._elemB&&(e-=this._movementLine),e>this._limitY?this._y=e:this._y=this._limitY,this._moved=!0):this._selectedPoint&&(this._points[this._selected].setX(t),this._moved=!0)},Message.prototype.drop=function(t,e){this._moved?this._checkForNewNodes(t,e):this._selectedBefore&&this._selectComponent(t,e),this._selectedLine=!1,this._selectedPoint=!1,this._delUselessPoints(),this.notifyChange(),this.updateDeleteMessages(),this.updateRelatedLifeline(),this._moved=!1},Message.prototype.updateRelatedLifeline=function(){for(var t=this.descendantMessages(),e=0;e<t.length;e++)t[e]instanceof CreateMessage&&t[e]._elemB.updatePosition()},Message.prototype._checkForNewNodes=function(t,e){if(this._selectedPoint&&(0==this._selected||this._selected==this._points.length-1)){var i=this._diagram.reassignRelationTo(this,t,e);i!=this&&i!=this._objA&&i!=this._objB&&(0==this._selected?this.setElementA(i):this.setElementB(i))}},Message.prototype.updateDeleteMessages=function(){var t=0,e=[];if(this._diagram)var i=this._diagram._nodes;else i=[];for(t=i.length;t--;)i[t]instanceof Lifeline&&e.push(i[t]);for(e.sort(function(t,e){var i=t.getDelete(),n=e.getDelete();return i<n?-1:i==n?0:1}),t=0;t<e.length;t++)e[t].updateDelete()},Message.prototype._calculateLineEnds=function(t){var e;t=0==t||0==t||t?t:1;if(!this._selectedPoint&&this._elemA&&this._elemB){this._y>=this._elemA.getY()&&this._y<=this._elemA.getY()+this._heightSmallRectangle&&(this._y=this._elemA.getY()+this._heightSmallRectangle);var i=this,n=function(t){return t instanceof Lifeline?t.getLineX():t instanceof TimeInterval?t==i._elemA?t._x>i._elemB._x?t.getLineX(-1):t.getLineX(1):t._x>i._elemA._x?t.getLineX(-1):t.getLineX(1):void 0};if(1==t&&(this.updateLimitY(),this._y<this._limitY&&(this._y=this._limitY)),this._elemA==this._elemB){var o=this._objA?this._objA.getHeight()+20:50;this._points[0].setPoint(n(this._elemA),this._y),this._points[1]=new Point(n(this._elemB)+50,this._y),this._points[2]=new Point(n(this._elemB)+50,this._y+o),this._points[3]=new Point(n(this._elemB),this._y+o)}else for(this._points[0].setPoint(n(this._elemA),this._y),this._points[1].setPoint(n(this._elemB),this._y);this._points[2];)this._points.pop();if(t){var s;this.updateObjects();if(1==t&&(this._moved=!0),this._objA||this._elemA instanceof TimeInterval&&this._objB){var r=[],a=this._objA?this._objA:this._elemA;if(this._objA)r=a._relations;else for(var h=0;h<this._elemA._relations.length;h++)this._elemA._relations[h]._elemA==this._elemA._relations[h]._elemB&&r.push(this._elemA._relations[h]);for(e=0;e<r.length;e++)r[e]._moved||(s=this._objA?this._objA._y-this._objA._prey:this._objB?this._objB._y-this._objB._prey:0,r[e]._y=r[e]._y+s,r[e]._moved=!0,r[e]._calculateLineEnds(t?2:t),r[e]._updateComponents())}if(this._objB||this._elemB instanceof TimeInterval&&this._objA){var p=[],l=this._objB?this._objB:this._elemB;if(this._objB)p=l._relations;else for(h=0;h<this._elemB._relations.length;h++)this._elemB._relations[h]._elemA==this._elemB._relations[h]._elemB&&p.push(this._elemB._relations[h]);for(e=0;e<p.length;e++)p[e]._moved||(s=this._objB?this._objB?this._objB._y-this._objB._prey:this._objA._y-this._objA._prey:this._objA?this._objA._y-this._objA._prey:0,p[e]._y=p[e]._y+s,p[e]._moved=!0,p[e]._calculateLineEnds(t?2:t),p[e]._updateComponents())}if(2!=t){this._objA&&this._objA.resetMovement(),this._objB&&this._objB.resetMovement();var _=this._sortAscendant(this.descendantMessages());for(e=0;e<_.length;e++)_[e]._moved=!1,_[e]._objA&&_[e]._objA.resetMovement(),_[e]._objB&&_[e]._objB.resetMovement(),_[e].updateLimitY(),_[e]._y<_[e]._limitY&&(_[e]._y=_[e]._limitY,_[e]._calculateLineEnds())}}}},Message.prototype.descendantMessages=function(t){var e;t=t||[];if(this.foundInArray(t)||t.push(this),this._objA)for(e=0;e<this._objA._relations.length;e++)t=this._objA._relations[e].descendantMessages(t);else if(this._elemA&&this._objB)for(e=0;e<this._elemA._relations.length;e++)this._elemA._relations[e]._elemA==this._elemA._relations[e]._elemB&&(t=this._elemA._relations[e].descendantMessages(t));if(this._objB)for(e=0;e<this._objB._relations.length;e++)t=this._objB._relations[e].descendantMessages(t);else if(this._elemB&&this._objA)for(e=0;e<this._elemB._relations.length;e++)this._elemB._relations[e]._elemA==this._elemB._relations[e]._elemB&&(t=this._elemB._relations[e].descendantMessages(t));return t},Message.prototype._sortRelByCreateMessages=function(t,e){return 1!=e&&-1!=e?t:(t.sort(function(t,i){return t instanceof CreateMessage&&i instanceof CreateMessage?t._y>i._y?-1:1:t instanceof CreateMessage&&!(i instanceof CreateMessage)?e:!(t instanceof CreateMessage)&&i instanceof CreateMessage?-e:0}),t)},Message.prototype._sortRelByDistanceToLimitY=function(t){return t.sort(function(t,e){var i=t._y-t._limitY,n=e._y-e._limitY;return i>n?-1:i<n?1:0}),t},Message.prototype._sortAscendant=function(t){return t.sort(function(t,e){return t._y>e._y?1:t._y<e._y?-1:0}),t},Message.prototype.updateLimitY=function(){var t=0,e=0;this._elemA&&(t=this._elemA instanceof Lifeline?this._elemA.getY()+this._elemA._heightSmallRectangle+5:this._elemA.getY()+5),this._elemB&&(e=this._elemB instanceof Lifeline?this._elemB.getY()+this._elemB._heightSmallRectangle+5:this._elemB.getY()+5),t>e||this instanceof CreateMessage?this.setLimitY(t):this.setLimitY(e)},Message.prototype.foundInArray=function(t){for(var e=t.length;e--;)if(t[e]==this)return!0;return!1},Message.prototype.notifyChange=function(){var t,e=this._elemA._diagram?this._elemA._diagram._nodes:[];for(Message.base.notifyChange.call(this),t=0;t<e.length;t++)("UMLLifeline"==e[t].getType()&&!e[t]._delete||"UMLLifeline"==e[t].getType()&&e[t]._delete&&(e[t]==this._elemA||e[t]==this._elemB)||"TimeInterval"==e[t].getType())&&e[t].updateLength()},Message.prototype.remove=function(){Message.base.remove.call(this),this instanceof DeleteMessage&&this._elemB.setDelete(0),this._objA&&this._objA.remove(),this._objB&&this._objB.remove(),this.notifyChange()},Message.prototype.setObjA=function(t){this._objA=t,this._objA.setMessage(this),this.updateObjects()},Message.prototype.setObjB=function(t){this._objB=t,this._objB.setMessage(this),this.updateObjects()},Message.prototype.setDiagram=function(t){Message.base.setDiagram.call(this,t),this._objA&&t._addNode(this._objA),this._objB&&t._addNode(this._objB)},Message.prototype.updateObjects=function(){this._objA&&this._objA.setPosition(this._points[0].getX()-this._objA.getWidth()/2,this._points[0].getY()),this._objB&&(this._elemA==this._elemB?this._objB.setPosition(this._points[3].getX()-this._objB.getWidth()/2,this._points[3].getY()):this._objB.setPosition(this._points[1].getX()-this._objB.getWidth()/2,this._points[1].getY()))},Message.prototype.resetMovementObjects=function(){this._objA&&this._objA.resetMovement(),this._objB&&this._objB.resetMovement()},Message.prototype._updateComponents=function(){if(this._elemA&&this._elemB){var t=this._points[0].getX(),e=this._points[0].getY(),i=this._points[1].getX(),n=this._points[1].getY();this._elemA==this._elemB&&4==this._points.length&&(i=this._points[2].getX(),n=this._points[2].getY());var o=(t+i)/2,s=(e+n)/2;this._name&&(this._elemA==this._elemB?this._name.setCoordinates(i,s-this._name.getHeight()/2):this._name.setCoordinates(o-this._name.getWidth()/2,s-this._name.getHeight())),this._stereotype&&(this._name?this._elemA==this._elemB?this._stereotype.setCoordinates(i,s-this._stereotype.getHeight()-this._name.getHeight()/2):this._stereotype.setCoordinates(o-this._stereotype.getWidth()/2,s-this._stereotype.getHeight()-this._name.getHeight()):this._elemA==this._elemB?this._stereotype.setCoordinates(i,s-this._stereotype.getHeight()/2):this._stereotype.setCoordinates(o-this._stereotype.getWidth()/2,s-this._stereotype.getHeight()),this._stereotype instanceof SuperComponent&&this._stereotype.updateComponents())}},Message.prototype.drawShape=function(t){this._selectedPoint&&0==this._selected||this._selected==this._points.length-1||this._calculateLineEnds(0),t.save(),t.lineWidth=2,t.strokeStyle=RelationStyle.shape_color,t.beginPath(),t.moveTo(this._points[0].pixelX(),this._points[0].pixelY());for(var e=1;e<this._points.length;e++)t.lineTo(this._points[e].pixelX(),this._points[e].pixelY());t.stroke(),t.restore()},Message.prototype.getObjA=function(){return this._objA},Message.prototype.getObjB=function(){return this._objB};var CallMessage=function(t){t=t||{},CallMessage.baseConstructor.call(this,t)};JSFun.extend(CallMessage,Message),CallMessage.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},CallMessage.prototype.setName=function(t){this._components[1].setValue(t)},CallMessage.prototype.getStereotypes=function(){return this._components[0]._childs},CallMessage.prototype.getName=function(){return this._components[1].getValue()},CallMessage.prototype.getNameAsComponent=function(){return this._components[1]};var CreateMessage=function(t){t=t||{},CreateMessage.baseConstructor.call(this,t)};JSFun.extend(CreateMessage,Message),CreateMessage.prototype.setElementXML=function(t,e){CreateMessage.base.setElementXML.call(this,t,e),this._elemB.setCreate(this._y),this._elemA.updatePosition(),this._elemB.updatePosition()},CreateMessage.prototype.setElements=function(t,e){var i;CreateMessage.base.setElements.call(this,t,e),this._elemB&&this._elemB.updatePosition();var n=this.descendantsCreateMessages();for(i=0;i<n.length;i++)n[i].updatePosition()},CreateMessage.prototype.remove=function(){CreateMessage.base.remove.call(this),this._elemB.setPosition(this._elemB.getX(),70),this._elemB.updatePosition(),this._elemB.setCreate(0),this._elemA&&this._elemA.updateLength(),this._elemB&&this._elemB.updateLength();for(var t=this._elemB._relations,e=0;e<t.length;e++)t[e]._elemA._y>t[e]._elemB._y||t[e]instanceof CreateMessage?t[e].setLimitY(t[e]._elemA.getY()+t[e]._elemA._heightSmallRectangle+5):t[e].setLimitY(t[e]._elemB.getY()+t[e]._elemB._heightSmallRectangle+5)},CreateMessage.prototype.drop=function(t,e){CreateMessage.base.drop.call(this,t,e),this._elemB.updatePosition();for(var i=this.descendantsCreateMessages(),n=0;n<i.length;n++)i[n].updatePosition()},CreateMessage.prototype._calculateLineEnds=function(t){t=0==t||t?t:1;if(!this._selectedPoint&&this._elemA&&this._elemB&&this._elemA!=this._elemB){var e,i=this._sortRelByCreateMessages(this._elemB._relations,1);if(this._y>=this._elemA.getY()&&this._y<=this._elemA.getY()+this._heightSmallRectangle&&(this._y=this._elemA.getY()+this._heightSmallRectangle),1==t&&(this.updateLimitY(),this._y<this._limitY&&(this._y=this._limitY)),this._points[0].setPoint(this._elemA.getLineX(this._elemA._x>this._elemB._x?-1:1),this._y),this._elemB.getX()>this._elemA.getX()?this._points[1].setPoint(this._elemB.getX(),this._y):this._points[1].setPoint(this._elemB.getX()+this._elemB.getWidth(),this._y),this._elemB._y=this._y-this._elemB._heightSmallRectangle/2,t){for(1==t&&(this._moved=!0),e=0;e<i.length;e++)i[e]._moved||(i[e]._y=i[e]._y+this._y-this._elemB.getCreate(),i[e].setLimitY(this._y+this._elemB._heightSmallRectangle/2+5),i[e]._limitY>i[e]._y&&(i[e]._y=i[e]._limitY),i[e]._moved=!0,i[e]._calculateLineEnds(t?2:t),i[e]._updateComponents(),i[e]instanceof DeleteMessage&&i[e]._elemB.setDelete(i[e]._y));if(this._elemB.setCreate(this._y),0!=this._elemB.getCreate())for(e=0;e<i.length;e++)if(i[e]._y<this._elemB.getCreate()&&!(i[e]._elemA instanceof TimeInterval)&&!(i[e]._elemB instanceof TimeInterval)){var n=i[e]._y;i[e]._points[0].setY(n+this._elemB.getCreate()-this._elemA.getY()),i[e]._points[1].setY(n+this._elemB.getCreate()-this._elemA.getY()),i[e]._y=n+this._elemB.getCreate()-this._elemA.getY(),i[e].setLimitY(this._y+this._elemB._heightSmallRectangle/2+5),i[e]._limitY>i[e]._y&&(i[e]._y=i[e]._limitY),i[e]._updateComponents(),i[e].updateObjects(),i[e].notifyChange()}if(1==t){var o=this._sortAscendant(this.descendantMessages());for(e=0;e<o.length;e++)o[e]._moved=!1,o[e]._objA&&o[e]._objA.resetMovement(),o[e]._objB&&o[e]._objB.resetMovement(),o[e].updateLimitY(),o[e]._y<o[e]._limitY&&(o[e]._y=o[e]._limitY,o[e]._calculateLineEnds())}this.updateObjects()}}},CreateMessage.prototype.descendantMessages=function(t){t=t||[];if(this.foundInArray(t)||t.push(this),this._elemB)for(var e=0;e<this._elemB._relations.length;e++)this._elemB._relations[e]!=this&&(t=this._elemB._relations[e].descendantMessages(t));return t},CreateMessage.prototype.drag=function(t,e){this._selectedLine?(e>this._limitY?this._y=e:this._y=this._limitY,this._moved=!0):this._selectedPoint},CreateMessage.prototype.descendantsCreateMessages=function(){if(!this._elemB)return[];var t,e,i=this._elemB._relations,n=[],o=[],s=!1;for(t=0;t<i.length;t++)if(i[t]instanceof CreateMessage&&i[t]._elemA==this._elemB&&i[t]._elemA!=i[t]._elemB){for(s=!1,e=0;e<n.length&&!s;e++)n[e]==i[t]._elemB&&(s=!0);if(!s)for(n.push(i[t]._elemB),o=i[t].descendantsCreateMessages(),e=0;e<o.length;e++)n.push(o[e])}else{if(i[t]._elemA==this)var r=i[t]._objA?i[t]._objA._relations:[];else r=i[t]._objB?i[t]._objB._relations:[];for(e=0;e<r.length;e++)if(r[e]instanceof CreateMessage){n.push(r[e]._elemB),o=r[e].descendantsCreateMessages();for(var a=0;a<o.length;a++)n.push(o[a])}}return n};var DeleteMessage=function(t){t=t||{},DeleteMessage.baseConstructor.call(this,t)};JSFun.extend(DeleteMessage,Message),DeleteMessage.prototype._checkForNewNodes=function(t,e){if(this._selectedPoint&&(0==this._selected||this._selected==this._points.length-1)){var i=this._diagram.reassignRelationTo(this,t,e);i&&(0==this._selected?i==this._elemB||i==this._objA||("UMLLifeline"!=i.getType()||i.getDelete())&&"TimeInterval"!=i.getType()||this.setElementA(i):i==this._elemA||"UMLLifeline"!=i.getType()||i.getDelete()||this.setElementB(i),this.notifyChange())}},DeleteMessage.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},DeleteMessage.prototype.setName=function(t){this._components[1].setValue(t)},DeleteMessage.prototype.getStereotypes=function(){return this._components[0]._childs},DeleteMessage.prototype.getName=function(){return this._components[1].getValue()},DeleteMessage.prototype.getNameAsComponent=function(){return this._components[1]};var Interaction=function(t){t=t||{},Interaction.baseConstructor.call(this,t)};JSFun.extend(Interaction,Rectangular),Interaction.prototype.drop=function(t,e){var i,n;if(this._moved){this._alone||this._diagram.checkForParent(this);var o=this._diagram._relations,s=[],r=[];for(i=0;i<o.length;i++)this.isOverBeforePosition(o[i].getCentralPoint())&&o[i]instanceof Message&&(r.push(o[i].getCentralPoint()),s.push(o[i]));for(s.length&&(s=s[0]._sortRelByDistanceToLimitY(s)),i=0;i<s.length;i++)s[i]._moved||(s[i]._y=s[i]._y+(e-this._rely-this._prey),s[i]._y<s[i]._limitY&&(s[i]._y=s[i]._limitY),s[i]._moved=!0,s[i]._calculateLineEnds(2));for(n=0;n<s.length;n++){var a=s[n]._sortAscendant(s[n].descendantMessages());for(i=0;i<a.length;i++)a[i]._moved=!1,a[i]._objA&&a[i]._objA.resetMovement(),a[i]._objB&&a[i]._objB.resetMovement(),a[i].notifyChange()}for(i=0;i<s.length;i++)s[i].updateRelatedLifeline();s.length&&s[0].updateDeleteMessages()}Interaction.base.drop.call(this,t,e);var h=this._diagram._nodes;for(i=0;i<h.length;i++)h[i]instanceof Lifeline&&h[i].updateLength();this._moved=!1,this._resizing=!1},Interaction.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Interaction.prototype.setName=function(t){this._components[1].setValue(t)},Interaction.prototype.setGuard=function(t){this._components[2]&&this._components[2].setValue("["+t+"]")},Interaction.prototype.getStereotypes=function(){return this._components[0]._childs},Interaction.prototype.getName=function(){return this._components[1].getValue()},Interaction.prototype.getGuard=function(){var t=this._components[2].getValue();return this._components[2]?t.substring(1,t.length-1):null},Interaction.prototype.getStereotype=function(){return this._components[0]},Interaction.prototype.getNameAsComponent=function(){return this._components[1]};var Lifeline=function(t){t=t||{},Lifeline.baseConstructor.call(this,t),this._delete=0,this._create=0,this._limitY=-1,this.setHeightSmallRectangle(t.heightSmallRectangle||25)};JSFun.extend(Lifeline,Rectangular),Lifeline.prototype.setHeightSmallRectangle=function(t){this._heightSmallRectangle=t},Lifeline.prototype.isOver=function(t,e){return t instanceof Point&&(e=t.getY(),t=t.getX()),t>=this._x&&t<=this._x+this._width&&e>=this._y&&e<=this._y+this._heightSmallRectangle||t>=this.getLineX()-5&&t<=this.getLineX()+5&&e>=this._y+this._heightSmallRectangle&&e<=this._y+this._height},Lifeline.prototype.notifyChange=function(){var t,e,i,n=this._heightSmallRectangle;this.setHeightSmallRectangle(this._components[0].getHeight()+this._components[1].getHeight());var o=this._heightSmallRectangle-n;for(e=0;e<this._relations.length;e++){if((!(this._relations[e]instanceof CreateMessage)||this._relations[e]instanceof CreateMessage&&this._relations[e]._elemA==this)&&(o&&(this._relations[e]instanceof CreateMessage?this._relations[e].setLimitY(this._y+this._heightSmallRectangle+5):this._relations[e]._elemA==this?this._relations[e]._elemB._y+this._relations[e]._elemB._heightSmallRectangle+5<this._y+this._heightSmallRectangle+5?this._relations[e].setLimitY(this._y+this._heightSmallRectangle+5):this._relations[e].setLimitY(this._relations[e]._elemB._y+this._relations[e]._elemB._heightSmallRectangle+5):this._relations[e]._elemA._y+this._relations[e]._elemA._heightSmallRectangle+5<this._y+this._heightSmallRectangle+5?this._relations[e].setLimitY(this._y+this._heightSmallRectangle+5):this._relations[e].setLimitY(this._relations[e]._elemA._y+this._relations[e]._elemA._heightSmallRectangle+5)),this._relations[e]._y<this._y+this._heightSmallRectangle+5))if(this._relations[e]._y+=o,this._relations[e].notifyChange(),this._relations[e]instanceof CreateMessage)for(this._relations[e]._elemB.updatePosition(),t=this._relations[e].descendantsCreateMessages(),i=0;i<t.length;i++)t[i].updatePosition();else this._relations[e].updateRelatedLifeline();o&&this._relations[e]instanceof CreateMessage&&this._relations[e]._elemB==this&&this._relations[e].notifyChange(),o&&this.resetMovement()}o&&this._relations.length&&this._relations[0].updateDeleteMessages(),this._container?this.updateContainer():(this.updateComponents(),this._parent&&this._parent.updateContainer()),this.setWidth(this._minWidth>60?this._minWidth:60),this.updateComponents()},Lifeline.prototype.getLineX=function(){return this.getX()+this.getWidth()/2},Lifeline.prototype.drag=function(t,e){if(!this.resizing&&this._selected){var i=t-this._relx;this.setPosition(i,this.getY()),this._moved=!0}else Lifeline.base.drag.call(this,t,e)},Lifeline.prototype.updateDelete=function(){if(this._delete){var t,e,i,n,o,s,r,a=this._relations,h=0;for(o=0;o<a.length;o++)if(a[o]instanceof Message)if(!(a[o]instanceof DeleteMessage)||a[o]instanceof DeleteMessage&&a[o]._elemB!=this){if(n=a[o].getY(),a[o]._elemA==a[o]._elemB?(n+=a[o]._objA?a[o]._objA.getHeight()+20:50,i=a[o]._objB?a[o]._objB.getHeight():0):i=(t=a[o]._objA?a[o]._objA.getHeight():0)>(e=a[o]._objB?a[o]._objB.getHeight():0)?t:e,n+i+20>h&&(h=n+i+20),a[o]._objA){var p=a[o]._objA._relations;for(s=0;s<p.length;s++)(n=p[s].getY())+(i=(t=p[s]._objA?p[s]._objA.getHeight():0)>(e=p[s]._objB?p[s]._objB.getHeight():0)?t:e)+20>h&&(h=n+i+20)}if(a[o]._objB){var l=a[o]._objB._relations;for(s=0;s<l.length;s++)(n=l[s].getY())+(i=(t=l[s]._objA?l[s]._objA.getHeight():0)>(e=l[s]._objB?l[s]._objB.getHeight():0)?t:e)+20>h&&(h=n+i+20)}}else r=a[o];r._y<h?this._delete=h:this._delete=r._y,r._y=this._delete,r.notifyChange()}},Lifeline.prototype.updateLength=function(){var t,e=0;if(this._delete)for(t in this._relations)this._relations[t]instanceof Message&&this._relations[t].getY()>e&&(e=this._relations[t].getY());else{var i,n,o,s,r=this._diagram._relations,a=this._diagram._nodes,h=0;for(t=0;t<r.length;t++)r[t]instanceof Message&&(o=r[t].getY(),r[t]._elemA==r[t]._elemB?(o+=r[t]._objA?r[t]._objA.getHeight()+20:50,h=r[t]._objB?r[t]._objB.getHeight():0):h=(i=r[t]._objA?r[t]._objA.getHeight():0)>(n=r[t]._objB?r[t]._objB.getHeight():0)?i:n,o+h>e&&(e=o+h,s=r[t]));for(t=0;t<a.length;t++)(a[t]instanceof Alternative||a[t]instanceof Interaction)&&a[t].getY()+a[t]._height>e&&(e=a[t].getY()+a[t]._height,s=null)}(e-=this.getY())<=0&&(e=200),e<this._heightSmallRectangle+60&&!this._delete&&(e=this._heightSmallRectangle+60),s&&s instanceof CreateMessage&&(s._elemB==this?s._elemA.getDelete()||s._elemA.getY()+s._elemA.getHeight()<this.getY()+e+60&&s._elemA.setHeight(this.getY()+e+60-s._elemA.getY()):(s._elemB.updateLength(),s._elemB.getY()+s._elemB.getHeight()>this.getY()+e+60&&(e=s._elemB.getY()+s._elemB.getHeight()-this.getY()-60))),this._delete?this.setHeight(e):this.setHeight(e+60)},Lifeline.prototype.setDelete=function(t){this._delete=t},Lifeline.prototype.getDelete=function(){return this._delete},Lifeline.prototype.setCreate=function(t){this._create=t},Lifeline.prototype.getCreate=function(){return this._create},Lifeline.prototype.addRelation=function(t,e){e=JSFun.isNumber(e)?e:0;t instanceof DeleteMessage&&t._elemB==this&&this.setDelete(t._y),t instanceof CreateMessage&&t._elemB==this&&this.setCreate(t._y),t.updateLimitY(),t._y<t._limitY&&(t._y=t._limitY),e||Lifeline.base.addRelation.call(this,t)},Lifeline.prototype.updatePosition=function(t,e){var i;if(void 0==t||void 0==e){var n=this.getMovement();t=n.getX(),e=n.getY();this.resetMovement();for(i in this._relations)this._relations[i].updatePosition()}else this._x+=t,this._y+=e;this.resetMovement();for(i in this._components)this._components[i].updatePosition(t,e);for(i in this._relations)this._relations[i].getParent()!=this._parent&&this._relations[i].notifyChange();if(this._container){for(i in this._nodeChilds)this._nodeChilds[i].updatePosition(t,e);for(i in this._relationChilds)this._relationChilds[i].updatePosition(t,e)}},Lifeline.prototype.delRelation=function(t,e){e=JSFun.isNumber(e)?e:0;t instanceof DeleteMessage&&t._elemB==this&&this.setDelete(0),t instanceof DeleteMessage&&(this._limitY=-1),"UMLCreate"==t.getType()&&t._elemB==this&&this.setCreate(0);for(var i=this._diagram._nodes,n=0;n<i.length;n++)"UMLLifeline"==i[n].getType()&&i[n].updateLength();e||Lifeline.base.delRelation.call(this,t)},Lifeline.prototype.draw=function(t){if(Lifeline.base.draw.call(this,t),this._delete){var e=this.getX()+this.getWidth()/2,i=this.getY()+this.getHeight();t.save(),t.strokeStyle="#000000",t.translate(e,i),t.beginPath(),t.moveTo(-8.5,8.5),t.lineTo(8.5,-8.5),t.moveTo(8.5,8.5),t.lineTo(-8.5,-8.5),t.stroke(),t.restore()}},Lifeline.prototype.drawShape=function(t){t.save(),t.lineWidth=2.5,t.strokeStyle=NodeStyle.shape_color,t.strokeRect(JSGraphic.toPixel(this._x),JSGraphic.toPixel(this._y),this._width,this._heightSmallRectangle),t.beginPath(),t.moveTo(this.getLineX(),JSGraphic.toPixel(this._y)+this._heightSmallRectangle),t.lineTo(this.getLineX(),JSGraphic.toPixel(this._y)+this._height),t.closePath(),t.stroke(),t.restore()},Lifeline.prototype.drawFigures=function(t){var e;for(e=0;e<this._figures.length;e+=1)this._figures[e].draw(t,this._x,this._y,this._width,this._height,this._heightSmallRectangle)},Lifeline.prototype.setName=function(t){this._components[1].setValue(t)},Lifeline.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Lifeline.prototype.getStereotypes=function(){return this._components[0]._childs},Lifeline.prototype.getName=function(){return this._components[1].getValue()},Lifeline.prototype.getStereotype=function(){return this._components[0]},Lifeline.prototype.getNameAsComponent=function(){return this._components[1]};var RegionAlternative=function(t){t=t||{},RegionAlternative.baseConstructor.call(this,t)};JSFun.extend(RegionAlternative,Region),RegionAlternative.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},RegionAlternative.prototype.setGuard=function(t){this._components[1]&&this._components[1].setValue("["+t+"]")},RegionAlternative.prototype.getStereotypes=function(){return this._components[0]._childs},RegionAlternative.prototype.getGuard=function(){var t=this._components[1].getValue();return this._components[1]?t.substring(1,t.length-1):null},RegionAlternative.prototype.getStereotype=function(){return this._components[0]};var RegionAlternativeItem=function(t){t=t||{},RegionAlternativeItem.baseConstructor.call(this,t)};JSFun.extend(RegionAlternativeItem,RegionItem),RegionAlternativeItem.prototype.createRegion=function(){this.getParent()._components.length;this.getParent()._orientation,this.getParent().addRegion(new RegionAlternative({parent:this.getParent()}))};var ReplyMessage=function(t){t=t||{},ReplyMessage.baseConstructor.call(this,t)};JSFun.extend(ReplyMessage,Message),ReplyMessage.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ReplyMessage.prototype.setName=function(t){this._components[1].setValue(t)},ReplyMessage.prototype.getStereotypes=function(){return this._components[0]._childs},ReplyMessage.prototype.getName=function(){return this._components[1].getValue()},ReplyMessage.prototype.getNameAsComponent=function(){return this._components[1]};var SendMessage=function(t){t=t||{},SendMessage.baseConstructor.call(this,t)};JSFun.extend(SendMessage,Message),SendMessage.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},SendMessage.prototype.setName=function(t){this._components[1].setValue(t)},SendMessage.prototype.getStereotypes=function(){return this._components[0]._childs},SendMessage.prototype.getName=function(){return this._components[1].getValue()},SendMessage.prototype.getNameAsComponent=function(){return this._components[1]};var UMLSequenceDiagram=function(t){var e=new SequenceDiagram(t);return e.setType("UMLSequenceDiagram"),e.setName("Sequence diagram"),e.setValidElements(["UMLNote","UMLLine","UMLCreate","UMLDestroy","UMLLifeline","UMLCallMessage","UMLSendMessage","UMLDeleteMessage","UMLReplyMessage","UMLOption","UMLAlternative","UMLLoop","UMLBreak","Region","TimeInterval"]),e},UMLLifeline=function(t){var e=new Lifeline(t=t||{});return e.setType("UMLLifeline"),setStereotypeProperties(e,t.stereotypes||[]),e.setHeight(250),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextBox({id:"name",centered:!0,margin:3})),e.addFigure(new LifelineFigure({color:"#c6dbdc"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLCreate=function(t){var e=new CreateMessage(t);return e.setType("UMLCreate"),e.setStereotype("«create»"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLDestroy=function(t){var e=new DeleteMessage(t);return e.setType("UMLDestroy"),e.setStereotype("«destroy»"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLSendMessage=function(t){var e=new SendMessage(t);return e.setType("UMLSendMessage"),e.addComponentStereotype(),e.setComponentName(),t.setElementXml||(e.setObjA(new TimeInterval),e.setObjB(new TimeInterval)),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new OpenTip),e},UMLCallMessage=function(t){var e=new CallMessage(t);return e.setType("UMLCallMessage"),e.addComponentStereotype(),e.setComponentName(),t.setElementXml||(e.setObjA(new TimeInterval),e.setObjB(new TimeInterval)),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new CloseTip({color:"#000000"})),e},UMLReplyMessage=function(t){var e=new ReplyMessage(t);return e.setType("UMLReplyMessage"),e.addComponentStereotype(),e.setComponentName(),t.setElementXml||e.setObjB(new TimeInterval),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLDeleteMessage=function(t){var e=new DeleteMessage(t);return e.setType("UMLDeleteMessage"),e.addComponentStereotype(),e.setComponentName(),t.setElementXml||e.setObjA(new TimeInterval),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new OpenTip),e},UMLOption=function(t){var e=new Interaction(t=t||{});return e.setType("UMLOption"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setContainer(),e.setWidth(200),e.setHeight(100),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",text:"OPT",margin:4,selected:!0})),e.addComponent(new GuardItem({id:"guard",text:"[]",margin:1})),e.addFigure(new RectangleFigure),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLAlternative=function(t){var e=new Alternative(t=(t=t||{})||{});return e.setType("UMLAlternative"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setWidth(200),e.setHeight(100),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",text:"ALT",margin:4,selected:!0})),e.addComponent(new RegionAlternativeItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new RectangleFigure),t.setElementXml||(e.addRegion(new RegionAlternative({parent:e,position:Component.BottomLeft})),e.addRegion(new RegionAlternative({parent:e,position:Component.BottomLeft}))),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLLoop=function(t){var e=new Interaction(t=t||{});return e.setType("UMLLoop"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setContainer(),e.setWidth(200),e.setHeight(100),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new LoopItem({id:"name",text:"LOOP",margin:4})),e.addComponent(new GuardItem({id:"guard",text:"[]",margin:1})),e.addFigure(new RectangleFigure),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLBreak=function(t){var e=new Interaction(t=t||{});return e.setType("UMLBreak"),setStereotypeProperties(e,t.stereotypes||[]),e.setMoveable(),e.setContainer(),e.setWidth(200),e.setHeight(100),e.addComponent(new StereotypeTagList({id:"stereotypes"})),e.addComponent(new Tab({id:"name",text:"BREAK",margin:4,selected:!0})),e.addFigure(new RectangleFigure),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},CompositeState=function(t){t=t||{},CompositeState.baseConstructor.call(this,t),this.setHeightSmallRectangle(t.heightSmallRectangle||15),this.setWidthSmallRectangle(t.widthSmallRectangle||75),this.setXmovement(t.Xmovement||15)};JSFun.extend(CompositeState,SuperNode),CompositeState.prototype.setHeightSmallRectangle=function(t){this._heightSmallRectangle=t},CompositeState.prototype.setWidthSmallRectangle=function(t){this._widthSmallRectangle=t},CompositeState.prototype.setXmovement=function(t){this._Xmovement=t},CompositeState.prototype.updateContainer=function(t){if(0!=t&&1!=t&&(t=!0),this._container){var e,i,n,o,s=this._x,r=this._y+this._heightSmallRectangle,a=this._x,h=this._y+this._heightSmallRectangle,p=this._nodeChilds.length;for(e=0;e<p;e++)(i=this._nodeChilds[e])._visible&&(this._orientation?(o=i._x,elemLeftY=i._y,n=e==p-1?i._x+i._minWidth:i._x+i._width,elemRigthY=i._y+i._minHeight):(o=i._x,elemLeftY=i._y,n=i._x+i._minWidth,elemRigthY=e==p-1?i._y+i._minHeight:i._y+i._height,n=i._x+i._minWidth),n>a&&(a=n),elemRigthY>h&&(h=elemRigthY),o<s&&(s=o),elemLeftY<r&&(r=elemLeftY));s<this._x||r<this._y+this._heightSmallRectangle?(this.setWidth(this._x-s+this._width),this.setHeight(this._y+this._heightSmallRectangle-r+this._height),this._x=s,this._y=r-this._heightSmallRectangle,this.setMinWidth(a-s),this.setMinHeight(h-this._y)):(this.setMinWidth(a-this._x),this.setMinHeight(h-this._y)),this._prex=this._x,this._prey=this._y,this.updateComponents(),this._parent&&t&&this._parent.updateContainer()}},CompositeState.prototype.notifyChange=function(t,e,i){t=t||!1,e=e||!1,i=i||!1;var n=this._heightSmallRectangle;this.setHeightSmallRectangle(this._components[0].getHeight()+this._components[1].getHeight());var o=this._heightSmallRectangle-n;o&&(this._y=this._y-o,this.setHeight(this._height+o)),this._components[0].getWidth()>this._components[1].getWidth()?this.setWidthSmallRectangle(this._components[0].getWidth()):this.setWidthSmallRectangle(this._components[1].getWidth()),CompositeState.base.notifyChange.call(this,t,e,i)},CompositeState.prototype.getElementXML=function(t){var e,i=t.createElement(this.getType());i.setAttribute("id",this.getId()),i.setAttribute("x",this.getX()),i.setAttribute("y",this.getY()+this._components[0]._height-1),i.setAttribute("width",this.getWidth()),i.setAttribute("height",this.getHeight()-this._components[0]._height+1),i.setAttribute("backgroundColor",this.getBackgroundColor()),i.setAttribute("orientation",this._orientation),i.setAttribute("includeComponentByRegion",this._includeComponentByRegion);for(e in this._components)this._components[e].getId()&&i.appendChild(this._components[e].getComponentXML(t));for(e in this._nodeChilds)i.appendChild(this._nodeChilds[e].getElementXML(t));for(e in this._relationChilds)i.appendChild(this._relationChilds[e].getElementXML(t));return i},CompositeState.prototype.setElementXML=function(t){var e;this.setPosition(parseInt(t.getAttribute("x")),parseInt(t.getAttribute("y"))),this.resetMovement(),this.setWidth(parseInt(t.getAttribute("width"))),this.setHeight(parseInt(t.getAttribute("height"))),this.setBackgroundColor(t.getAttribute("backgroundColor")),this._orientation=parseInt(t.getAttribute("orientation")),this._includeComponentByRegion=t.getAttribute("includeComponentByRegion"),this._includeComponentByRegion="true"==this._includeComponentByRegion;var i=t.childNodes;for(e=0;e<i.length;e++){var n;if("item"==i[e].nodeName)null==i[e].getAttribute("behaviors")||"true"!=i[e].getAttribute("visible")&&"false"!=i[e].getAttribute("visible")?this.setValue(i[e].getAttribute("id"),i[e].getAttribute("value")):this.setValue(i[e].getAttribute("id"),i[e].getAttribute("value"),i[e].getAttribute("behaviors"),i[e].getAttribute("visible"));else if("superitem"==i[e].nodeName)for(n in this._components)this._components[n].getId()==i[e].getAttribute("id")&&this._components[n].setComponentXML(i[e])}this.notifyChange()},CompositeState.prototype.getLinkCentered=function(t,e){if(this._selectedFigure)return CompositeState.base.getLinkCentered.call(this,t,e);t instanceof Point&&(e=t.getY(),t=t.getX());var i,n,o,s,r,a=this.getCentralPoint(),h=a.getX(),p=a.getY();if(i=this.getX(),n=this.getY(),o=a.getX(),s=this.getY(),t<h)if(e<p)if(r=(this.getY()+this._heightSmallRectangle-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r))o=this.getX(),s=this.getY()+this.getHeight();else if(r=(this.getY()+this._heightSmallRectangle-p)/(this.getX()+this._Xmovement-h),Math.abs((e-p)/(t-h))<Math.abs(r))n=this.getY()+this._heightSmallRectangle,o=this.getX()+this.getWidth(),s=this.getY()+this._heightSmallRectangle;else if(r=(this.getY()-p)/(this.getX()+this._Xmovement-h),Math.abs((e-p)/(t-h))<Math.abs(r))i=this.getX()+this._Xmovement,n=this.getY(),o=this.getX()+this._Xmovement,s=this.getY()+this._heightSmallRectangle;else{var l=this.getX()+this._Xmovement+this._widthSmallRectangle;r=(this.getY()-p)/(l-h),Math.abs((e-p)/(t-h))<Math.abs(r)?(i=this.getX(),n=this.getY(),o=this.getX()+this.getWidth(),s=this.getY()):(i=this.getX(),n=this.getY()+this._heightSmallRectangle,o=this.getX()+this.getWidth(),s=this.getY()+this._heightSmallRectangle)}else r=(this.getY()+this.getHeight()-p)/(this.getX()-h),e-p==0||Math.abs((e-p)/(t-h))<Math.abs(r)?(o=this.getX(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight());else if(e<p){l=this.getX()+this._Xmovement+this._widthSmallRectangle;r=(this.getY()+this._heightSmallRectangle-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(r=(this.getY()-p)/(this.getX()+this._Xmovement+this._widthSmallRectangle-h),l>this.getX()+this.getWidth()/2&&Math.abs((e-p)/(t-h))>Math.abs(r)?(o=this.getX()+this.getWidth(),s=this.getY()):(r=(this.getY()+this._heightSmallRectangle-p)/(l-h),l<this.getX()+this.getWidth()/2||Math.abs((e-p)/(t-h))<Math.abs(r)?(i=this.getX(),n=this.getY()+this._heightSmallRectangle,o=this.getX()+this.getWidth(),s=this.getY()+this._heightSmallRectangle):(i=this.getX()+this._Xmovement+this._widthSmallRectangle,n=this.getY(),o=this.getX()+this._Xmovement+this._widthSmallRectangle,s=this.getY()+this._heightSmallRectangle))):(i=this.getX()+this.getWidth(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight())}else r=(this.getY()+this.getHeight()-p)/(this.getX()+this.getWidth()-h),e-p==0||(e-p)/(t-h)<r?(i=this.getX()+this.getWidth(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()):(n=this.getY()+this.getHeight(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight());return JSGraphic.lineIntersection(i,n,o,s,t,e,a.getX(),a.getY())},CompositeState.prototype.setVisibility=function(t){this._visible=t;var e=!0;this._selectedFigure&&t&&(e=!1);for(var i=0;i<this._components.length;i++)!e&&(e||"name"!=this._components[i]._id)||this._components[i]instanceof SpecificationItem&&!(this._components[i]instanceof SpecificationItem&&""!=this._components[i].getValue())||this._components[i].setVisibility(t);if(this._container&&e)for(i=0;i<this._nodeChilds.length;i++)this._nodeChilds[i].setVisibility(t)},CompositeState.prototype.isOver=function(t,e){return this._selectedFigure?CompositeState.base.isOver.call(this,t,e):(t instanceof Point&&(e=t.getY(),t=t.getX()),t>=this._x+this._Xmovement&&t<=this._x+this._Xmovement+this._widthSmallRectangle&&e>=this._y&&e<=this._y+this._heightSmallRectangle||t>=this._x&&t<=this._x+this._width&&e>=this._y+this._heightSmallRectangle&&e<=this._y+this._height)},CompositeState.prototype.setValue=function(t,e,i,n){var o;for(o in this._components)if(!(this._components[o]instanceof SuperComponent)&&this._components[o].getId()==t)return this._components[o].setValue(e,i,n),this.updateComponents(),!0;return!1},CompositeState.prototype.drawFigures=function(t){var e;for(e=0;e<this._figures.length;e+=1)e==this._selectedFigure&&this._figures[e].draw(t,this._x,this._y,this._width,this._height,this._heightSmallRectangle,this._widthSmallRectangle,this._Xmovement)},CompositeState.prototype.setName=function(t){this._components[1].setValue(t)},CompositeState.prototype.setSpecification=function(t){this._components[2].setVisibility(!0),t=t.replace(/\n/gi,";"),this._components[2].setText(t)},CompositeState.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},CompositeState.prototype.getStereotypes=function(){return this._components[0]._childs},CompositeState.prototype.getName=function(){return this._components[1].getValue()},CompositeState.prototype.getSpecification=function(){return this._components[2].getValue()},CompositeState.prototype.getStereotype=function(){return this._components[0]},CompositeState.prototype.getNameAsComponent=function(){return this._components[1]};var EntryPoint=function(t){t=t||{},EntryPoint.baseConstructor.call(this,t)};JSFun.extend(EntryPoint,Elliptical),EntryPoint.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},EntryPoint.prototype.setName=function(t){this._components[1].setValue(t)},EntryPoint.prototype.getStereotypes=function(){return this._components[0]._childs},EntryPoint.prototype.getName=function(){return this._components[1].getValue()},EntryPoint.prototype.getStereotype=function(){return this._components[0]},EntryPoint.prototype.getNameAsComponent=function(){return this._components[1]};var ExitPoint=function(t){t=t||{},ExitPoint.baseConstructor.call(this,t)};JSFun.extend(ExitPoint,Elliptical),ExitPoint.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},ExitPoint.prototype.setName=function(t){this._components[1].setValue(t)},ExitPoint.prototype.getStereotypes=function(){return this._components[0]._childs},ExitPoint.prototype.getName=function(){return this._components[1].getValue()},ExitPoint.prototype.getStereotype=function(){return this._components[0]},ExitPoint.prototype.getNameAsComponent=function(){return this._components[1]};var Junction=function(t){t=t||{},Junction.baseConstructor.call(this,t)};JSFun.extend(Junction,Elliptical),Junction.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Junction.prototype.setName=function(t){this._components[1].setValue(t)},Junction.prototype.getStereotypes=function(){return this._components[0]._childs},Junction.prototype.getName=function(){return this._components[1].getValue()},Junction.prototype.getStereotype=function(){return this._components[0]},Junction.prototype.getNameAsComponent=function(){return this._components[1]};var RegionState=function(t){t=t||{},RegionState.baseConstructor.call(this,t)};JSFun.extend(RegionState,Region),RegionState.prototype.addStereotype=function(t){if(this._components[0]){t=t||"";this._components[0].addField("«"+t+"»")}},RegionState.prototype.setName=function(t){this._components[1]&&this._components[1].setValue(t)},RegionState.prototype.getStereotypes=function(){return this._components[0]._childs},RegionState.prototype.getName=function(){return this._components[1].getValue()},RegionState.prototype.getStereotype=function(){return this._components[0]},RegionState.prototype.getNameAsComponent=function(){return this._components[1]};var RegionStateItem=function(t){t=t||{},RegionStateItem.baseConstructor.call(this,t)};JSFun.extend(RegionStateItem,RegionItem),RegionStateItem.prototype.createRegion=function(){this.getParent()._components.length;this.getParent()._orientation,this.getParent().addRegion(new RegionState({parent:this.getParent()}))};var SimpleState=function(t){t=t||{},SimpleState.baseConstructor.call(this,t)};JSFun.extend(SimpleState,Rectangular),SimpleState.prototype.setElementXML=function(t){var e;this.setPosition(parseInt(t.getAttribute("x")),parseInt(t.getAttribute("y"))),this.resetMovement(),this.setWidth(parseInt(t.getAttribute("width"))),this.setHeight(parseInt(t.getAttribute("height"))),this.setBackgroundColor(t.getAttribute("backgroundColor"));var i=t.childNodes;for(e=0;e<i.length;e++){var n;if("item"==i[e].nodeName)null==i[e].getAttribute("behaviors")||"true"!=i[e].getAttribute("visible")&&"false"!=i[e].getAttribute("visible")?this.setValue(i[e].getAttribute("id"),i[e].getAttribute("value")):this.setValue(i[e].getAttribute("id"),i[e].getAttribute("value"),i[e].getAttribute("behaviors"),i[e].getAttribute("visible"));else if("superitem"==i[e].nodeName)for(n in this._components)this._components[n].getId()==i[e].getAttribute("id")&&this._components[n].setComponentXML(i[e])}},SimpleState.prototype.setValue=function(t,e,i,n){var o;for(o in this._components)if(!(this._components[o]instanceof SuperComponent)&&this._components[o].getId()==t)return this._components[o].setValue(e,i,n),this.updateComponents(),!0;return!1},SimpleState.prototype.setVisibility=function(t){this._visible=t;var e=!0;this._selectedFigure&&t&&(e=!1);for(var i=0;i<this._components.length;i++)!e&&(e||"name"!=this._components[i]._id)||this._components[i]instanceof SpecificationItem&&!(this._components[i]instanceof SpecificationItem&&""!=this._components[i].getValue())||this._components[i].setVisibility(t);if(this._container&&e)for(i=0;i<this._nodeChilds.length;i++)this._nodeChilds[i].setVisibility(t)},SimpleState.prototype.draw=function(t){this._visible&&(SimpleState.base.draw.call(this,t),this._components[2]._visible&&(t.save(),t.fillStyle="#000000",t.beginPath(),t.moveTo(JSGraphic.toPixel(this.getX()),JSGraphic.toPixel(this.getY())+this._components[0].getHeight()+this._components[1].getHeight()),t.lineTo(JSGraphic.toPixel(this.getX()+this.getWidth()),JSGraphic.toPixel(this.getY())+this._components[0].getHeight()+this._components[1].getHeight()),t.closePath(),t.fill(),t.stroke(),t.restore()))},SimpleState.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},SimpleState.prototype.setName=function(t){this._components[1].setValue(t)},SimpleState.prototype.setSpecification=function(t){this._components[2].setVisibility(!0),t=t.replace(/\n/gi,";"),this._components[2].setText(t)},SimpleState.prototype.getStereotypes=function(){return this._components[0]._childs},SimpleState.prototype.getName=function(){return this._components[1].getValue()},SimpleState.prototype.getSpecification=function(){return this._components[2].getValue()},SimpleState.prototype.getStereotype=function(){return this._components[0]},SimpleState.prototype.getNameAsComponent=function(){return this._components[1]};var StateMachineDiagram=function(t){StateMachineDiagram.baseConstructor.call(this,t)};JSFun.extend(StateMachineDiagram,Diagram),StateMachineDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},StateMachineDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var Terminate=function(t){t=t||{},Terminate.baseConstructor.call(this,t)};JSFun.extend(Terminate,Elliptical),Terminate.prototype.getLinkCentered=function(t,e){t instanceof Point&&(e=t.getY(),t=t.getX());var i,n,o,s,r=this.getCentralPoint(),a=r.getX(),h=r.getY();return t<a?e<h?(i=this.getX(),n=this.getY(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()):(i=this.getX()+this.getWidth(),n=this.getY(),o=this.getX(),s=this.getY()+this.getHeight()):e<h?(i=this.getX()+this.getWidth(),n=this.getY(),o=this.getX(),s=this.getY()+this.getHeight()):(i=this.getX(),n=this.getY(),o=this.getX()+this.getWidth(),s=this.getY()+this.getHeight()),JSGraphic.lineIntersection(i,n,o,s,t,e,r.getX(),r.getY())},Terminate.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Terminate.prototype.setName=function(t){this._components[1].setValue(t)},Terminate.prototype.getStereotypes=function(){return this._components[0]._childs},Terminate.prototype.getName=function(){return this._components[1].getValue()},Terminate.prototype.getStereotype=function(){return this._components[0]},Terminate.prototype.getNameAsComponent=function(){return this._components[1]};var Transition=function(t){t=t||{},Transition.baseConstructor.call(this,t)};JSFun.extend(Transition,Relation),Transition.prototype.setComponentName=function(t){this._name?this._name.setText(t):(this._name=new TransitionItem({id:"name"}),this._addComponent(this._name))},Transition.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Transition.prototype.setName=function(t){this._components[1].setValue(t)},Transition.prototype.getStereotypes=function(){return this._components[0]._childs},Transition.prototype.getName=function(){return this._components[1].getValue()},Transition.prototype.getNameAsComponent=function(){return this._components[1]};var UMLStateMachineDiagram=function(t){var e=new StateMachineDiagram(t);return e.setType("UMLStateMachineDiagram"),e.setName("State Machine diagram"),e.setValidElements(["UMLNote","UMLLine","UMLInitialPseudostate","UMLFinalState","UMLTerminate","UMLEntryPoint","UMLExitPoint","UMLJunction","UMLSimpleState","UMLCompositeState","UMLVerticalRegion","UMLHorizontalRegion","UMLTransition","Region"]),e},UMLInitialPseudostate=function(t){var e=new Elliptical(t);return e.setType("UMLInitialPseudostate"),e.setWidth(16),e.setHeight(16),e.addFigure(new EllipseFigure({color:"#000000",changeFigureColor:!1})),e},UMLFinalState=function(t){var e=new Elliptical(t);return e.setType("UMLFinalState"),e.setWidth(16),e.setHeight(16),e.addFigure(new HalfFilledEllipseFigure({color:"#ffffff",changeFigureColor:!1})),e},UMLTerminate=function(t){var e=new Terminate(t=t||{});return e.setType("UMLTerminate"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(20),e.setHeight(20),e.addFigure(new CrossFigure({color:"#000000",changeFigureColor:!1})),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLEntryPoint=function(t){var e=new EntryPoint(t=t||{});return e.setType("UMLEntryPoint"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(14),e.setHeight(14),e.addFigure(new EllipseFigure({color:"#ffffff",changeFigureColor:!1})),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLExitPoint=function(t){var e=new ExitPoint(t=t||{});return e.setType("UMLExitPoint"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(14),e.setHeight(14),e.addFigure(new CrossEllipseFigure({color:"#ffffff",changeFigureColor:!1})),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLJunction=function(t){var e=new Junction(t=t||{});return e.setType("UMLJunction"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(14),e.setHeight(14),e.addFigure(new EllipseFigure({color:"#000000",changeFigureColor:!1})),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom,margin:3})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLSimpleState=function(t){var e=new SimpleState(t=t||{});return e.setType("UMLSimpleState"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(75),e.setHeight(30),e.setMoveable(),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,position:Component.Static,margin:5})),e.addComponent(new SpecificationItem({id:"specification",centered:!1,position:Component.BottomLeft,margin:10})),e.addFigure(new RoundedRectangleFigure({color:"#ffffbb"})),e.setMenu([[function(){for(var t=0;t<e._components.length;t++)e._components[t]instanceof SpecificationItem&&(e._components[t]._visible=!0,e._components[t].showDialog(),e.removeContextualMenu())},"Specifications"],[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLCompositeState=function(t){(t=t||{}).includeComponentByRegion=!1;var e=new CompositeState(t);return e.setType("UMLCompositeState"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(100),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Xmovement})),e.addComponent(new TextBox({id:"name",text:"StateName",margin:3,position:Component.Xmovement})),e.addComponent(new SpecificationItem({id:"specification",centered:!1,position:Component.BottomLeft,margin:10})),e.addFigure(new RegionFigure({color:"#ffffbb"})),e.setHeightSmallRectangle(e._components[0].getHeight()+e._components[1].getHeight()),e.setWidthSmallRectangle(e._components[1].getWidth()),t.setElementXml||e.addRegion(new Region({parent:e})),e.setMenu([[function(){for(var t=0;t<e._components.length;t++)e._components[t]instanceof SpecificationItem&&(e._components[t]._visible=!0,e._components[t].showDialog(),e.removeContextualMenu())},"Specifications"],[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLVerticalRegion=function(t){(t=t||{}).orientation=1;var e=new CompositeState(t);return e.setType("UMLVerticalRegion"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(320),e.setHeight(150),e.setMinHeight(50),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Xmovement})),e.addComponent(new TextBox({id:"name",text:"RegionName",margin:3,position:Component.Xmovement})),e.addComponent(new SpecificationItem({id:"specification",centered:!1,position:Component.BottomLeft,margin:10})),e.addComponent(new RegionStateItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new RegionFigure({color:"#ffffbb"})),e.setHeightSmallRectangle(e._components[0].getHeight()+e._components[1].getHeight()),e.setWidthSmallRectangle(e._components[1].getWidth()),t.setElementXml||(e.addRegion(new RegionState({parent:e})),e.addRegion(new RegionState({parent:e}))),e.setMenu([[function(){for(var t=0;t<e._components.length;t++)e._components[t]instanceof SpecificationItem&&(e._components[t]._visible=!0,e._components[t].showDialog(),e.removeContextualMenu())},"Specifications"],[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLHorizontalRegion=function(t){var e=new CompositeState(t=t||{});return e.setType("UMLHorizontalRegion"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(320),e.setHeight(150),e.setMinHeight(50),e.setMoveable(),e.setContainer(),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Xmovement})),e.addComponent(new TextBox({id:"name",text:"RegionName",margin:3,position:Component.Xmovement})),e.addComponent(new SpecificationItem({id:"specification",centered:!1,position:Component.BottomLeft,margin:10})),e.addComponent(new RegionStateItem({id:"addRegion",text:"...",margin:1,position:Component.BottomRight})),e.addFigure(new RegionFigure({color:"#ffffbb"})),e.setHeightSmallRectangle(e._components[0].getHeight()+e._components[1].getHeight()),e.setWidthSmallRectangle(e._components[1].getWidth()),t.setElementXml||(e.addRegion(new RegionState({parent:e})),e.addRegion(new RegionState({parent:e}))),e.setMenu([[function(){for(var t=0;t<e._components.length;t++)e._components[t]instanceof SpecificationItem&&(e._components[t]._visible=!0,e._components[t].showDialog(),e.removeContextualMenu())},"Specifications"],[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLTransition=function(t){var e=new Transition(t);return e.setType("UMLTransition"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new OpenTip),e},Actor=function(t){t=t||{},Actor.baseConstructor.call(this,t)};JSFun.extend(Actor,Rectangular),Actor.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Actor.prototype.setName=function(t){this._components[1].setValue(t)},Actor.prototype.getStereotypes=function(){return this._components[0]._childs},Actor.prototype.getName=function(){return this._components[1].getValue()},Actor.prototype.getStereotype=function(){return this._components[0]},Actor.prototype.getNameAsComponent=function(){return this._components[1]};var Communication=function(t){t=t||{},Communication.baseConstructor.call(this,t)};JSFun.extend(Communication,Relation),Communication.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Communication.prototype.setMultiplicityA=function(t){this._components[1].setValue(t)},Communication.prototype.setMultiplicityB=function(t){this._components[2].setValue(t)},Communication.prototype.getStereotypes=function(){return this._components[0]._childs},Communication.prototype.getMultiplicityA=function(){return this._components[1].getValue()},Communication.prototype.getMultiplicityB=function(){return this._components[2].getValue()};var Generalization=function(t){t=t||{},Generalization.baseConstructor.call(this,t)};JSFun.extend(Generalization,Relation),Generalization.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},Generalization.prototype.setName=function(t){this._components[1].setValue(t)},Generalization.prototype.getStereotypes=function(){return this._components[0]._childs},Generalization.prototype.getName=function(){return this._components[1].getValue()},Generalization.prototype.getNameAsComponent=function(){return this._components[1]};var GeneralizationSet=function(t){t=t||{},this._pivotP=2,GeneralizationSet.baseConstructor.call(this)};JSFun.extend(GeneralizationSet,Relation),GeneralizationSet.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},GeneralizationSet.prototype.setName=function(t){this._components[1].setValue(t)},GeneralizationSet.prototype.getStereotypes=function(){return this._components[0]._childs},GeneralizationSet.prototype.getName=function(){return this._components[1].getValue()},GeneralizationSet.prototype.getNameAsComponent=function(){return this._components[1]},GeneralizationSet.prototype.getRelations=function(){return this._relations},GeneralizationSet.prototype.setElements=function(t,e){if(!(t instanceof Array))return!!GeneralizationSet.base.setElements.call(this,t,e)&&(this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),!0);for(i in t)if(!(t[i]instanceof Node))return!1;if(t.length>1){for(this.setElements(t.shift(),t.shift());t[0];)this.addElement(t.shift());return this.updateParent(),this._orientation||(this._orientation=this._calculateOrientation()),this._calculateLineEnds(),!0}return!1},GeneralizationSet.prototype.getRelation=function(t){for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i]},GeneralizationSet.prototype.addElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA==t||this._relations[i]._elemB==t)return!1;relation=new SetLine({a:t,b:this}),relation._calculateLineEnds();var e=new Point(relation.getCentralPoint());return this._points.splice(this._pivotP,0,e),relation._calculateLineEnds(),relation._points[2]=this._points[this._pivotP],this._pivotP++,this.notifyChange(),!0},GeneralizationSet.prototype.delElement=function(t){if(!(t instanceof Node))return!1;for(i in this._relations)if(this._relations[i]._elemA===t||this._relations[i]._elemB===t)return this._relations[i].remove(),!0;return!1},GeneralizationSet.prototype.notifyDeleted=function(t){for(i=0;i<this._relations.length;i++)this._relations[i]===t&&"SetLine"==this._relations[i].getType()&&(this._relations.splice(i,1),this._pivotP--,this._points.splice(2+i,1))},GeneralizationSet.prototype._calculateLineEnds=function(){var t,e,n=this._points.length;if(this._points[3]||(t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e),this._elemA==this._elemB){var o,s,r=this._elemA.getCentralPoint(),a=r.getX(),h=r.getY(),p=this._points[2]?this._points[2]._x:this._elemA._x+this._elemA._width,l=this._points[2]?this._points[2]._y:this._elemA._y+this._elemA._height;if(2==this._selected||0==this._selected||this._selected==n-1||-1==this._selected&&!this._elemA._moved||this._elemA._resizing)p-a>0?l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()+s,t.getY()+o),this._points[3]=new Point(e.getX()+s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=p-e.getX())<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()+s,t.getY()-o),this._points[3]=new Point(e.getX()+s,h)):l-h>0?(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=l-t.getY())<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()+o),this._points[2]=new Point(e.getX()-s,t.getY()+o),this._points[3]=new Point(e.getX()-s,h)):(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2),e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h),o=(o=t.getY()-l)<20?20:o,s=(s=e.getX()-p)<20?20:s,this._points[1]=new Point(a,t.getY()-o),this._points[2]=new Point(e.getX()-s,t.getY()-o),this._points[3]=new Point(e.getX()-s,h));else if(3==this._selected)p=this._points[3]._x,l=this._points[3]._y,t=this._elemA.getLinkCentered(a,this._points[0]._y),p-a>0?(s=(s=p-(e=this._elemA.getLinkCentered(a+this._elemA.getWidth()/2,h)).getX())<20?20:s,this._points[2].setX(e.getX()+s),this._points[3]=new Point(e.getX()+s,h)):(s=(s=(e=this._elemA.getLinkCentered(a-this._elemA.getWidth()/2,h)).getX()-p)<20?20:s,this._points[2].setX(e.getX()-s),this._points[3]=new Point(e.getX()-s,h));else if(1==this._selected)p=this._points[1]._x,l=this._points[1]._y,e=this._elemA.getLinkCentered(this._points[4]._x,h),l-h>0?(o=(o=l-(t=this._elemA.getLinkCentered(a,h+this._elemA.getHeight()/2)).getY())<20?20:o,this._points[1]=new Point(a,t.getY()+o),this._points[2].setY(t.getY()+o)):(o=(o=(t=this._elemA.getLinkCentered(a,h-this._elemA.getHeight()/2)).getY()-l)<20?20:o,this._points[1]=new Point(a,t.getY()-o),this._points[2].setY(t.getY()-o));else if(2==this._selected){var _=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}else if(-1==this._selected){_=0,c=0;if(this._elemA._moved){_=(this._elemA._x-this._elemA._prex)/2,c=(this._elemA._y-this._elemA._prey)/2;this._points[0].setPoint(this._points[0]._x+_,this._points[0]._y+c),this._points[4].setPoint(this._points[4]._x+_,this._points[4]._y+c),t=this._points[0],e=this._points[4],this._points[1].setPoint(this._points[1]._x+_,this._points[1]._y+c),this._points[2].setPoint(this._points[2]._x+_,this._points[2]._y+c),this._points[3].setPoint(this._points[3]._x+_,this._points[3]._y+c)}}for(this._points[0]=t,this._points[4]=e;this._points[5];)this._points.pop()}else if(4==n)t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[3]=e;else if(n>4){for(t=this._elemA.getLinkCentered(this._points[1]),e=this._elemB.getLinkCentered(this._points[this._pivotP]),this._points[0]=t,this._points[this._points.length-1]=e,i=0;i<this._relations.length;i++)this._relations[i]._calculateLineEnds();if(this._orientation){for(i=1;i<this._pivotP;i++)this._points[i].setX(this._points[this._pivotP].getX());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setY(this._points[1].getY()+5)}else{for(i=1;i<this._pivotP;i++)this._points[i].setY(this._points[this._pivotP].getY());this._points[1].getX()==this._points[this._pivotP].getX()&&this._points[1].getY()==this._points[this._pivotP].getY()&&this._points[1].setX(this._points[1].getX()+5)}}else t=this._elemA.getLinkCentered(this._elemB.getCentralPoint()),e=this._elemB.getLinkCentered(this._elemA.getCentralPoint()),this._points[0]=t,this._points[1]=e,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=new Point(this.getCentralPoint()),this._points[3]=this._points[1],this._points[1]=this._points[2],this._points[2]=this._points[3],this._pivotP=2,this._points[3]=e},GeneralizationSet.prototype._delUselessPoints=function(){var t;for(t=this._points.length-1;t>this._pivotP;t--)this._selectLine(this._points[t+1],this._points[t-1],this._points[t].getX(),this._points[t].getY(),10)&&this._points.splice(t,1)},GeneralizationSet.prototype.draw=function(t){var e,i=this._points.length,n=[];for(e=this._pivotP;e<i;e++)n.push(this._points[e]);if(this._line&&this._line.draw(t,n,this.getLineColor(),this.getLineWidth()),this._end){var o=this._points[i-2].getX(),s=this._points[i-2].getY(),r=this._points[i-1].getX(),a=this._points[i-1].getY(),h=Math.atan2(a-s,r-o);this._end.draw(t,r,a,h,this.getLineColor())}if(this._selected>=0)for(e=0;e<this._points.length;e++)t.fillRect(parseInt(this._points[e].getX())-3,parseInt(this._points[e].pixelY())-3,6,6);for(n=[],e=1;e<=this._pivotP;e++)n.push(this._points[e]);if(n.length>1){if("solid"==this.getLineStyle())var p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth())}if((n=[])[0]=this._points[0],n[1]=this._points[1],n[2]=this._points[this._pivotP],"solid"==this.getLineStyle())p=new SolidLine;else p=new DashedLine;p.draw(t,n,this.getLineColor(),this.getLineWidth()),this._selected>-1&&this._drawComponentsShape(t),this._drawComponents(t)},GeneralizationSet.prototype.select=function(t,e){this._deselectComponent();var i=this._diagram._touch?4:0;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var n=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=n?e-n+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(o=0;o<this._points.length;o++)if(Math.abs(t-this._points[o].getX())<=4&&Math.abs(e-this._points[o].getY())<=4)return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,this._selectedPoint=!0,this._component=!1,!0;if(this._selected>-1&&this._isOverComponent(t,e,i))return this._selectedBefore=!0,this._component=!0,!0;for(var o=0;o<this._points.length-1;o++)if(this._selectLine(this._points[o],this._points[o+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=o,o>=this._pivotP?(this._selectedLine=!0,this._component=!1,this._points.splice(this._selected,0,new Point(t,e))):o>=1?(this._selectedPoint=!0,this._component=!1,this._selected=this._pivotP):(this._selectedPoint=!0,this._component=!1,this._selected=1),!0;return!1},GeneralizationSet.prototype._calculateOrientation=function(){var t=(this._elemA.getCentralPoint().getY()-this._elemB.getCentralPoint().getY())/(this._elemA.getCentralPoint().getX()-this._elemB.getCentralPoint().getX());return t<1&&t>-1},GeneralizationSet.prototype.isXOriented=function(){return this._orientation},GeneralizationSet.prototype.isYOriented=function(){return!this._orientation},GeneralizationSet.prototype.setXOrientation=function(){this._orientation=!0},GeneralizationSet.prototype.setYOrientation=function(){this._orientation=!1},GeneralizationSet.prototype.getOrientation=function(){return this._orientation?"x":"y"},GeneralizationSet.prototype.setLineStyle=function(t){if(!GeneralizationSet.base.setLineStyle.call(this,t))return!1;for(i in this._relations)if("SetLine"==this._relations[i].getType()&&!this._relations[i].setLineStyle(t))return!1;return!0},GeneralizationSet.prototype.setLineColor=function(t){GeneralizationSet.base.setLineColor.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineColor(t)},GeneralizationSet.prototype.setLineWidth=function(t){GeneralizationSet.base.setLineWidth.call(this,t);for(i in this._relations)"SetLine"==this._relations[i].getType()&&this._relations[i].setLineWidth(t)};var SetLine=function(t){t=t||{},this._last=null,this._id=0,this._type="SetLine",this._line_color="#000000",this._line_width=1.25,this._points=[new Point,new Point],this._selected=-1,this._selectedBefore=!1,this._moved=!1,this._activeComponent=null,this._selectedLine=!1,this._selectedPoint=!1,this._relations=[],this._components=[],this._diagram=null,this.setElements(t.a,t.b),f=this,this._elemB&&(this.setMenu([[function(){f._elemB.showStyleDialog({that:f._elemB}),f._elemB.removeContextualMenu()},"Style"]]),this.setLineStyle(this._elemB.getLineStyle()),this.setLineColor(this._elemB.getLineColor()),this.setLineWidth(this._elemB.getLineWidth()))};JSFun.extend(SetLine,Relation),SetLine.prototype._delUselessPoints=function(){},SetLine.prototype.select=function(t,e){this._deselectComponent();this._diagram._touch;if(this._diagram._activeMenu&&this.removeContextualMenu(),1==this._diagram._pressMouseRight||1==this._diagram._hold){if(this.setType("SetLine"),this.isOver(t,e)){this._diagram._pressMouseRight=!1,document.oncontextmenu=function(){return!1};var i=document.documentElement.scrollTop||document.body.scrollTop;return t+=this._diagram._div.offsetLeft,e=i?e-i+this._diagram._div.offsetTop:e+this._diagram._div.offsetTop,this.showContextualMenu(t,e),!0}return!1}for(var n=0;n>this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedLine=!0,this._component=!1,!0;for(n=0;n<this._points.length;n++)if(Math.abs(t-this._points[n].getX())<=4&&Math.abs(e-this._points[n].getY())<=4)return 2!=n&&(this._selected>-1&&(this._selectedBefore=!0),this._selected=n,this._selectedPoint=!0,this._component=!1,!0);for(n=0;n<this._points.length-1;n++)if(this._selectLine(this._points[n],this._points[n+1],t,e,20))return this._selected>-1&&(this._selectedBefore=!0),this._selected=1,this._selectedPoint=!0,this._component=!1,!0;return!1},SetLine.prototype._calculateLineEnds=function(){if(!this._elemB)return!1;var t=this._points[1];if(this._elemB._orientation)if(this._points.length<3){t=new Point(this._elemB._points[1].getX(),this._elemA.getCentralPoint().getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getY()<this._elemA.getY()?this._points[2].setY(this._elemA.getY()-20):this._points[2].setY(this._elemA.getY()+this._elemA.getHeight()+20)),this._points[0].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[2].getX()<=this._elemA.getX()?(this._points[0].setX(this._elemA.getX()),this._points[1].setX(this._elemA.getX()-10)):this._points[2].getX()>=this._elemA.getX()+this._elemA.getWidth()&&this._points[0].getX()<=this._elemA.getX()&&(this._points[0].setX(this._elemA.getX()+this._elemA.getWidth()),this._points[1].setX(this._elemA.getX()+this._elemA.getWidth()+10));else if(this._points.length<3){t=new Point(this._elemA.getCentralPoint().getX(),this._elemB._points[1].getY());this._points[0]=this._elemA.getLinkCentered(t)}else this._elemA.isOver(this._points[2])&&(this._elemB._points[this._elemB._pivotP].getX()<this._elemA.getX()?this._points[2].setX(this._elemA.getX()-20):this._points[2].setX(this._elemA.getX()+this._elemA.getWidth()+20)),this._points[0].getY()<=this._elemA.getY()&&this._points[2].getY()>this._elemA.getY()+this._elemA.getHeight()?(this._points[0].setY(this._elemA.getY()+this._elemA.getHeight()),this._points[1].setY(this._elemA.getY()+this._elemA.getHeight()+10)):this._points[0].getY()>=this._elemA.getY()+this._elemA.getHeight()&&this._points[2].getY()<=this._elemA.getY()&&(this._points[0].setY(this._elemA.getY()),this._points[1].setY(this._elemA.getY()-10));this._points.length<3&&(this._points[1]=t,this._points[1]=new Point(this.getCentralPoint()),this._points[2]=t),this._points[0]=this._elemA.getLinkCentered(this._points[1])},SetLine.prototype.setElementXML=function(t,e){var i,n=t.getAttribute("side_A"),o=e[t.getAttribute("side_B")],s=e[n];if(!(o instanceof GeneralizationSet))return null;o.addElement(s),relation=o._relations[o._relations.length-1],this.setId(t.getAttribute("id"));var r=t.childNodes,a=0;for(i=0;i<r.length;i++)"point"==r[i].nodeName&&(this._points[a]=new Point(parseInt(r[i].getAttribute("x")),parseInt(r[i].getAttribute("y"))),a++);o.delElement(s),this.setLineStyle(o.getLineStyle()),this.setLineColor(o.getLineColor()),this.setLineWidth(o.getLineWidth()),this._type="SetLine",this._elemA=s,this._elemB=o,o._relations.splice(o._relations.length-1,1,this),this._points[2]=o._points[o._pivotP],o._pivotP++,o.notifyChange(),s.addRelation(this)};var SubSystem=function(t){t=t||{},SubSystem.baseConstructor.call(this,t)};JSFun.extend(SubSystem,Rectangular),SubSystem.prototype.addStereotype=function(t){t=t||"";this._components[1].addField("«"+t+"»")},SubSystem.prototype.setName=function(t){this._components[3].setValue(t)},SubSystem.prototype.getStereotypes=function(){return this._components[1]._childs},SubSystem.prototype.getName=function(){return this._components[3].getValue()},SubSystem.prototype.getStereotype=function(){return this._components[1]},SubSystem.prototype.getNameAsComponent=function(){return this._components[3]};var System=function(t){t=t||{},System.baseConstructor.call(this,t)};JSFun.extend(System,Rectangular),System.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},System.prototype.setName=function(t){this._components[1].setValue(t)},System.prototype.getStereotypes=function(){return this._components[0]._childs},System.prototype.getName=function(){return this._components[1].getValue()},System.prototype.getStereotype=function(){return this._components[0]},System.prototype.getNameAsComponent=function(){return this._components[1]};var UseCase=function(t){t=t||{},UseCase.baseConstructor.call(this,t)};JSFun.extend(UseCase,Elliptical),UseCase.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},UseCase.prototype.setName=function(t){this._components[1].setValue(t)},UseCase.prototype.getStereotypes=function(){return this._components[0]._childs},UseCase.prototype.getName=function(){return this._components[1].getValue()},UseCase.prototype.getStereotype=function(){return this._components[0]},UseCase.prototype.getNameAsComponent=function(){return this._components[1]};var UseCaseClassifier=function(t){t=t||{},UseCaseClassifier.baseConstructor.call(this,t)};JSFun.extend(UseCaseClassifier,Rectangular),UseCaseClassifier.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},UseCaseClassifier.prototype.setName=function(t){this._components[1].setValue(t)},UseCaseClassifier.prototype.getStereotypes=function(){return this._components[0]._childs},UseCaseClassifier.prototype.getName=function(){return this._components[1].getValue()},UseCaseClassifier.prototype.getStereotype=function(){return this._components[0]},UseCaseClassifier.prototype.getNameAsComponent=function(){return this._components[1]};var UseCaseDiagram=function(t){UseCaseDiagram.baseConstructor.call(this,t)};JSFun.extend(UseCaseDiagram,Diagram),UseCaseDiagram.prototype.setXML=function(t,e){e=e||null;var i=[];if(this._alone){if(!(n=t.getElementsByTagName(this.getType())[0]))return!1}else var n=t;this._name.setValue(n.getAttribute("name")),n.getAttribute("backgroundNodes")&&(this._backgroundNodes=n.getAttribute("backgroundNodes"));var o,s=n.childNodes;for(o=0;o<s.length;o++)this._instantiateElements(s[o],i);for(o=0;o<s.length;o++)this._addElementXML(s[o],i,null,e);for(o=0;o<this._relations.length;o++)this._relations[o].notifyChange();return this._sortNodesByArea(),!0},UseCaseDiagram.prototype._addElementXML=function(t,e,i,n){i=i||null,n=n||null;var o=e[t.getAttribute("id")];if(o){if(i instanceof SuperNode&&o instanceof Region&&o.addComponents(!1),o._stereotypeProperties&&n&&o._stereotypeProperties.setStereotypesProfile(n),o.setElementXML(t,e),i instanceof SuperNode&&o instanceof Node){if(o.setDiagram(this),o instanceof Region){var s=o._parent._nodeChilds,r=s.length;r>0&&(o._parent._orientation?s[r-1].setWidth(o._x-s[r-1]._x):s[r-1].setHeight(o._y-s[r-1]._y),s[r-1].updateComponents())}}else this._addElementOnly(o);i&&o instanceof Node&&(i.addChild(o),o instanceof Swimlane&&o._parent.updateSizeComponentSwimlane(),i.updateContainer(!1),i._parent instanceof SuperNode&&i._parent.updateContainer(!1));for(var a=0;a<t.childNodes.length;a++)this._addElementXML(t.childNodes[a],e,o,n)}};var UseCaseExtended=function(t){t=t||{},UseCaseExtended.baseConstructor.call(this,t)};JSFun.extend(UseCaseExtended,Elliptical),UseCaseExtended.prototype.addStereotype=function(t){t=t||"";this._components[0].addField("«"+t+"»")},UseCaseExtended.prototype.setName=function(t){this._components[1].setValue(t)},UseCaseExtended.prototype.addExtensionPoint=function(t){this._components[4].addField(t)},UseCaseExtended.prototype.getStereotypes=function(){return this._components[0]._childs},UseCaseExtended.prototype.getName=function(){return this._components[1].getValue()},UseCaseExtended.prototype.getExtensionPoints=function(){return this._components[4]._childs},UseCaseExtended.prototype.getStereotype=function(){return this._components[0]},UseCaseExtended.prototype.getNameAsComponent=function(){return this._components[1]};var UMLUseCaseDiagram=function(t){var e=new UseCaseDiagram(t);return e.setType("UMLUseCaseDiagram"),e.setName("Use case diagram"),e.setValidElements(["UMLNote","UMLLine","UMLActor","UMLUseCase","UMLUseCaseExtended","UMLUseCaseClassifier","UMLSystem","UMLSubSystem","UMLCommunication","UMLExtend","UMLInclude","UMLGeneralization","UMLGeneralizationSet","SetLine"]),e},UMLActor=function(t){var e=new Actor(t=t||{});return e.setType("UMLActor"),setStereotypeProperties(e,t.stereotypes||[]),e.setMinWidth(50),e.setMinHeight(70),e.setProportional(),e.setMoveable(),e.addFigure(new StickmanFigure),e.addComponent(new StereotypeTagList({id:"stereotypes",position:Component.Bottom})),e.addComponent(new TextArea({id:"name",position:Component.Bottom})),e.setMenu([[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLUseCase=function(t){var e=new UseCase(t=t||{});return e.setType("UMLUseCase"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(40),e.setMoveable(),e.addFigure(new EllipseFigure),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLUseCaseExtended=function(t){var e=new UseCaseExtended(t=t||{});return e.setType("UMLUseCaseExtended"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(40),e.setMoveable(),e.addFigure(new EllipseFigure),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0})),e.addComponent(new Separator),e.addComponent(new Text({text:"extension points",centered:!0})),e.addComponent(new TextFields({id:"extension",centered:!0})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLSystem=function(t){var e=new System(t=t||{});return e.setType("UMLSystem"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(150),e.setHeight(100),e.setMoveable(),e.setContainer(),e.addFigure(new RectangleFigure({color:"#c6dbdc"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new Tab({id:"name",margin:5,text:"System name"})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLSubSystem=function(t){var e=new SubSystem(t=t||{});return e.setType("UMLSubSystem"),setStereotypeProperties(e,t.stereotypes||[]),e.setMinWidth(150),e.setHeight(100),e.setMoveable(),e.setContainer(),e.addFigure(new RectangleFigure({color:"#c6dbdc"})),e.addComponent(new Text({centered:!0,text:"«subsystem»",margin:1})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new ComponentSymbol({position:Component.TopRight,margin:5})),e.addComponent(new TextBox({id:"name",centered:!0,margin:2})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLCommunication=function(t){var e=new Communication(t);return e.setType("UMLCommunication"),e.addComponentStereotype(),e.setComponentMultiplicityA(),e.setComponentMultiplicityB(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e},UMLUseCase=function(t){var e=new UseCase(t=t||{});return e.setType("UMLUseCase"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(40),e.setMoveable(),e.addFigure(new EllipseFigure),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e},UMLExtend=function(t){var e=new Relation(t);return e.setType("UMLExtend"),e.setStereotype("«extend»"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLInclude=function(t){var e=new Relation(t);return e.setType("UMLInclude"),e.setStereotype("«include»"),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new DashedLine),e.setEnd(new OpenTip),e},UMLGeneralization=function(t){var e=new Generalization(t);return e.setType("UMLGeneralization"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new CloseTip),e},UMLGeneralizationSet=function(t){var e=new GeneralizationSet(t);return e.setType("UMLGeneralizationSet"),e.addComponentStereotype(),e.setComponentName(),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"]]),e.setLine(new SolidLine),e.setEnd(new CloseTip),e},UMLUseCaseClassifier=function(t){var e=new UseCaseClassifier(t=t||{});return e.setType("UMLUseCaseClassifier"),setStereotypeProperties(e,t.stereotypes||[]),e.setWidth(100),e.setHeight(40),e.setMoveable(),e.addFigure(new RectangleFigure({color:"#ffffbb"})),e.addComponent(new StereotypeTagList({id:"stereotypes",centered:!0})),e.addComponent(new TextArea({id:"name",centered:!0,margin:3})),e.addComponent(new ElipseSymbol({position:Component.TopRight,margin:3})),e.setMenu([[function(){e.showStyleDialog({that:e}),e.removeContextualMenu()},"Style"],[function(){getStereotypeProperties(e).showTagValuesDialog(),e.removeContextualMenu()},"Tag value"],[function(){getStereotypeProperties(e).showApplyStereotypesDialog(),e.removeContextualMenu()},"Apply Stereotype"],[function(){getStereotypeProperties(e).showStereotypesDialog(),e.removeContextualMenu()},"Show Stereotype"]]),e};